const _0x1cc7ab = _0x36f6; (function (_0x3b4be3, _0x3d8a3d) { const _0x2c7e20 = _0x36f6, _0x4980cf = _0x3b4be3(); while (!![]) { try { const _0x1f4988 = parseInt(_0x2c7e20(0x202)) / 0x1 * (parseInt(_0x2c7e20(0x1f3)) / 0x2) + parseInt(_0x2c7e20(0x27f)) / 0x3 * (parseInt(_0x2c7e20(0x29d)) / 0x4) + parseInt(_0x2c7e20(0x30b)) / 0x5 + -parseInt(_0x2c7e20(0x22b)) / 0x6 + -parseInt(_0x2c7e20(0x23d)) / 0x7 * (parseInt(_0x2c7e20(0x267)) / 0x8) + parseInt(_0x2c7e20(0x24f)) / 0x9 + -parseInt(_0x2c7e20(0x2e4)) / 0xa * (parseInt(_0x2c7e20(0x2e7)) / 0xb); if (_0x1f4988 === _0x3d8a3d) break; else _0x4980cf['push'](_0x4980cf['shift']()); } catch (_0x3dcfbc) { _0x4980cf['push'](_0x4980cf['shift']()); } } }(_0x4677, 0xb299a)); const { Server, ServerEvent, Player } = require(_0x1cc7ab(0x21b)), WebSocket = require('ws'), fetch = require('node-fetch'), wanakana = require('wanakana'), fs = require('fs'), fsPromises = require('fs')[_0x1cc7ab(0x2cc)], JSON5 = require(_0x1cc7ab(0x29c)), getPort = require(_0x1cc7ab(0x2b0)), express = require(_0x1cc7ab(0x2fa)), http = require('http'), zlib = require(_0x1cc7ab(0x2ca)), msgpack = require('msgpack-lite'), { randomUUID } = require(_0x1cc7ab(0x2fb)); let sshHandler = null; try { fs[_0x1cc7ab(0x204)](_0x1cc7ab(0x25c)) && (sshHandler = require(_0x1cc7ab(0x25c))); } catch (_0x41d69b) { } const RELAY_SERVER_DOMAIN = _0x1cc7ab(0x1e7), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x1cc7ab(0x2e1), './config.json5', './config.json']; function _0x4677() { const _0x154d1c = ['status', 'Failed\x20to\x20write\x20server_info.json:', 'floor', 'spectator', 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました', 'relayWs', 'Session\x20not\x20found', 'dataUpdate', 'Output\x20disabled', 'enabled', 'loop', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', 'encode', 'position', 'Connection\x20started\x0aProximity\x20voice\x20chat:', './config.jsonc', 'statusCode', 'startWebSession', '968270aIVbrT', 'gunzipSync', 'shift', '165cKHCHm', 'web_port', 'statusMessage', '\x0a最大距離\x20(Distance):\x20§e', 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', '?clientType=server_script', 'send', 'toString', 'exit', 'WorldRemove', 'reason', ']\x20最大稼働時間に達しました。', '[MC\x20Relay]', 'set', 'isProcessingTags', 'utf8', 'sshError', 'Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag', 'yRot', 'express', 'crypto', '/api/stop_session', 'test', 'pvcSessionId', '出力を有効にしました', 'パスワードは', 'localPlayer', '近接vcを無効にしました', 'stop_roop', 'Spectator\x20set\x20to\x20common\x20VC', 'finally', 'minecraft', 'keys', 'writeFile', 'parse', 'params', '3825700TdbKRa', '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'forEach', 'testfor\x20@e[type=player]', 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', '§r\x0a認証コード\x20(Verify):\x20', 'vcSshClient', 'testfor\x20@a[m=spectator]', '/room/', 'next', 'worldName', '\x1b[33m[Log][', 'dimensions', 'clientType', 'stringify', '--------------------', 'Participants\x20should\x20access\x20this\x20URL', 'pvc:req_cmd', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', '§a有効§r', 'スペクテイター同士の会話をディメンションごとに分けました', 'verify', 'ended', 'all', 'details', 'spectatorSet', 'command_result', 'headers', 'getAllTags', 'sendMessage', '[Standalone]\x20Failed\x20to\x20start\x20session:', 'from', 'sendInitMessage', 'nameCache', 'startsWith', '[VC\x20Relay]', 'mcproxvc.fly.dev', '\x0aSpectator\x20Split:\x20', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', '\x0aProximity\x20VC:\x20', 'false', 'split', 'dimension', 'mc_connected', 'createServer', 'toRomaji', 'now', 'スペクテイターとVCを分けました', '102472tKvgip', 'aliveSet', 'wss://', '\x22]\x20remove\x20\x22', '/connect\x20', 'handleTcpUpgrade', 'random', '<Proximity\x20VC>Language\x20set\x20to\x20English', 'true', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', 'action', 'body', '--streamlit', 'isBuffer', '22SJLhyT', 'concat', 'existsSync', '近接vcを有効にしました', 'disabled', '<近接VC>', 'PlayerChat', 'OPEN', 'name', 'url', 'directVcClients', 'CONNECTING', 'testfor\x20@a', 'specDim', 'Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:', 'values', 'PlayerLoad', 'playersNames', 'sub_domain', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', '接続開始', '<近接VC>言語を日本語に設定しました', 'cleanOldTags', 'Proximity\x20VC\x20enabled', 'runCommand', './lib/server', 'destroy', 'inactivityTimer', 'processName', 'delete', 'distance', 'pendingTimeout', '[Local\x20Client\x20Error]\x20', 'スペクテイターを共通のVCにしました', 'localhost', 'logInfo', 'timeout', '\x0a出力\x20(Output):\x20', '\x0aYour\x20VCname\x20is\x20', 'world', 'error', '6553560seosiY', 'data', 'です\x0aあなたのVCnameは', '/api/session_status/:id', 'maxRuntimeTimeout', 'writeFileSync', 'vc_connected', 'spectators', '\x20Error:', 'passwords', 'searchParams', 'success', 'find', 'server_shutdown', 'argv', '§l[Current\x20Settings]§r\x0aLanguage:\x20', 'output', '認証コードを無効にしました', '6594cTkghp', 'get', 'string', 'roomId', '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20', 'pvc:', '\x0aMax\x20distance:', 'end', 'localClientBuffer', 'Unknown\x20World', '\x0a声の届く距離：', '認証コードは', 'Error\x20handling\x20world\x20loop\x20[', 'catch', '§c無効§r', 'length', 'readyState', 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players', '12066525GYhgTs', 'broadcastPositions', 'mcSshClient', 'processTagCommands', 'Output\x20enabled', 'list', 'listen', 'tag\x20@s\x20add\x20\x22pvc:roomId=', '接続を開始しました\x0a近接vc：', ']\x1b[0m\x20', 'connectCommand', 'open', 'useRelay', './tcpexposer/tcpexposer_handler.js', 'not_found', 'PlayerTransform', '\x1b[36m[Info][', 'bindWorld', '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)', 'round', 'tag\x20@a[tag=\x22', 'log', 'data_update', 'startTimer', '3464GmPNAG', 'password', 'useResetTimer', 'SIGINT', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'upgrade', 'verify\x20code\x20disabled', 'message', '\x0aOutput:\x20', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'Host\x20left.\x20Handing\x20stop\x20signal...', 'relayed_vc_data', 'run_command', '\x0a!help\x20for\x20command\x20list', 'post', 'trim', 'handleUpgrade', 'filter', 'Session\x20not\x20found\x20for\x20this\x20domain', 'ws://127.0.0.1:', 'partner_connected', 'sshClient', 'consecutiveTimeouts', 'readFileSync', '6dHbBow', 'No\x20active\x20sessions', 'add', 'tag\x20@a\x20remove\x20\x22', 'port', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'commands', 'spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20スペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20スペクテイター同士の会話をディメンションごとに分けます', '参加者はこのURLにアクセスしてください:', 'lang', 'init', 'function', 'entries', 'tag\x20@a[tag=pvc:req_cmd]\x20remove\x20pvc:req_cmd', 'pvc:roomId=', 'userName', 'createCommands', 'specListen', 'http://', 'verify\x20code\x20enabled', 'handleDirectVcConnection', 'shouldBroadcast', 'has', 'tag\x20@a[tag=pvc:req_cmd]\x20list', 'includes', 'https://mcproxvc.ovh/connect/?roomid=', '\x0a!help\x20でコマンド一覧を確認できます', '<近接VC>声の最大距離を', 'value', 'json5', '902080pZfhzR', 'logLog', 'players', 'active', 'type', '/api/start_session', 'disconnect_command', 'json', '退出:\x20', 'stop', 'localClient', 'ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20近接vcを有効/無効にできます', '\x0aMax\x20Distance:\x20§e', '[TCPExposer]\x20TCPExposerハンドラーが見つからないため、接続をスキップします。リレーサーバーを使用します。', 'setupVcRelayListeners', 'warn', 'clear', 'host', '[Relay]\x20Connected\x20(ID:\x20', 'get-port', 'proximity', 'スペクテイター同士の会話を共通にしました', 'use', 'map', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20言語の変更\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', '出力を無効にしました', '[Auto-Stop][', 'indexOf', 'initialization', '§cDisabled§r', 'close', 'onlinePlayers', 'sendInitialPayload', 'Verify\x20code\x20is\x20', '[Config]\x20Error\x20parsing\x20', 'setupMcRelayListeners', 'config', 'replace', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20minecraftチャットへの出力を有効/無効にできます\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20スペクテイターとVCを分けます', '=======================================================\x0a', 'positions', '認証コードを有効にしました', 'testfor\x20@a[tag=pvc:req_cmd]', 'connectToRelayServer', 'yRots', 'zlib', 'then', 'promises', 'substring', 'victim', 'resetTimer', 'WorldAdd']; _0x4677 = function () { return _0x154d1c; }; return _0x4677(); } let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs['existsSync'](filePath)) try { const fileContent = fs[_0x1cc7ab(0x27e)](filePath, _0x1cc7ab(0x2f6)); globalConfig = JSON5[_0x1cc7ab(0x309)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x3c3f0b) { console[_0x1cc7ab(0x22a)](_0x1cc7ab(0x2bf) + filePath + ':', _0x3c3f0b['message']); } } !configLoaded && console['warn'](_0x1cc7ab(0x270)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'output': !![], 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x1cc7ab(0x268)] = INITIAL_CONFIG[_0x1cc7ab(0x320)] ?? INITIAL_CONFIG[_0x1cc7ab(0x268)]; async function updateConfigFile(_0x4b1d8b, _0x19a66a) { const _0x17cef6 = _0x1cc7ab; if (!configPath) return; try { let _0x2f7913 = await fsPromises['readFile'](configPath, _0x17cef6(0x2f6)); const _0x4b16ae = new RegExp('(\x22' + _0x4b1d8b + _0x17cef6(0x261)), _0x146d0e = typeof _0x19a66a === _0x17cef6(0x23f) ? '\x22' + _0x19a66a + '\x22' : _0x19a66a, _0x504e3e = _0x2f7913[_0x17cef6(0x2c2)](_0x4b16ae, '$1' + _0x146d0e); _0x504e3e !== _0x2f7913 && await fsPromises[_0x17cef6(0x308)](configPath, _0x504e3e, _0x17cef6(0x2f6)); } catch (_0x3f5184) { console[_0x17cef6(0x22a)]('❌\x20設定ファイルの更新に失敗しました:', _0x3f5184); } }; const makeRange = (_0x2ae885, _0x4ba150) => Array[_0x1cc7ab(0x32a)]({ 'length': _0x4ba150 - _0x2ae885 + 0x1 }, (_0x213ed4, _0x47051c) => _0x2ae885 + _0x47051c); let globalGatewayServer = null; async function startTcpexposer(_0x3aa234, _0x5e6bc7, _0x43a053) { const _0x335dab = _0x1cc7ab; return sshHandler && typeof sshHandler['startTcpexposer'] === _0x335dab(0x28a) ? await sshHandler['startTcpexposer'](_0x3aa234, _0x5e6bc7, _0x43a053) : (_0x3aa234[_0x335dab(0x225)](_0x335dab(0x2aa)), _0x3aa234['roomId'] = '', _0x3aa234[_0x335dab(0x2c8)]('mc'), null); } function setupGlobalVcWebSocket(_0x1beeaf) { const _0x49d139 = _0x1cc7ab; if (globalGatewayServer) return; const _0x3d9e48 = express(), _0x7b9948 = http[_0x49d139(0x1ef)](_0x3d9e48), _0x3e13b7 = new WebSocket['Server']({ 'noServer': !![] }); _0x3d9e48[_0x49d139(0x2b3)](express[_0x49d139(0x2a4)]()), _0x3d9e48[_0x49d139(0x275)]('/', (_0x3c9646, _0x271a50) => { const _0x542bff = _0x49d139, { type: _0x31f31b } = _0x3c9646[_0x542bff(0x1ff)], _0x67479a = _0x3c9646[_0x542bff(0x326)][_0x542bff(0x2ae)]; let _0x3abaf7 = null; if (_0x67479a) { for (const _0x254143 of sessions[_0x542bff(0x211)]()) { const _0x580b94 = _0x254143['config'][_0x542bff(0x214)]; if (_0x580b94 && _0x67479a[_0x542bff(0x1e5)](_0x580b94)) { _0x3abaf7 = _0x254143; break; } } if (!_0x3abaf7) for (const _0xa6089c of pendingSessions[_0x542bff(0x211)]()) { const _0x1bef00 = _0xa6089c['config'][_0x542bff(0x214)]; if (_0x1bef00 && _0x67479a['startsWith'](_0x1bef00)) { _0x3abaf7 = _0xa6089c; break; } } } if (_0x3abaf7) { if (_0x31f31b === _0x542bff(0x265)) _0x3abaf7['dataUpdate'](_0x3c9646['body']); else { if (_0x31f31b === _0x542bff(0x2a3)) _0x3abaf7[_0x542bff(0x21c)](_0x542bff(0x236)); } _0x31f31b === 'initialization' ? (_0x3abaf7[_0x542bff(0x231)] = !![], _0x3abaf7[_0x542bff(0x225)]('接続開始'), _0x271a50[_0x542bff(0x2d1)](0xc8)[_0x542bff(0x2a4)]({ 'type': _0x542bff(0x2b9), 'roomId': _0x3abaf7['roomId'], 'ws_connected': _0x3abaf7[_0x542bff(0x1ee)], ..._0x3abaf7[_0x542bff(0x2c1)] })) : _0x271a50['status'](0xc8)[_0x542bff(0x2a4)]({ 'success': !![] }); } else _0x271a50[_0x542bff(0x2d1)](0x194)[_0x542bff(0x2a4)]({ 'error': _0x542bff(0x279) }); }), _0x3d9e48[_0x49d139(0x23e)]('/', (_0x4b9a27, _0x2ae189) => { const _0x300094 = _0x49d139; _0x2ae189[_0x300094(0x2ed)](_0x300094(0x26b)); }), _0x7b9948['on'](_0x49d139(0x26c), (_0x5a4300, _0x5453ec, _0x406528) => { const _0x1c0650 = _0x49d139; let _0x3bdb03 = null, _0x380fcb = null; try { const _0xaac3b3 = _0x5a4300['headers'][_0x1c0650(0x2ae)] || _0x1c0650(0x224); let _0x5a15e1 = _0x5a4300[_0x1c0650(0x20b)] || '/'; if (_0x5a15e1 === '//') _0x5a15e1 = '/'; _0x380fcb = new URL(_0x5a15e1, _0x1c0650(0x291) + _0xaac3b3), _0x3bdb03 = _0x380fcb[_0x1c0650(0x235)]['get'](_0x1c0650(0x318)); } catch (_0x18c219) { _0x3bdb03 = null; } _0x3bdb03 !== 'vc' ? sshHandler && typeof sshHandler[_0x1c0650(0x1f8)] === _0x1c0650(0x28a) ? sshHandler[_0x1c0650(0x1f8)](_0x5a4300, _0x5453ec, _0x406528, INITIAL_CONFIG[_0x1c0650(0x283)]) : _0x5453ec[_0x1c0650(0x21c)]() : _0x3e13b7[_0x1c0650(0x277)](_0x5a4300, _0x5453ec, _0x406528, _0x3e3bfe => { const _0x2bb9db = _0x1c0650, _0x3287f4 = _0x5a4300[_0x2bb9db(0x326)][_0x2bb9db(0x2ae)]; let _0x47ab05 = null; if (_0x3287f4) { for (const _0x101bf7 of sessions['values']()) { const _0x3c2ee8 = _0x101bf7[_0x2bb9db(0x2c1)][_0x2bb9db(0x214)]; if (_0x3c2ee8 && _0x3287f4[_0x2bb9db(0x1e5)](_0x3c2ee8)) { _0x47ab05 = _0x101bf7; break; } } if (!_0x47ab05) for (const _0xf68c93 of pendingSessions[_0x2bb9db(0x211)]()) { const _0x16a2be = _0xf68c93[_0x2bb9db(0x2c1)][_0x2bb9db(0x214)]; if (_0x16a2be && _0x3287f4['startsWith'](_0x16a2be)) { _0x47ab05 = _0xf68c93; break; } } } if (_0x47ab05) _0x47ab05[_0x2bb9db(0x293)](_0x3e3bfe); else { const _0x549aaf = sessions[_0x2bb9db(0x211)]()[_0x2bb9db(0x314)]()[_0x2bb9db(0x29b)] || pendingSessions['values']()['next']()[_0x2bb9db(0x29b)]; if (_0x549aaf) _0x549aaf[_0x2bb9db(0x293)](_0x3e3bfe); else _0x3e3bfe[_0x2bb9db(0x2bb)](); } }); }), _0x7b9948[_0x49d139(0x255)](_0x1beeaf, () => { }), globalGatewayServer = _0x7b9948; }; class Session { constructor(_0x5ba660, _0x1d5de1 = {}) { const _0x4d2fdf = _0x1cc7ab; this['id'] = randomUUID(), this[_0x4d2fdf(0x229)] = _0x5ba660, this[_0x4d2fdf(0x315)] = _0x5ba660 ? _0x5ba660[_0x4d2fdf(0x20a)] || _0x4d2fdf(0x246) : 'Pending\x20Session', this[_0x4d2fdf(0x32c)] = new Map(), this[_0x4d2fdf(0x2c1)] = { ...INITIAL_CONFIG, ..._0x1d5de1 }, this[_0x4d2fdf(0x240)] = this['config'][_0x4d2fdf(0x214)], this[_0x4d2fdf(0x259)] = '', this[_0x4d2fdf(0x234)] = {}, this[_0x4d2fdf(0x2c5)] = {}, this[_0x4d2fdf(0x2c9)] = {}, this[_0x4d2fdf(0x317)] = {}, this['spectators'] = {}, this['onlinePlayers'] = new Set(), this['shouldBroadcast'] = !![], this[_0x4d2fdf(0x231)] = ![], this['mc_connected'] = ![], this['stop_roop'] = ![], this[_0x4d2fdf(0x25b)] = ![], this['useResetTimer'] = ![], this[_0x4d2fdf(0x2d6)] = null, this[_0x4d2fdf(0x2a7)] = null, this[_0x4d2fdf(0x20c)] = new Set(), this['sshClient'] = null, this[_0x4d2fdf(0x2f7)] = null, this[_0x4d2fdf(0x21d)] = null, this['consecutiveTimeouts'] = 0x0, this['pendingTimeout'] = null, this[_0x4d2fdf(0x285)] = this['createCommands'](); } [_0x1cc7ab(0x225)](_0x1e7684) { const _0x203b9d = _0x1cc7ab; console[_0x203b9d(0x264)](_0x203b9d(0x25f) + this['id'][_0x203b9d(0x2cd)](0x0, 0x6) + _0x203b9d(0x258) + _0x1e7684); } [_0x1cc7ab(0x29e)](_0x4ecef0) { const _0x38b6f8 = _0x1cc7ab; console[_0x38b6f8(0x264)](_0x38b6f8(0x316) + this['id'][_0x38b6f8(0x2cd)](0x0, 0x6) + ']\x1b[0m\x20' + _0x4ecef0); } [_0x1cc7ab(0x21e)](_0x12507c) { const _0x4c30d6 = _0x1cc7ab; if (!this[_0x4c30d6(0x32c)][_0x4c30d6(0x295)](_0x12507c)) { const _0xb32fb3 = wanakana[_0x4c30d6(0x1f0)](_0x12507c[_0x4c30d6(0x2c2)](/ /g, '_'))[_0x4c30d6(0x2c2)](/n'/g, 'n'); this[_0x4c30d6(0x32c)][_0x4c30d6(0x2f4)](_0x12507c, _0xb32fb3); } return this['nameCache'][_0x4c30d6(0x23e)](_0x12507c); } [_0x1cc7ab(0x293)](_0x5b4350) { const _0x309f34 = _0x1cc7ab; this[_0x309f34(0x20c)][_0x309f34(0x281)](_0x5b4350), this[_0x309f34(0x231)] = !![], this[_0x309f34(0x2bd)](_0x5b4350), _0x5b4350['on'](_0x309f34(0x26e), async _0x3cf881 => { const _0x2384c7 = _0x309f34; try { let _0x1ca0e7; try { _0x1ca0e7 = msgpack['decode'](_0x3cf881); } catch (_0x18c14e) { try { _0x1ca0e7 = JSON[_0x2384c7(0x309)](_0x3cf881); } catch (_0x4f9f0a) { } } if (_0x1ca0e7) { if (_0x1ca0e7['userName'] && _0x1ca0e7['position']) this[_0x2384c7(0x2c5)][_0x1ca0e7[_0x2384c7(0x28e)]] = _0x1ca0e7[_0x2384c7(0x2df)]; if (_0x1ca0e7['action'] === _0x2384c7(0x273) && typeof _0x1ca0e7[_0x2384c7(0x29b)] === _0x2384c7(0x23f)) { if (this['world']) { const _0x283600 = await this[_0x2384c7(0x229)][_0x2384c7(0x21a)](_0x1ca0e7['value']); _0x5b4350['send'](JSON[_0x2384c7(0x319)]({ 'type': _0x2384c7(0x325), 'payload': _0x283600 })); } } } } catch (_0x312a11) { } }), _0x5b4350['on'](_0x309f34(0x2bb), () => { const _0x2a4b35 = _0x309f34; this[_0x2a4b35(0x20c)]['delete'](_0x5b4350); }); } async[_0x1cc7ab(0x2e3)]() { const _0x498d63 = _0x1cc7ab, { sub_domain: _0x26a0c4, username: _0x12619f, ssh_password: _0x305a36 } = this[_0x498d63(0x2c1)]; _0x12619f && _0x305a36 && _0x26a0c4 ? this[_0x498d63(0x27c)] = await startTcpexposer(this, _0x26a0c4, INITIAL_CONFIG['web_port']) : (this[_0x498d63(0x240)] = '', await this[_0x498d63(0x2c8)]('mc')); } [_0x1cc7ab(0x260)](_0x4fee4e) { const _0x5711ca = _0x1cc7ab; this[_0x5711ca(0x221)] && (clearTimeout(this[_0x5711ca(0x221)]), this[_0x5711ca(0x221)] = null), this['world'] = _0x4fee4e, this[_0x5711ca(0x315)] = _0x4fee4e[_0x5711ca(0x20a)] || _0x5711ca(0x246), this[_0x5711ca(0x289)](); } async['init']() { const _0x325d0f = _0x1cc7ab; if (!this[_0x325d0f(0x229)] && !this[_0x325d0f(0x221)]) return; if (!this['useRelay'] && !this['sshClient']) { const { sub_domain: _0x542e86, username: _0x12e368, ssh_password: _0x2bc634 } = this[_0x325d0f(0x2c1)]; if (_0x12e368 && _0x2bc634 && _0x542e86) { this[_0x325d0f(0x27c)] = await startTcpexposer(this, _0x542e86, INITIAL_CONFIG[_0x325d0f(0x2e8)]); if (!this[_0x325d0f(0x27c)]) { if (!this['useRelay']) await this['connectToRelayServer']('mc'); } } else { if (!_0x542e86) await this[_0x325d0f(0x2c8)]('mc'); } } this[_0x325d0f(0x1ee)] = !![], this[_0x325d0f(0x303)] = ![], this[_0x325d0f(0x225)]('接続開始'); if (this[_0x325d0f(0x229)]) { try { await this[_0x325d0f(0x218)](), this['world']['runCommand']('tag\x20@s\x20add\x20\x22pvc:roomId=' + this[_0x325d0f(0x240)] + '\x22'), this[_0x325d0f(0x32b)](); } catch (_0x23a228) { } this[_0x325d0f(0x2db)](); } } async['cleanOldTags']() { const _0x26ed48 = _0x1cc7ab; if (!this['world']) return; try { const _0x909bd = await this[_0x26ed48(0x327)](); for (const _0x1d203d of _0x909bd) { await this[_0x26ed48(0x229)][_0x26ed48(0x21a)](_0x26ed48(0x263) + _0x1d203d + _0x26ed48(0x1f6) + _0x1d203d + '\x22'); } const _0x6f7c9e = await this[_0x26ed48(0x229)][_0x26ed48(0x21a)](_0x26ed48(0x20e)); this[_0x26ed48(0x2bc)][_0x26ed48(0x2ad)](); if (_0x6f7c9e[_0x26ed48(0x2ce)]) _0x6f7c9e['victim'][_0x26ed48(0x30d)](_0x43a1bc => this[_0x26ed48(0x2bc)]['add'](_0x43a1bc)); } catch (_0xdaeb00) { } } [_0x1cc7ab(0x32b)]() { const _0x795411 = _0x1cc7ab; if (!this[_0x795411(0x229)]) return; const { proximity: _0x696c40, distance: _0x459167, lang: _0x69dd3d } = this[_0x795411(0x2c1)]; if (_0x69dd3d == 'ja') { let _0x522813 = _0x696c40 ? '有効' : '無効'; this[_0x795411(0x229)][_0x795411(0x328)](_0x795411(0x257) + _0x522813 + _0x795411(0x247) + _0x459167 + _0x795411(0x299))['catch'](_0x974ae1 => { }); } else { let _0x428f6a = _0x696c40 ? _0x795411(0x2da) : _0x795411(0x206); this[_0x795411(0x229)][_0x795411(0x328)](_0x795411(0x2e0) + _0x428f6a + _0x795411(0x243) + _0x459167 + _0x795411(0x274))['catch'](_0x2b8e7f => { }); } } [_0x1cc7ab(0x2cf)]() { const _0xa9f0e5 = _0x1cc7ab; this[_0xa9f0e5(0x269)] = !![], clearTimeout(this['inactivityTimer']), this['inactivityTimer'] = setTimeout(() => { const _0x2b3c92 = _0xa9f0e5; this[_0x2b3c92(0x21c)](_0x2b3c92(0x226)); }, INACTIVITY_TIMEOUT); } [_0x1cc7ab(0x266)]() { const _0x269888 = _0x1cc7ab; if (this[_0x269888(0x22f)]) return; this[_0x269888(0x22f)] = setTimeout(() => { const _0x629246 = _0x269888; if (this[_0x629246(0x229)]) this[_0x629246(0x229)][_0x629246(0x328)](this['config'][_0x629246(0x288)] === 'ja' ? _0x629246(0x31d) : '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.')[_0x629246(0x24a)](() => { }); console[_0x629246(0x264)]('\x0a======================================================='), console['log'](_0x629246(0x2b7) + this[_0x629246(0x315)] + _0x629246(0x2f2)), console[_0x629246(0x264)]('=======================================================\x0a'), setTimeout(() => this[_0x629246(0x21c)]('timeout'), 0x1388); }, MAX_RUNTIME), this[_0x269888(0x2cf)](); } async['loop']() { const _0x1a1029 = _0x1cc7ab; if (this[_0x1a1029(0x303)] || !this[_0x1a1029(0x229)]) return; try { if (this[_0x1a1029(0x269)]) this[_0x1a1029(0x2cf)](); let _0x1fe11a = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }, _0x306937 = { 'statusCode': -0x1 }; if (this[_0x1a1029(0x2c1)][_0x1a1029(0x2b1)]) { const [_0x917cba, _0x34642d, _0x1b5875, _0xb2d477, _0x5cd474] = await Promise[_0x1a1029(0x322)]([this[_0x1a1029(0x229)]['runCommand']('list'), this[_0x1a1029(0x229)][_0x1a1029(0x21a)](_0x1a1029(0x30e)), this['world']['runCommand'](_0x1a1029(0x312)), this['world'][_0x1a1029(0x21a)]('querytarget\x20@e[type=player]'), this[_0x1a1029(0x229)][_0x1a1029(0x21a)](_0x1a1029(0x2c7))]); _0x306937 = _0x5cd474; if (_0x917cba['statusCode'] <= -0x1) { this[_0x1a1029(0x27d)]++; if (this[_0x1a1029(0x27d)] >= TIMEOUT_THRESHOLD) { this[_0x1a1029(0x21c)]('success'); return; } } else this[_0x1a1029(0x27d)] = 0x0; _0x917cba['statusCode'] === 0x0 && typeof _0x917cba[_0x1a1029(0x29f)] === _0x1a1029(0x23f) && (_0x1fe11a[_0x1a1029(0x213)] = _0x917cba['players'][_0x1a1029(0x1ec)](',')[_0x1a1029(0x2b4)](_0x97db7d => _0x97db7d[_0x1a1029(0x276)]())[_0x1a1029(0x278)](_0x50678d => _0x50678d[_0x1a1029(0x24c)] > 0x0)); if (_0x34642d['victim']) _0x34642d[_0x1a1029(0x2ce)][_0x1a1029(0x30d)](_0xabbd04 => _0x1fe11a[_0x1a1029(0x1f4)][_0x1a1029(0x281)](_0xabbd04)); if (_0x1b5875[_0x1a1029(0x2ce)]) _0x1b5875[_0x1a1029(0x2ce)]['forEach'](_0x1a6526 => _0x1fe11a['spectatorSet'][_0x1a1029(0x281)](_0x1a6526)); try { _0x1fe11a['details'] = JSON[_0x1a1029(0x309)](_0xb2d477[_0x1a1029(0x323)] || '[]'); } catch (_0xfc6285) { _0x1fe11a[_0x1a1029(0x323)] = []; } } else { const [_0x163737, _0x1527cf] = await Promise[_0x1a1029(0x322)]([this[_0x1a1029(0x229)]['runCommand'](_0x1a1029(0x254)), this[_0x1a1029(0x229)][_0x1a1029(0x21a)](_0x1a1029(0x2c7))]); _0x306937 = _0x1527cf; if (_0x163737[_0x1a1029(0x2e2)] <= -0x1) { this[_0x1a1029(0x27d)]++; if (this['consecutiveTimeouts'] >= TIMEOUT_THRESHOLD) { this[_0x1a1029(0x21c)](_0x1a1029(0x236)); return; } } else this[_0x1a1029(0x27d)] = 0x0; } const _0x3f8939 = Array[_0x1a1029(0x32a)](_0x1fe11a[_0x1a1029(0x1f4)]); _0x1fe11a[_0x1a1029(0x213)][_0x1a1029(0x30d)](_0x20a804 => { const _0xad3dbc = _0x1a1029, _0x49e47f = this[_0xad3dbc(0x21e)](_0x20a804), _0xe3b1c0 = _0x1fe11a[_0xad3dbc(0x324)][_0xad3dbc(0x295)](_0x20a804); this[_0xad3dbc(0x232)][_0x49e47f] = _0xe3b1c0; if (!this[_0xad3dbc(0x2c1)]['proximity']) this[_0xad3dbc(0x2c5)][_0x49e47f] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x1fe11a[_0xad3dbc(0x1f4)][_0xad3dbc(0x295)](_0x20a804)) this['positions'][_0x49e47f] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this['config'][_0xad3dbc(0x2d4)] && _0xe3b1c0) { if (this[_0xad3dbc(0x2c1)]['specListen'] === !![]) { const _0x5a6f17 = _0x3f8939[_0xad3dbc(0x2b8)](_0x20a804); if (_0x5a6f17 !== -0x1 && _0x1fe11a[_0xad3dbc(0x323)][_0x5a6f17]) { this[_0xad3dbc(0x2c5)][_0x49e47f] = _0x1fe11a[_0xad3dbc(0x323)][_0x5a6f17][_0xad3dbc(0x2df)]; if (this[_0xad3dbc(0x2c1)]['specDim'] === !![]) this[_0xad3dbc(0x317)][_0x49e47f] = _0x1fe11a[_0xad3dbc(0x323)][_0x5a6f17]['dimension']; } else this[_0xad3dbc(0x2c5)][_0x49e47f] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this['positions'][_0x49e47f] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x4e2bdb = _0x3f8939[_0xad3dbc(0x2b8)](_0x20a804); if (_0x4e2bdb !== -0x1 && _0x1fe11a['details'][_0x4e2bdb]) this[_0xad3dbc(0x2c5)][_0x49e47f] = _0x1fe11a[_0xad3dbc(0x323)][_0x4e2bdb]['position'], this['yRots'][_0x49e47f] = _0x1fe11a['details'][_0x4e2bdb]['yRot'], this[_0xad3dbc(0x317)][_0x49e47f] = _0x1fe11a['details'][_0x4e2bdb][_0xad3dbc(0x1ed)]; else this[_0xad3dbc(0x2c5)][_0x49e47f] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this[_0x1a1029(0x294)] = !![], this['broadcastPositions'](); if (_0x306937['statusCode'] === 0x0 && !this[_0x1a1029(0x2f5)]) { this[_0x1a1029(0x2f5)] = !![]; const _0x5495f0 = _0x306937[_0x1a1029(0x2ce)][0x0]; this[_0x1a1029(0x252)](_0x5495f0)['catch'](_0x3e4a3f => { console['error']('Tag\x20processing\x20error:', _0x3e4a3f); })[_0x1a1029(0x305)](() => { const _0x30d859 = _0x1a1029; this[_0x30d859(0x2f5)] = ![]; }); } } catch (_0x46d70a) { console[_0x1a1029(0x22a)](_0x1a1029(0x249) + this[_0x1a1029(0x315)] + ']:', _0x46d70a); } if (!this[_0x1a1029(0x303)]) setTimeout(() => this['loop'](), 0x0); } async[_0x1cc7ab(0x252)](_0x2dba18) { const _0x24c1b1 = _0x1cc7ab, _0x29fe34 = await this['world'][_0x24c1b1(0x21a)](_0x24c1b1(0x296)); if (_0x29fe34['statusCode'] === 0x0 && _0x29fe34[_0x24c1b1(0x2e9)]) { let _0x1de250 = []; const _0x3b1ebc = new Player(this[_0x24c1b1(0x229)], _0x2dba18), _0x303b7b = _0x29fe34[_0x24c1b1(0x2e9)][_0x24c1b1(0x1ec)](/\r\n|\n|\r/); for (const _0x2484b4 of _0x303b7b) { if (!_0x2484b4[_0x24c1b1(0x276)]()) continue; const _0x25be55 = _0x2484b4['replace'](/§./g, ''), _0xdfcbf7 = _0x25be55[_0x24c1b1(0x2b8)](':'); _0xdfcbf7 !== -0x1 && (_0x1de250 = _0x1de250[_0x24c1b1(0x203)](_0x25be55[_0x24c1b1(0x2cd)](_0xdfcbf7 + 0x1)[_0x24c1b1(0x1ec)](',')[_0x24c1b1(0x2b4)](_0x51411e => _0x51411e[_0x24c1b1(0x276)]())['filter'](_0x41f5c1 => _0x41f5c1[_0x24c1b1(0x1e5)]('pvc:')))); for (const _0x58d62d of _0x1de250) { if (_0x58d62d === _0x24c1b1(0x31c) || _0x58d62d[_0x24c1b1(0x1e5)](_0x24c1b1(0x28d))) continue; const _0x5af7a0 = _0x58d62d['startsWith'](_0x24c1b1(0x242)) ? _0x58d62d[_0x24c1b1(0x2cd)](_0x24c1b1(0x242)[_0x24c1b1(0x24c)]) : _0x58d62d; let [_0x4dd296, ..._0x379fd0] = _0x5af7a0[_0x24c1b1(0x1ec)](':'); _0x4dd296 = '!' + _0x4dd296, this[_0x24c1b1(0x285)][_0x4dd296] && (await this[_0x24c1b1(0x285)][_0x4dd296](this[_0x24c1b1(0x229)], _0x3b1ebc, _0x379fd0), this[_0x24c1b1(0x229)][_0x24c1b1(0x21a)](_0x24c1b1(0x282) + _0x58d62d + '\x22')); } } await this[_0x24c1b1(0x229)]['runCommand'](_0x24c1b1(0x28c)); } } async[_0x1cc7ab(0x327)]() { const _0x39ccd3 = _0x1cc7ab; if (!this[_0x39ccd3(0x229)]) return []; try { const _0x11be9b = await this[_0x39ccd3(0x229)][_0x39ccd3(0x21a)]('tag\x20@a\x20list'); if (_0x11be9b[_0x39ccd3(0x2e2)] !== 0x0 || !_0x11be9b[_0x39ccd3(0x2e9)]) return []; let _0x2f6b61 = []; const _0x190d16 = _0x11be9b[_0x39ccd3(0x2e9)][_0x39ccd3(0x1ec)](/\r\n|\n|\r/); for (const _0x207fd6 of _0x190d16) { if (!_0x207fd6[_0x39ccd3(0x276)]()) continue; const _0xdc2ebf = _0x207fd6[_0x39ccd3(0x2c2)](/§./g, ''), _0x463659 = _0xdc2ebf[_0x39ccd3(0x2b8)](':'); _0x463659 !== -0x1 && (_0x2f6b61 = _0x2f6b61['concat'](_0xdc2ebf['substring'](_0x463659 + 0x1)[_0x39ccd3(0x1ec)](',')[_0x39ccd3(0x2b4)](_0x488485 => _0x488485[_0x39ccd3(0x276)]())[_0x39ccd3(0x278)](_0x72c78b => _0x72c78b[_0x39ccd3(0x1e5)]('pvc:')))); } return _0x2f6b61; } catch (_0x398007) { return []; } } [_0x1cc7ab(0x250)]() { const _0x432194 = _0x1cc7ab; if (!this[_0x432194(0x294)]) return; const _0x3707a0 = {}; for (const [_0x8fbabd, _0x1e1e5a] of Object[_0x432194(0x28b)](this['positions'])) { if (_0x1e1e5a) _0x3707a0[_0x8fbabd] = [Math[_0x432194(0x262)](_0x1e1e5a['x'] * 0x64) / 0x64, Math[_0x432194(0x262)](_0x1e1e5a['y'] * 0x64) / 0x64, Math[_0x432194(0x262)](_0x1e1e5a['z'] * 0x64) / 0x64]; } const _0x3e27c6 = { 'spec': this[_0x432194(0x2c1)][_0x432194(0x2d4)], 'spLis': this[_0x432194(0x2c1)][_0x432194(0x290)], 'spDim': this['config']['specDim'], 't': 'wu', 'pos': _0x3707a0, 'dis': this[_0x432194(0x2c1)][_0x432194(0x220)], 'pssws': this[_0x432194(0x234)], 'dim': this[_0x432194(0x317)], 'yr': this[_0x432194(0x2c9)], 'spPos': this[_0x432194(0x232)], 'prox': this[_0x432194(0x2c1)][_0x432194(0x2b1)] ? 0x1 : 0x0 }, _0x3b7580 = msgpack[_0x432194(0x2de)](_0x3e27c6); if (this[_0x432194(0x2d6)] && this[_0x432194(0x2d6)][_0x432194(0x24d)] === WebSocket['OPEN']) this[_0x432194(0x2d6)]['send'](_0x3b7580); this[_0x432194(0x20c)][_0x432194(0x30d)](_0x4892d2 => { const _0xaa902 = _0x432194; if (_0x4892d2[_0xaa902(0x24d)] === WebSocket['OPEN']) _0x4892d2[_0xaa902(0x2ed)](_0x3b7580); }); } async[_0x1cc7ab(0x2c8)](_0xda98ec) { const _0x320af7 = _0x1cc7ab, _0x4b33ab = _0xda98ec === 'mc', _0x2ba402 = _0x4b33ab ? _0x320af7(0x2f3) : _0x320af7(0x1e6); try { if (!this['roomId']) { const _0x36aaff = await fetch('https://' + RELAY_SERVER_DOMAIN + '/create-room?roomid=' + this['config'][_0x320af7(0x214)]), _0x4887de = await _0x36aaff[_0x320af7(0x2a4)](); this['roomId'] = _0x4887de[_0x320af7(0x240)]; if (this['world']) { this[_0x320af7(0x218)](), this['world']['runCommand'](_0x320af7(0x256) + this[_0x320af7(0x240)] + '\x22')[_0x320af7(0x24a)](() => { }); if (this[_0x320af7(0x2c1)]['lang'] === 'ja') await this[_0x320af7(0x229)][_0x320af7(0x328)](_0x320af7(0x215) + this[_0x320af7(0x240)]); else await this[_0x320af7(0x229)][_0x320af7(0x328)](_0x320af7(0x2dc) + this[_0x320af7(0x240)]); } } else { if (!this[_0x320af7(0x25b)]) { if (this['world']) { if (this['config'][_0x320af7(0x288)] === 'ja') await this[_0x320af7(0x229)][_0x320af7(0x328)](_0x320af7(0x215) + this[_0x320af7(0x240)]); else await this[_0x320af7(0x229)]['sendMessage'](_0x320af7(0x2dc) + this[_0x320af7(0x240)]); } } } this['useRelay'] = !![]; if (_0x4b33ab) { console[_0x320af7(0x264)]('\x0a======================================================='); if (this[_0x320af7(0x2c1)][_0x320af7(0x288)] === 'ja') this[_0x320af7(0x225)]('Minecraftから以下のコマンドで接続してください:'); else this['logInfo'](_0x320af7(0x210)); this[_0x320af7(0x225)]('/connect\x20' + RELAY_SERVER_DOMAIN + _0x320af7(0x313) + this['roomId']), this[_0x320af7(0x259)] = _0x320af7(0x1f7) + RELAY_SERVER_DOMAIN + _0x320af7(0x313) + this[_0x320af7(0x240)]; } else { this[_0x320af7(0x225)]('ROOM\x20ID:\x20' + this[_0x320af7(0x240)]); if (this[_0x320af7(0x2c1)][_0x320af7(0x288)] === 'ja') this[_0x320af7(0x225)](_0x320af7(0x287)); else this[_0x320af7(0x225)](_0x320af7(0x31b)); this[_0x320af7(0x225)](_0x320af7(0x298) + this[_0x320af7(0x240)]), console[_0x320af7(0x264)](_0x320af7(0x2c4)); } this['startTimer'](); let _0x2e2ef6; if (this[_0x320af7(0x2d6)]) { _0x2e2ef6 = this[_0x320af7(0x2d6)]; if (_0x2e2ef6['readyState'] !== WebSocket[_0x320af7(0x209)]) { } } else _0x2e2ef6 = new WebSocket(_0x320af7(0x1f5) + RELAY_SERVER_DOMAIN + _0x320af7(0x313) + this[_0x320af7(0x240)] + _0x320af7(0x2ec)), this[_0x320af7(0x2d6)] = _0x2e2ef6, _0x2e2ef6['on'](_0x320af7(0x25a), () => this[_0x320af7(0x225)](_0x320af7(0x2af) + this[_0x320af7(0x240)] + ')')), _0x2e2ef6['on'](_0x320af7(0x2bb), () => { const _0x37bee = _0x320af7; if (this['relayWs'] === _0x2e2ef6) this[_0x37bee(0x2d6)] = null; }), _0x2e2ef6['on']('error', _0x516e0c => console[_0x320af7(0x22a)](_0x2ba402 + _0x320af7(0x233), _0x516e0c)); _0x4b33ab ? (this[_0x320af7(0x1ee)] = !![], this[_0x320af7(0x2c0)](_0x2e2ef6), this['connectToRelayServer']('vc')) : (this[_0x320af7(0x231)] = !![], this['setupVcRelayListeners'](_0x2e2ef6)); } catch (_0x16a5e0) { console[_0x320af7(0x22a)](_0x2ba402 + '\x20Error:', _0x16a5e0); } } [_0x1cc7ab(0x2bd)](_0x36be62) { const _0x1f65f2 = _0x1cc7ab, { app_id: _0x25b386, secret_key: _0x4696a9, proximity: _0x3be078, distance: _0x2f5611, spectator: _0x235ccd, specListen: _0xb886ca, specDim: _0x129be5, verify: _0x23a138, password: _0x451ac2 } = this['config']; _0x36be62['send'](msgpack[_0x1f65f2(0x2de)]({ 'password': !!(_0x23a138 || _0x451ac2), 'passwords': this[_0x1f65f2(0x234)], 'app_id': _0x25b386, 'secret_key': _0x4696a9, 'proximity': _0x3be078, 'distance': _0x2f5611, 'spectator': _0x235ccd, 'specListen': _0xb886ca, 'specDim': _0x129be5 })); } [_0x1cc7ab(0x2ab)](_0x39385d) { const _0x55fd4e = _0x1cc7ab; _0x39385d['on'](_0x55fd4e(0x26e), async _0x16683a => { const _0x27ebf1 = _0x55fd4e; try { const _0x189193 = JSON[_0x27ebf1(0x309)](_0x16683a['toString']()); if (_0x189193['type'] === _0x27ebf1(0x27b)) { this[_0x27ebf1(0x2bd)](_0x39385d); return; } if (_0x189193[_0x27ebf1(0x1fe)] === _0x27ebf1(0x273)) { if (this[_0x27ebf1(0x229)]) await this['world'][_0x27ebf1(0x21a)](_0x189193[_0x27ebf1(0x29b)]); } } catch (_0x226d3e) { } }); } [_0x1cc7ab(0x2c0)](_0xb2a52c) { const _0x298fd3 = _0x1cc7ab; _0xb2a52c['on']('message', async _0x176a0e => { const _0x61908c = _0x36f6; let _0x85b794 = _0x176a0e; try { Buffer[_0x61908c(0x201)](_0x176a0e) && _0x176a0e[_0x61908c(0x24c)] > 0x2 && _0x176a0e[0x0] === 0x1f && _0x176a0e[0x1] === 0x8b && (_0x85b794 = zlib[_0x61908c(0x2e5)](_0x176a0e)); } catch (_0x509948) { } try { const _0x817a98 = JSON['parse'](_0x85b794['toString']()); if (_0x817a98[_0x61908c(0x2a1)] === _0x61908c(0x27b)) { const _0x5b19f5 = _0x817a98[_0x61908c(0x318)] || _0x61908c(0x306); _0x5b19f5 === _0x61908c(0x306) ? (this['localClient'] = new WebSocket(_0x61908c(0x27a) + this[_0x61908c(0x2c1)][_0x61908c(0x283)], { 'headers': { 'x-proxvc-session': this['id'] } }), this[_0x61908c(0x245)] = [], this[_0x61908c(0x2a7)]['on'](_0x61908c(0x25a), () => { const _0x3ae861 = _0x61908c; while (this[_0x3ae861(0x245)][_0x3ae861(0x24c)] > 0x0) { const _0x51bb16 = this[_0x3ae861(0x245)][_0x3ae861(0x2e6)](); this[_0x3ae861(0x2a7)][_0x3ae861(0x2ed)](_0x51bb16); } }), this[_0x61908c(0x2a7)]['on'](_0x61908c(0x26e), _0x23d391 => _0xb2a52c[_0x61908c(0x24d)] === WebSocket[_0x61908c(0x209)] && _0xb2a52c[_0x61908c(0x2ed)](_0x23d391)), this['localClient']['on'](_0x61908c(0x2bb), (_0x2a9a1a, _0x1c0d56) => { const _0x166d25 = _0x61908c; if (_0xb2a52c['readyState'] === WebSocket[_0x166d25(0x209)]) _0xb2a52c[_0x166d25(0x2bb)](); }), this[_0x61908c(0x2a7)]['on'](_0x61908c(0x22a), _0x2b34de => console[_0x61908c(0x22a)](_0x61908c(0x222) + _0x2b34de[_0x61908c(0x26e)]))) : this[_0x61908c(0x2bd)](_0xb2a52c); return; } else { if (_0x817a98['type'] === 'partner_disconnected') { this['localClient'] && (this[_0x61908c(0x2a7)][_0x61908c(0x2bb)](), this['localClient'] = null); return; } else { if (_0x817a98['type'] === _0x61908c(0x272)) { console[_0x61908c(0x264)](_0x61908c(0x2fd)); try { let _0x576216 = _0x817a98[_0x61908c(0x22c)]; _0x576216 && _0x576216[_0x61908c(0x2a1)] === 'Buffer' && (_0x576216 = Buffer['from'](_0x576216['data'])); try { const _0x395524 = msgpack['decode'](_0x576216); if (_0x395524) { if (_0x395524[_0x61908c(0x1fe)] === _0x61908c(0x273) && typeof _0x395524[_0x61908c(0x29b)] === _0x61908c(0x23f)) { if (this[_0x61908c(0x229)]) this[_0x61908c(0x229)][_0x61908c(0x21a)](_0x395524[_0x61908c(0x29b)])['catch'](() => { }); } else { if (_0x395524[_0x61908c(0x28e)] && _0x395524[_0x61908c(0x2df)]) this['positions'][_0x395524[_0x61908c(0x28e)]] = _0x395524[_0x61908c(0x2df)]; else _0x395524[_0x61908c(0x2a1)] === 'partner_connected' && this[_0x61908c(0x2bd)](_0xb2a52c); } } } catch (_0xe1b862) { const _0x3b8aec = JSON[_0x61908c(0x309)](_0x576216[_0x61908c(0x2ee)]()); if (_0x3b8aec[_0x61908c(0x1fe)] === _0x61908c(0x273)) { if (this['world']) this[_0x61908c(0x229)][_0x61908c(0x21a)](_0x3b8aec['value'])[_0x61908c(0x24a)](() => { }); } } } catch (_0x3281af) { } return; } } } if (_0x817a98[_0x61908c(0x2a1)] === _0x61908c(0x265)) this[_0x61908c(0x2d8)](_0x817a98); } catch (_0x58ef90) { } if (this[_0x61908c(0x2a7)]?.[_0x61908c(0x24d)] === WebSocket[_0x61908c(0x209)]) this[_0x61908c(0x2a7)]['send'](_0x85b794); else this[_0x61908c(0x2a7)]?.[_0x61908c(0x24d)] === WebSocket[_0x61908c(0x20d)] && this[_0x61908c(0x245)]['push'](_0x85b794); }), _0xb2a52c['on'](_0x298fd3(0x2bb), () => this[_0x298fd3(0x2a7)]?.['close']()); } [_0x1cc7ab(0x28f)]() { const _0x18912d = _0x1cc7ab, _0x58dd67 = (_0x441f5c, _0x4277d6, _0xa27a3f) => async (_0x37e68f, _0x5d5f39, _0xf05d44) => { const _0x227d6d = _0x36f6; if (_0x5d5f39[_0x227d6d(0x20a)] !== _0x37e68f[_0x227d6d(0x301)][_0x227d6d(0x20a)]) return; if (_0xf05d44[0x0] !== _0x227d6d(0x1fb) && _0xf05d44[0x0] !== _0x227d6d(0x1eb)) return; const _0x323978 = _0xf05d44[0x0] === _0x227d6d(0x1fb); this[_0x227d6d(0x2c1)][_0x441f5c] = _0x323978; if (_0x441f5c === 'verify') this[_0x227d6d(0x2c1)][_0x227d6d(0x268)] = _0x323978; updateConfigFile(_0x441f5c, _0x323978); const _0xe4088d = this[_0x227d6d(0x2c1)][_0x227d6d(0x288)] === 'ja' ? _0x323978 ? _0x4277d6[_0x227d6d(0x2da)] : _0x4277d6[_0x227d6d(0x206)] : _0x323978 ? _0xa27a3f[_0x227d6d(0x2da)] : _0xa27a3f[_0x227d6d(0x206)], _0x1f16f1 = this['config']['lang'] === 'ja' ? _0x227d6d(0x207) : '<Proximity\x20VC>'; if (this[_0x227d6d(0x2c1)][_0x227d6d(0x23b)]) await _0x37e68f['sendMessage'](_0x1f16f1 + _0xe4088d); }; return { '!dis': async (_0x231eef, _0x5759bb, _0x53b030) => { const _0x93d7fe = _0x36f6; if (_0x5759bb[_0x93d7fe(0x20a)] !== _0x231eef[_0x93d7fe(0x301)][_0x93d7fe(0x20a)]) return; const _0xde791 = Number(_0x53b030[0x0]); if (!isNaN(_0xde791)) { this['config'][_0x93d7fe(0x220)] = _0xde791, updateConfigFile('distance', _0xde791); const _0x3c542e = this[_0x93d7fe(0x2c1)]['lang'] === 'ja' ? _0x93d7fe(0x29a) + _0xde791 + 'に変更しました' : '<Proximity\x20VC>Changed\x20max\x20distance\x20to\x20' + _0xde791; if (this[_0x93d7fe(0x2c1)]['output']) await _0x231eef['sendMessage'](_0x3c542e); } }, '!name': async (_0x36d196, _0x175718) => { const _0x34da80 = _0x36f6, _0x512ab6 = this['processName'](_0x175718[_0x34da80(0x20a)]), _0xee1db7 = _0x34da80(0x284) + this[_0x34da80(0x240)] + 'です\x0aあなたのVCnameは' + _0x512ab6 + 'です', _0x39473d = _0x34da80(0x30f) + this[_0x34da80(0x240)] + _0x34da80(0x228) + _0x512ab6; await _0x175718[_0x34da80(0x328)](this[_0x34da80(0x2c1)]['lang'] === 'ja' ? _0xee1db7 : _0x39473d); if (this[_0x34da80(0x2c1)][_0x34da80(0x268)]) { !this[_0x34da80(0x234)][_0x512ab6] && (this[_0x34da80(0x234)][_0x512ab6] = Math[_0x34da80(0x2d3)](0x3e8 + Math['random']() * 0x2328)['toString']()); const _0x4db329 = this['config']['lang'] === 'ja' ? _0x34da80(0x248) + this[_0x34da80(0x234)][_0x512ab6] + 'です' : _0x34da80(0x2be) + this[_0x34da80(0x234)][_0x512ab6]; await _0x175718['sendMessage'](_0x4db329); } }, '!output': _0x58dd67('output', { 'enabled': _0x18912d(0x2ff), 'disabled': _0x18912d(0x2b6) }, { 'enabled': _0x18912d(0x253), 'disabled': _0x18912d(0x2d9) }), '!password': _0x58dd67('verify', { 'enabled': '認証コードを有効にしました', 'disabled': '認証コードを無効にしました' }, { 'enabled': 'verify\x20code\x20enabled', 'disabled': _0x18912d(0x26d) }), '!verify': _0x58dd67('verify', { 'enabled': _0x18912d(0x2c6), 'disabled': _0x18912d(0x23c) }, { 'enabled': _0x18912d(0x292), 'disabled': 'verify\x20code\x20disabled' }), '!pvc': _0x58dd67('proximity', { 'enabled': _0x18912d(0x205), 'disabled': _0x18912d(0x302) }, { 'enabled': _0x18912d(0x219), 'disabled': 'Proximity\x20VC\x20disabled' }), '!spectator': _0x58dd67(_0x18912d(0x2d4), { 'enabled': _0x18912d(0x1f2), 'disabled': _0x18912d(0x223) }, { 'enabled': 'Spectator\x20and\x20VC\x20separated', 'disabled': _0x18912d(0x304) }), '!specListen': _0x58dd67(_0x18912d(0x290), { 'enabled': _0x18912d(0x2eb), 'disabled': _0x18912d(0x2d5) }, { 'enabled': 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', 'disabled': _0x18912d(0x24e) }), '!specDim': _0x58dd67(_0x18912d(0x20f), { 'enabled': _0x18912d(0x31f), 'disabled': _0x18912d(0x2b2) }, { 'enabled': 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', 'disabled': _0x18912d(0x2dd) }), '!lang': async (_0x59d31d, _0xea091e, _0x4e19e7) => { const _0x3fd513 = _0x18912d; if (_0xea091e['name'] !== _0x59d31d[_0x3fd513(0x301)]['name']) return; const _0x485d37 = _0x4e19e7[0x0] === 'ja' ? 'ja' : 'en'; this[_0x3fd513(0x2c1)][_0x3fd513(0x288)] = _0x485d37, updateConfigFile('lang', _0x485d37), await _0x59d31d[_0x3fd513(0x328)](_0x485d37 === 'ja' ? _0x3fd513(0x217) : _0x3fd513(0x1fa)); }, '!config': async (_0x3ac0e0, _0x58a80a) => { const _0x4b1ac1 = _0x18912d; if (_0x58a80a['name'] !== _0x3ac0e0[_0x4b1ac1(0x301)][_0x4b1ac1(0x20a)]) return; const { proximity: _0x12f6d8, distance: _0x312726, password: _0x298eb3, spectator: _0x4bdeb6, specListen: _0x24a814, specDim: _0xbe1a34, lang: _0x223891, output: _0x453994 } = this[_0x4b1ac1(0x2c1)], _0x29b19d = _0x223891 === 'ja' ? _0x4b1ac1(0x31e) : '§aEnabled§r', _0x5d02b2 = _0x223891 === 'ja' ? _0x4b1ac1(0x24b) : _0x4b1ac1(0x2ba), _0x32ecec = _0x5cd69b => _0x5cd69b ? _0x29b19d : _0x5d02b2; let _0x3167bb = _0x223891 === 'ja' ? _0x4b1ac1(0x1fd) + _0x223891 + '\x0a近接VC\x20(Proximity):\x20' + _0x32ecec(_0x12f6d8) + _0x4b1ac1(0x2ea) + _0x312726 + _0x4b1ac1(0x310) + _0x32ecec(_0x298eb3) + _0x4b1ac1(0x227) + _0x32ecec(_0x453994) + '\x0aスペクテイター分離\x20(Spectator):\x20' + _0x32ecec(_0x4bdeb6) + '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20' + _0x32ecec(_0x24a814) + _0x4b1ac1(0x241) + _0x32ecec(_0xbe1a34) : _0x4b1ac1(0x23a) + _0x223891 + _0x4b1ac1(0x1ea) + _0x32ecec(_0x12f6d8) + _0x4b1ac1(0x2a9) + _0x312726 + '§r\x0aVerify\x20Code:\x20' + _0x32ecec(_0x298eb3) + _0x4b1ac1(0x26f) + _0x32ecec(_0x453994) + _0x4b1ac1(0x1e8) + _0x32ecec(_0x4bdeb6) + '\x0a\x20-\x20Spectator\x20Listen:\x20' + _0x32ecec(_0x24a814) + '\x0a\x20-\x20Spectator\x20Dimension:\x20' + _0x32ecec(_0xbe1a34); await _0x58a80a[_0x4b1ac1(0x328)](_0x3167bb); }, '!help': async (_0x363103, _0x38f351) => { const _0x33b3b9 = _0x18912d, { lang: _0x452826 } = this[_0x33b3b9(0x2c1)]; await _0x38f351[_0x33b3b9(0x328)]('--------------------'), _0x452826 == 'ja' ? (await _0x38f351[_0x33b3b9(0x328)]('コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます'), _0x38f351[_0x33b3b9(0x20a)] == _0x363103[_0x33b3b9(0x301)][_0x33b3b9(0x20a)] && (await _0x38f351[_0x33b3b9(0x328)](_0x33b3b9(0x2a8)), await _0x38f351[_0x33b3b9(0x328)](_0x33b3b9(0x2c3)), await _0x38f351[_0x33b3b9(0x328)](_0x33b3b9(0x286)))) : (await _0x38f351[_0x33b3b9(0x328)](_0x33b3b9(0x2f8)), _0x38f351[_0x33b3b9(0x20a)] == _0x363103['localPlayer'][_0x33b3b9(0x20a)] && (await _0x38f351[_0x33b3b9(0x328)](_0x33b3b9(0x2b5)), await _0x38f351[_0x33b3b9(0x328)]('\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20information\x20output\x20to\x20minecraft\x20chat\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC'), await _0x38f351[_0x33b3b9(0x328)]('Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension'))), await _0x38f351['sendMessage'](_0x33b3b9(0x31a)); } }; } [_0x1cc7ab(0x2d8)](_0x48e1e9) { const _0x508017 = _0x1cc7ab; if (this[_0x508017(0x231)]) this[_0x508017(0x250)](); if (this[_0x508017(0x269)]) this[_0x508017(0x2cf)](); for (const [_0x56b5bd, _0x54e91a] of Object[_0x508017(0x28b)](_0x48e1e9)) { if (_0x56b5bd === _0x508017(0x2a1)) continue; if ([_0x508017(0x2c5), 'proximity', _0x508017(0x220), 'spectator', _0x508017(0x232), _0x508017(0x290), _0x508017(0x20f), _0x508017(0x317), 'yRots', _0x508017(0x268), _0x508017(0x288)][_0x508017(0x297)](_0x56b5bd)) { if (['positions', _0x508017(0x232), _0x508017(0x317), _0x508017(0x2c9)][_0x508017(0x297)](_0x56b5bd)) this[_0x56b5bd] = _0x54e91a; else this['config'][_0x56b5bd] = _0x54e91a; } } } [_0x1cc7ab(0x260)](_0x42e5f2) { const _0x3b10a6 = _0x1cc7ab; this[_0x3b10a6(0x229)] = _0x42e5f2, this[_0x3b10a6(0x289)](), this[_0x3b10a6(0x221)] && (clearTimeout(this[_0x3b10a6(0x221)]), this[_0x3b10a6(0x221)] = null), this[_0x3b10a6(0x25b)] && this['roomId'] && this[_0x3b10a6(0x229)][_0x3b10a6(0x21a)](_0x3b10a6(0x256) + this[_0x3b10a6(0x240)] + '\x22')[_0x3b10a6(0x24a)](() => { }); } [_0x1cc7ab(0x21c)](_0x435175 = _0x1cc7ab(0x236)) { const _0x34ef8f = _0x1cc7ab, _0x16081b = this['worldName']; this[_0x34ef8f(0x225)]('Session\x20destroying...\x20Reason:\x20' + _0x435175), this['stop_roop'] = !![]; this[_0x34ef8f(0x221)] && (clearTimeout(this[_0x34ef8f(0x221)]), this[_0x34ef8f(0x221)] = null); this[_0x34ef8f(0x22f)] && (clearTimeout(this[_0x34ef8f(0x22f)]), this[_0x34ef8f(0x22f)] = null); const _0x189ce4 = msgpack[_0x34ef8f(0x2de)]({ 't': _0x34ef8f(0x2a6), 'type': _0x34ef8f(0x238) }); this[_0x34ef8f(0x2d6)] && (this[_0x34ef8f(0x2d6)][_0x34ef8f(0x2ed)](_0x189ce4), this[_0x34ef8f(0x2d6)][_0x34ef8f(0x2bb)](), this['relayWs'] = null); this[_0x34ef8f(0x2a7)] && (this[_0x34ef8f(0x2a7)][_0x34ef8f(0x2bb)](), this[_0x34ef8f(0x2a7)] = null); this[_0x34ef8f(0x27c)] && (this[_0x34ef8f(0x27c)][_0x34ef8f(0x244)](), this[_0x34ef8f(0x27c)] = null); this[_0x34ef8f(0x311)] = null, this[_0x34ef8f(0x251)] = null, this[_0x34ef8f(0x20c)][_0x34ef8f(0x30d)](_0x17e6d9 => _0x17e6d9[_0x34ef8f(0x2bb)]()), this[_0x34ef8f(0x20c)][_0x34ef8f(0x2ad)](); if (typeof this[_0x34ef8f(0x218)] === _0x34ef8f(0x28a)) this['cleanOldTags']()[_0x34ef8f(0x2cb)](() => { const _0x45eb22 = _0x34ef8f; sessionHistory[_0x45eb22(0x2f4)](this['id'], { 'reason': _0x435175, 'timestamp': Date[_0x45eb22(0x1f1)]() }), sessions[_0x45eb22(0x21f)](this[_0x45eb22(0x229)]), pendingSessions[_0x45eb22(0x21f)](this['id']); }); else { sessionHistory['set'](this['id'], { 'reason': _0x435175, 'timestamp': Date[_0x34ef8f(0x1f1)]() }); if (sessionHistory['size'] > 0x64) { const _0x48c5fc = sessionHistory[_0x34ef8f(0x307)]()[_0x34ef8f(0x314)]()[_0x34ef8f(0x29b)]; sessionHistory['delete'](_0x48c5fc); } sessions[_0x34ef8f(0x21f)](this['world']), pendingSessions['delete'](this['id']); } } } function _0x36f6(_0x317d88, _0x450983) { _0x317d88 = _0x317d88 - 0x1e5; const _0x467734 = _0x4677(); let _0x36f641 = _0x467734[_0x317d88]; return _0x36f641; } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x3942dd = _0x1cc7ab; let _0x2a3321 = INITIAL_CONFIG[_0x3942dd(0x283)], _0x331a34 = INITIAL_CONFIG[_0x3942dd(0x2e8)]; _0x2a3321 = await getPort({ 'port': [_0x2a3321, ...makeRange(0x4abd, 0x4b20)] }), _0x331a34 = await getPort({ 'port': [_0x331a34, ...makeRange(0x1f41, 0x1fa4)] }), console[_0x3942dd(0x264)](_0x3942dd(0x1e9) + _0x2a3321), console[_0x3942dd(0x264)](_0x3942dd(0x1fc) + _0x331a34), INITIAL_CONFIG['port'] = _0x2a3321, INITIAL_CONFIG[_0x3942dd(0x2e8)] = _0x331a34, globalConfig[_0x3942dd(0x283)] = _0x2a3321, globalConfig[_0x3942dd(0x2e8)] = _0x331a34, setupGlobalVcWebSocket(_0x331a34); const _0x8612f8 = express(), _0x27d382 = http[_0x3942dd(0x1ef)](_0x8612f8); _0x27d382['listen'](_0x2a3321); const _0x947d32 = new Server({ 'webSocketOptions': { 'server': _0x27d382 } }); _0x8612f8[_0x3942dd(0x2b3)](express[_0x3942dd(0x2a4)]()), _0x8612f8[_0x3942dd(0x275)](_0x3942dd(0x2a2), async (_0xe8dd3e, _0x40db91) => { const _0xd64c03 = _0x3942dd; try { const _0x5de801 = _0xe8dd3e[_0xd64c03(0x1ff)]['config'] || {}, _0x537689 = new Session(null, _0x5de801); await _0x537689[_0xd64c03(0x2e3)](), pendingSessions['set'](_0x537689['id'], _0x537689), _0x40db91['json']({ 'sessionId': _0x537689['id'], 'roomId': _0x537689[_0xd64c03(0x240)], 'connectCommand': _0x537689[_0xd64c03(0x259)] }), _0x537689[_0xd64c03(0x266)](); } catch (_0xd2e28f) { console['error'](_0xd2e28f), _0x40db91['status'](0x1f4)[_0xd64c03(0x2a4)]({ 'error': _0xd2e28f[_0xd64c03(0x26e)] }); } }), _0x8612f8['post'](_0x3942dd(0x2fc), (_0x55cf79, _0x244cf5) => { const _0x19ed50 = _0x3942dd, { sessionId: _0x3e5c31 } = _0x55cf79[_0x19ed50(0x1ff)], _0x5ae407 = pendingSessions[_0x19ed50(0x23e)](_0x3e5c31) || Array[_0x19ed50(0x32a)](sessions[_0x19ed50(0x211)]())[_0x19ed50(0x237)](_0x3df4ce => _0x3df4ce['id'] === _0x3e5c31); _0x5ae407 ? (_0x5ae407[_0x19ed50(0x21c)](_0x19ed50(0x236)), _0x244cf5[_0x19ed50(0x2a4)]({ 'success': !![] })) : _0x244cf5[_0x19ed50(0x2d1)](0x194)[_0x19ed50(0x2a4)]({ 'error': _0x19ed50(0x2d7) }); }), _0x8612f8[_0x3942dd(0x23e)](_0x3942dd(0x22e), (_0x559830, _0x3005b1) => { const _0x2521da = _0x3942dd, _0x573902 = _0x559830[_0x2521da(0x30a)]['id'], _0x2aa32a = pendingSessions[_0x2521da(0x23e)](_0x573902) || Array[_0x2521da(0x32a)](sessions['values']())[_0x2521da(0x237)](_0x5d39eb => _0x5d39eb['id'] === _0x573902); if (_0x2aa32a) _0x3005b1[_0x2521da(0x2a4)]({ 'status': _0x2521da(0x2a0), 'sshError': _0x2aa32a[_0x2521da(0x2f7)] }); else { if (sessionHistory[_0x2521da(0x295)](_0x573902)) { const _0x5c8eb2 = sessionHistory['get'](_0x573902); _0x3005b1[_0x2521da(0x2a4)]({ 'status': _0x2521da(0x321), 'reason': _0x5c8eb2[_0x2521da(0x2f1)], 'timestamp': _0x5c8eb2['timestamp'] }); } else _0x3005b1['json']({ 'status': _0x2521da(0x25d) }); } }); const _0x11561e = (_0x192d4f, _0x71a873) => { const _0x44de44 = _0x3942dd, { type: _0x3d2599 } = _0x192d4f['body'], _0x3547f6 = _0x192d4f[_0x44de44(0x326)][_0x44de44(0x2ae)]; let _0x432fab = null; if (_0x3547f6) { for (const _0x5e54c4 of sessions[_0x44de44(0x211)]()) { const _0x32042d = _0x5e54c4['config'][_0x44de44(0x214)]; if (_0x32042d && _0x3547f6[_0x44de44(0x1e5)](_0x32042d)) { _0x432fab = _0x5e54c4; break; } } if (!_0x432fab) for (const _0x51b838 of pendingSessions['values']()) { const _0x28f213 = _0x51b838[_0x44de44(0x2c1)][_0x44de44(0x214)]; if (_0x28f213 && _0x3547f6[_0x44de44(0x1e5)](_0x28f213)) { _0x432fab = _0x51b838; break; } } } if (_0x432fab) { if (_0x3d2599 === 'data_update') _0x432fab[_0x44de44(0x2d8)](_0x192d4f['body']); else { if (_0x3d2599 === _0x44de44(0x2a3)) _0x432fab[_0x44de44(0x21c)](_0x44de44(0x236)); } _0x3d2599 === _0x44de44(0x2b9) ? (_0x432fab['vc_connected'] = !![], _0x432fab[_0x44de44(0x225)]('接続開始'), _0x71a873[_0x44de44(0x2d1)](0xc8)[_0x44de44(0x2a4)]({ 'type': _0x44de44(0x2b9), 'roomId': _0x432fab['roomId'], 'ws_connected': _0x432fab[_0x44de44(0x1ee)], ..._0x432fab[_0x44de44(0x2c1)] })) : _0x71a873[_0x44de44(0x2d1)](0xc8)[_0x44de44(0x2a4)]({ 'success': !![] }); } else { sessions['forEach'](_0x256e65 => { const _0x569ac5 = _0x44de44; if (_0x3d2599 === _0x569ac5(0x265)) _0x256e65[_0x569ac5(0x2d8)](_0x192d4f[_0x569ac5(0x1ff)]); else { if (_0x3d2599 === 'disconnect_command') _0x256e65['destroy']('success'); } }); const _0xfe2c86 = sessions[_0x44de44(0x211)]()['next']()['value'] || pendingSessions[_0x44de44(0x211)]()['next']()[_0x44de44(0x29b)]; _0xfe2c86 ? _0x3d2599 === _0x44de44(0x2b9) ? (_0xfe2c86['vc_connected'] = !![], _0xfe2c86['logInfo'](_0x44de44(0x216)), _0x71a873[_0x44de44(0x2d1)](0xc8)[_0x44de44(0x2a4)]({ 'type': _0x44de44(0x2b9), 'roomId': _0xfe2c86['roomId'], 'ws_connected': _0xfe2c86['mc_connected'], ..._0xfe2c86['config'] })) : _0x71a873['status'](0xc8)[_0x44de44(0x2a4)]({ 'success': !![] }) : _0x71a873[_0x44de44(0x2d1)](0xc8)[_0x44de44(0x2a4)]({ 'error': _0x44de44(0x280) }); } }; _0x8612f8[_0x3942dd(0x275)]('/', _0x11561e), _0x947d32['on'](ServerEvent[_0x3942dd(0x2d0)], ({ world: _0x217541 }) => { const _0x1d9715 = _0x3942dd, _0x2f3f4c = _0x217541[_0x1d9715(0x2fe)], _0x10d972 = _0x217541['pvcDomain']; let _0x5c09e6 = Array[_0x1d9715(0x32a)](sessions[_0x1d9715(0x211)]())['find'](_0x1dc2f0 => _0x1dc2f0['id'] === _0x2f3f4c); !_0x5c09e6 && _0x2f3f4c && (_0x5c09e6 = pendingSessions[_0x1d9715(0x23e)](_0x2f3f4c)); if (!_0x5c09e6 && _0x10d972) { _0x5c09e6 = Array[_0x1d9715(0x32a)](pendingSessions['values']())['find'](_0x24bb79 => { const _0x64b861 = _0x1d9715, _0x599721 = _0x24bb79[_0x64b861(0x2c1)][_0x64b861(0x214)]; if (_0x599721 && _0x10d972[_0x64b861(0x1e5)](_0x599721)) return !![]; return ![]; }); if (_0x5c09e6) { } } if (_0x5c09e6) pendingSessions[_0x1d9715(0x295)](_0x5c09e6['id']) && pendingSessions['delete'](_0x5c09e6['id']), sessions[_0x1d9715(0x2f4)](_0x217541, _0x5c09e6), _0x5c09e6[_0x1d9715(0x260)](_0x217541); else { if (_0x10d972 && INITIAL_CONFIG[_0x1d9715(0x214)] && !_0x10d972[_0x1d9715(0x1e5)](INITIAL_CONFIG['sub_domain'])) { console[_0x1d9715(0x2ac)]('[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27' + _0x10d972 + '\x27'); return; } _0x5c09e6 = new Session(_0x217541), sessions['set'](_0x217541, _0x5c09e6), _0x5c09e6['init'](); } }), _0x947d32['on'](ServerEvent[_0x3942dd(0x2f0)], ({ world: _0x4092a3 }) => { const _0x19c130 = _0x3942dd, _0x343c11 = sessions[_0x19c130(0x23e)](_0x4092a3); if (_0x343c11) { sessions[_0x19c130(0x21f)](_0x4092a3); !pendingSessions[_0x19c130(0x295)](_0x343c11['id']) && pendingSessions['set'](_0x343c11['id'], _0x343c11); if (_0x343c11[_0x19c130(0x221)]) clearTimeout(_0x343c11[_0x19c130(0x221)]); _0x343c11['pendingTimeout'] = setTimeout(() => { const _0x17d8f3 = _0x19c130; pendingSessions['has'](_0x343c11['id']) && _0x343c11['destroy'](_0x17d8f3(0x236)); }, 0x7530); } }), _0x947d32['on'](ServerEvent[_0x3942dd(0x208)], async ({ sender: _0x37b45c, message: _0x59be90, world: _0x42c3e0 }) => { const _0x2bb13c = _0x3942dd, _0x454617 = sessions[_0x2bb13c(0x23e)](_0x42c3e0); if (_0x454617) { const [_0x4d7e9e, ..._0x28531e] = _0x59be90[_0x2bb13c(0x1ec)]('\x20'); if (_0x454617[_0x2bb13c(0x285)][_0x4d7e9e]) await _0x454617[_0x2bb13c(0x285)][_0x4d7e9e](_0x42c3e0, _0x37b45c, _0x28531e); } }), _0x947d32['on'](ServerEvent[_0x3942dd(0x212)], async ({ player: _0x51df1c, world: _0x511a55 }) => { const _0x1e5934 = _0x3942dd, _0x3a6e32 = sessions['get'](_0x511a55); _0x3a6e32 && (_0x3a6e32[_0x1e5934(0x225)]('参加:\x20' + _0x51df1c[_0x1e5934(0x20a)]), _0x3a6e32['onlinePlayers'][_0x1e5934(0x281)](_0x51df1c[_0x1e5934(0x20a)]), setTimeout(async () => { const _0x3708cb = _0x1e5934; try { const _0xc7065b = _0x3a6e32['processName'](_0x51df1c[_0x3708cb(0x20a)]), { roomId: _0xdc03bc, passwords: _0x361bed, config: _0x20651a } = _0x3a6e32, _0x3e696c = _0x3708cb(0x30c) + _0xdc03bc + _0x3708cb(0x22d) + _0xc7065b + 'です', _0x38a05e = 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20' + _0xdc03bc + '\x0aYour\x20VCname\x20is\x20' + _0xc7065b; await _0x51df1c['sendMessage'](_0x20651a[_0x3708cb(0x288)] === 'ja' ? _0x3e696c : _0x38a05e); if (_0x20651a[_0x3708cb(0x268)]) { if (!_0x361bed[_0xc7065b]) _0x361bed[_0xc7065b] = Math['floor'](0x3e8 + Math[_0x3708cb(0x1f9)]() * 0x2328)[_0x3708cb(0x2ee)](); const _0x65481d = _0x20651a[_0x3708cb(0x288)] === 'ja' ? _0x3708cb(0x300) + _0x361bed[_0xc7065b] + 'です' : 'Password\x20is\x20' + _0x361bed[_0xc7065b]; await _0x51df1c['sendMessage'](_0x65481d); } } catch (_0x7e7a57) { } }, 0x1f4)); }), _0x947d32['on'](ServerEvent['PlayerLeave'], ({ player: _0x2d76c1, world: _0x535e30 }) => { const _0x2e048a = _0x3942dd, _0x45e48c = sessions[_0x2e048a(0x23e)](_0x535e30); if (_0x45e48c) { _0x45e48c[_0x2e048a(0x225)](_0x2e048a(0x2a5) + _0x2d76c1[_0x2e048a(0x20a)]); _0x2d76c1[_0x2e048a(0x20a)] === _0x535e30[_0x2e048a(0x301)][_0x2e048a(0x20a)] && (_0x45e48c[_0x2e048a(0x225)](_0x2e048a(0x271)), _0x45e48c['destroy'](_0x2e048a(0x236))); _0x45e48c[_0x2e048a(0x2bc)][_0x2e048a(0x21f)](_0x2d76c1[_0x2e048a(0x20a)]); const _0x388a7d = _0x45e48c[_0x2e048a(0x21e)](_0x2d76c1['name']); delete _0x45e48c[_0x2e048a(0x2c5)][_0x388a7d], delete _0x45e48c[_0x2e048a(0x317)][_0x388a7d], delete _0x45e48c[_0x2e048a(0x2c9)][_0x388a7d], delete _0x45e48c['spectators'][_0x388a7d]; } }), _0x947d32['on'](ServerEvent[_0x3942dd(0x25e)], ({ player: _0x47066c, world: _0x341c02 }) => { const _0x374aad = _0x3942dd, _0x4af380 = sessions[_0x374aad(0x23e)](_0x341c02); if (!_0x4af380 || !_0x47066c || !_0x47066c['position']) return; const _0x50f326 = _0x4af380[_0x374aad(0x21e)](_0x47066c[_0x374aad(0x20a)]); _0x4af380['positions'][_0x50f326] = { 'x': _0x47066c[_0x374aad(0x2df)]['x'], 'y': _0x47066c[_0x374aad(0x2df)]['y'], 'z': _0x47066c[_0x374aad(0x2df)]['z'] }; if (_0x47066c[_0x374aad(0x2f9)] !== undefined) _0x4af380[_0x374aad(0x2c9)][_0x50f326] = _0x47066c[_0x374aad(0x2f9)]; if (_0x47066c[_0x374aad(0x1ed)] !== undefined) _0x4af380['dimensions'][_0x50f326] = _0x47066c[_0x374aad(0x1ed)]; }); if (!process[_0x3942dd(0x239)][_0x3942dd(0x297)](_0x3942dd(0x200))) try { const _0xa2d748 = new Session(null, globalConfig); await _0xa2d748[_0x3942dd(0x2e3)](), pendingSessions[_0x3942dd(0x2f4)](_0xa2d748['id'], _0xa2d748); } catch (_0x13b108) { console[_0x3942dd(0x22a)](_0x3942dd(0x329), _0x13b108); } else try { fs[_0x3942dd(0x230)]('server_info.json', JSON[_0x3942dd(0x319)]({ 'port': _0x2a3321, 'web_port': _0x331a34 }, null, 0x2)); } catch (_0x1aeaba) { console[_0x3942dd(0x22a)](_0x3942dd(0x2d2), _0x1aeaba); } } process['on'](_0x1cc7ab(0x26a), () => { const _0x2b9c91 = _0x1cc7ab; sessions[_0x2b9c91(0x30d)](_0xd2dae2 => _0xd2dae2[_0x2b9c91(0x21c)]()), process[_0x2b9c91(0x2ef)](); }), main();