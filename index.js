const _0x16df28 = _0xc89b; (function (_0x339c33, _0x412549) { const _0x524429 = _0xc89b, _0x58cef6 = _0x339c33(); while (!![]) { try { const _0x2ce5bd = parseInt(_0x524429(0x21e)) / 0x1 * (parseInt(_0x524429(0x2e0)) / 0x2) + parseInt(_0x524429(0x247)) / 0x3 * (parseInt(_0x524429(0x267)) / 0x4) + -parseInt(_0x524429(0x260)) / 0x5 + -parseInt(_0x524429(0x230)) / 0x6 + parseInt(_0x524429(0x307)) / 0x7 + -parseInt(_0x524429(0x22c)) / 0x8 + parseInt(_0x524429(0x1e8)) / 0x9 * (parseInt(_0x524429(0x21b)) / 0xa); if (_0x2ce5bd === _0x412549) break; else _0x58cef6['push'](_0x58cef6['shift']()); } catch (_0x5b1f7a) { _0x58cef6['push'](_0x58cef6['shift']()); } } }(_0x1415, 0x6dca6)); const { Server, ServerEvent, Player } = require('./lib/server'), WebSocket = require('ws'), fetch = require(_0x16df28(0x2e1)), wanakana = require(_0x16df28(0x25e)), fs = require('fs'), fsPromises = require('fs')[_0x16df28(0x2fa)], JSON5 = require('json5'), getPort = require(_0x16df28(0x20c)), express = require(_0x16df28(0x223)), http = require(_0x16df28(0x224)), zlib = require(_0x16df28(0x29a)), msgpack = require(_0x16df28(0x217)), { randomUUID } = require(_0x16df28(0x2b9)); let sshHandler = null; try { fs[_0x16df28(0x264)](_0x16df28(0x1f0)) && (sshHandler = require(_0x16df28(0x1f0))); } catch (_0x40b07e) { } function _0xc89b(_0x2760b7, _0x2bc489) { _0x2760b7 = _0x2760b7 - 0x1e7; const _0x141560 = _0x1415(); let _0xc89b4e = _0x141560[_0x2760b7]; return _0xc89b4e; } const RELAY_SERVER_DOMAIN = _0x16df28(0x290), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x16df28(0x29e), _0x16df28(0x26a), _0x16df28(0x1fc)]; let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs['existsSync'](filePath)) try { const fileContent = fs[_0x16df28(0x279)](filePath, _0x16df28(0x24b)); globalConfig = JSON5[_0x16df28(0x214)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x2c64c6) { console[_0x16df28(0x2e6)]('[Config]\x20Error\x20parsing\x20' + filePath + ':', _0x2c64c6[_0x16df28(0x302)]); } } !configLoaded && console['warn'](_0x16df28(0x2b7)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'output': !![], 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x16df28(0x2f3)] = INITIAL_CONFIG[_0x16df28(0x281)] ?? INITIAL_CONFIG[_0x16df28(0x2f3)]; async function updateConfigFile(_0x56ed67, _0x32b6cf) { const _0x3b38fc = _0x16df28; if (!configPath) return; try { let _0x3c024d = await fsPromises[_0x3b38fc(0x2bf)](configPath, _0x3b38fc(0x24b)); const _0x1501b3 = new RegExp('(\x22' + _0x56ed67 + '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)'), _0x342fc4 = typeof _0x32b6cf === _0x3b38fc(0x2ed) ? '\x22' + _0x32b6cf + '\x22' : _0x32b6cf, _0x4a0aaa = _0x3c024d[_0x3b38fc(0x201)](_0x1501b3, '$1' + _0x342fc4); _0x4a0aaa !== _0x3c024d && await fsPromises[_0x3b38fc(0x254)](configPath, _0x4a0aaa, 'utf8'); } catch (_0x1c8ee4) { console[_0x3b38fc(0x2e6)](_0x3b38fc(0x29c), _0x1c8ee4); } }; const makeRange = (_0x2a7900, _0x2d6b35) => Array[_0x16df28(0x2f5)]({ 'length': _0x2d6b35 - _0x2a7900 + 0x1 }, (_0x8af148, _0x574966) => _0x2a7900 + _0x574966); let globalGatewayServer = null; async function startTcpexposer(_0x2ce23d, _0x1be6f3, _0xce715e) { const _0x465794 = _0x16df28; return sshHandler && typeof sshHandler[_0x465794(0x2f9)] === 'function' ? await sshHandler[_0x465794(0x2f9)](_0x2ce23d, _0x1be6f3, _0xce715e) : (_0x2ce23d['logInfo'](_0x465794(0x2b2)), null); } function setupGlobalVcWebSocket(_0x412b4b) { const _0x4a452c = _0x16df28; if (globalGatewayServer) return; const _0x53d248 = express(), _0x1c28b0 = http[_0x4a452c(0x2a6)](_0x53d248), _0x3b746d = new WebSocket['Server']({ 'noServer': !![] }); _0x53d248[_0x4a452c(0x286)](express[_0x4a452c(0x1f1)]()), _0x53d248[_0x4a452c(0x323)]('/', (_0x5bae7b, _0x503aa0) => { const _0x3b7738 = _0x4a452c, { type: _0x50cb29 } = _0x5bae7b[_0x3b7738(0x30e)], _0x2a7377 = _0x5bae7b['headers'][_0x3b7738(0x1fd)]; let _0x1b85a5 = null; if (_0x2a7377) { for (const _0x119cad of sessions[_0x3b7738(0x2c7)]()) { const _0x479597 = _0x119cad[_0x3b7738(0x2fb)][_0x3b7738(0x2bc)]; if (_0x479597 && _0x2a7377[_0x3b7738(0x2b4)](_0x479597)) { _0x1b85a5 = _0x119cad; break; } } if (!_0x1b85a5) for (const _0x4e1bb8 of pendingSessions['values']()) { const _0xfe38ce = _0x4e1bb8[_0x3b7738(0x2fb)]['sub_domain']; if (_0xfe38ce && _0x2a7377[_0x3b7738(0x2b4)](_0xfe38ce)) { _0x1b85a5 = _0x4e1bb8; break; } } } if (_0x1b85a5) { if (_0x50cb29 === _0x3b7738(0x259)) _0x1b85a5[_0x3b7738(0x280)](_0x5bae7b[_0x3b7738(0x30e)]); else { if (_0x50cb29 === _0x3b7738(0x215)) _0x1b85a5['destroy']('success'); } _0x50cb29 === _0x3b7738(0x2b3) ? (_0x1b85a5[_0x3b7738(0x2c9)] = !![], _0x1b85a5[_0x3b7738(0x311)](_0x3b7738(0x291)), _0x503aa0['status'](0xc8)[_0x3b7738(0x1f1)]({ 'type': _0x3b7738(0x2b3), 'roomId': _0x1b85a5[_0x3b7738(0x2c2)], 'ws_connected': _0x1b85a5[_0x3b7738(0x23f)], ..._0x1b85a5[_0x3b7738(0x2fb)] })) : _0x503aa0[_0x3b7738(0x227)](0xc8)[_0x3b7738(0x1f1)]({ 'success': !![] }); } else _0x503aa0[_0x3b7738(0x227)](0x194)[_0x3b7738(0x1f1)]({ 'error': _0x3b7738(0x2f8) }); }), _0x53d248['get']('/', (_0x3e6242, _0x217e00) => { const _0x86f985 = _0x4a452c; _0x217e00[_0x86f985(0x2dc)](_0x86f985(0x1fe)); }), _0x1c28b0['on'](_0x4a452c(0x2ef), (_0x2cfe2d, _0x34c41e, _0x8b6c37) => { const _0x27e6f0 = _0x4a452c; let _0x4d2e2b = null, _0x217606 = null; try { const _0x5d14b8 = _0x2cfe2d[_0x27e6f0(0x28d)][_0x27e6f0(0x1fd)] || _0x27e6f0(0x326); let _0x48b1f8 = _0x2cfe2d['url'] || '/'; if (_0x48b1f8 === '//') _0x48b1f8 = '/'; _0x217606 = new URL(_0x48b1f8, _0x27e6f0(0x309) + _0x5d14b8), _0x4d2e2b = _0x217606[_0x27e6f0(0x200)]['get'](_0x27e6f0(0x24e)); } catch (_0x1bb2c4) { _0x4d2e2b = null; } _0x4d2e2b !== 'vc' ? sshHandler && typeof sshHandler['handleTcpUpgrade'] === _0x27e6f0(0x2b6) ? sshHandler[_0x27e6f0(0x2a7)](_0x2cfe2d, _0x34c41e, _0x8b6c37, INITIAL_CONFIG['port']) : _0x34c41e['destroy']() : _0x3b746d[_0x27e6f0(0x22e)](_0x2cfe2d, _0x34c41e, _0x8b6c37, _0x5b14c6 => { const _0x55e86a = _0x27e6f0, _0x201ca0 = _0x2cfe2d[_0x55e86a(0x28d)][_0x55e86a(0x1fd)]; let _0x3cfb7e = null; if (_0x201ca0) { for (const _0x7766c4 of sessions['values']()) { const _0x2f17ad = _0x7766c4[_0x55e86a(0x2fb)][_0x55e86a(0x2bc)]; if (_0x2f17ad && _0x201ca0[_0x55e86a(0x2b4)](_0x2f17ad)) { _0x3cfb7e = _0x7766c4; break; } } if (!_0x3cfb7e) for (const _0x547ba9 of pendingSessions['values']()) { const _0x4ad790 = _0x547ba9[_0x55e86a(0x2fb)]['sub_domain']; if (_0x4ad790 && _0x201ca0[_0x55e86a(0x2b4)](_0x4ad790)) { _0x3cfb7e = _0x547ba9; break; } } } if (_0x3cfb7e) _0x3cfb7e[_0x55e86a(0x261)](_0x5b14c6); else { const _0x221934 = sessions[_0x55e86a(0x2c7)]()['next']()[_0x55e86a(0x2c5)] || pendingSessions[_0x55e86a(0x2c7)]()[_0x55e86a(0x276)]()[_0x55e86a(0x2c5)]; if (_0x221934) _0x221934['handleDirectVcConnection'](_0x5b14c6); else _0x5b14c6[_0x55e86a(0x2d1)](); } }); }), _0x1c28b0['listen'](_0x412b4b, () => { }), globalGatewayServer = _0x1c28b0; }; function _0x1415() { const _0x41e4de = ['認証コードを無効にしました', '§cDisabled§r', 'get', 'open', 'sendMessage', 'true', '近接vcを有効にしました', 'createServer', 'handleTcpUpgrade', 'argv', 'processTagCommands', 'ws://127.0.0.1:', 'Proximity\x20VC\x20enabled', 'PlayerTransform', '/room/', ']\x1b[0m\x20', '\x0aProximity\x20VC:\x20', 'startWebSession', 'Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension', '[TCPExposer]\x20TCPExposerハンドラーが見つからないため、接続をスキップします。リレーサーバーを使用します。', 'initialization', 'startsWith', 'mcSshClient', 'function', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'includes', 'crypto', '<近接VC>言語を日本語に設定しました', 'shouldBroadcast', 'sub_domain', 'aliveSet', 'startTimer', 'readFile', 'nameCache', '§r\x0a認証コード\x20(Verify):\x20', 'roomId', 'toString', 'スペクテイター同士の会話をディメンションごとに分けました', 'value', 'destroy', 'values', 'type', 'vc_connected', '\x0a近接VC\x20(Proximity):\x20', 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', 'now', 'Session\x20not\x20found', 'lang', '\x0a!help\x20for\x20command\x20list', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', 'close', 'Error\x20handling\x20world\x20loop\x20[', 'data', 'Failed\x20to\x20write\x20server_info.json:', 'init', 'shift', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', 'pvcSessionId', 'sshClient', 'spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20スペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20スペクテイター同士の会話をディメンションごとに分けます', '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'send', 'userName', 'setupMcRelayListeners', 'split', '155858vcbXxK', 'node-fetch', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20minecraftチャットへの出力を有効/無効にできます\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20スペクテイターとVCを分けます', 'Session\x20destroying...\x20Reason:\x20', 'end', 'web_port', 'error', 'writeFileSync', 'clear', '\x1b[36m[Info][', '\x20Error:', 'enabled', 'has', 'string', 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました', 'upgrade', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', '認証コードは', 'sshError', 'password', 'commands', 'from', 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', 'inactivityTimer', 'Session\x20not\x20found\x20for\x20this\x20domain', 'startTcpexposer', 'promises', 'config', 'pvc:roomId=', 'trim', 'PlayerLeave', 'readyState', 'useResetTimer', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'message', '=======================================================\x0a', 'positions', 'find', 'delete', '749126ZzAhrx', 'Host\x20left.\x20Handing\x20stop\x20signal...', 'http://', 'command_result', '--------------------', 'tag\x20@s\x20add\x20\x22pvc:roomId=', 'Spectator\x20set\x20to\x20common\x20VC', 'body', 'map', '参加:\x20', 'logInfo', 'finally', '\x0aMax\x20distance:', 'Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:', 'log', 'consecutiveTimeouts', '退出:\x20', 'details', '参加者はこのURLにアクセスしてください:', 'victim', 'stringify', 'onlinePlayers', 'wss://', '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20', 'resetTimer', 'verify\x20code\x20enabled', 'です\x0aあなたのVCnameは', '認証コードを有効にしました', 'post', 'connectToRelayServer', 'disabled', 'localhost', '\x0a出力\x20(Output):\x20', 'tag\x20@a[tag=\x22', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20information\x20output\x20to\x20minecraft\x20chat\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC', 'ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20近接vcを有効/無効にできます', 'test', 'filter', 'tag\x20@a\x20list', 'substring', '6852393JqjirS', 'WorldRemove', 'getAllTags', 'false', '\x0a!help\x20でコマンド一覧を確認できます', 'players', '[Auto-Stop][', 'catch', './tcpexposer/tcpexposer_handler.js', 'json', 'bindWorld', 'createCommands', 'verify\x20code\x20disabled', 'sendInitialPayload', 'encode', 'pvcDomain', 'server_shutdown', 'localClient', 'size', 'world', './config.json', 'host', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'yRots', 'searchParams', 'replace', 'maxRuntimeTimeout', 'spectatorSet', 'not_found', '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20', '\x0a最大距離\x20(Distance):\x20§e', '\x0aスペクテイター分離\x20(Spectator):\x20', 'statusCode', 'relayed_vc_data', 'testfor\x20@a[tag=pvc:req_cmd]', 'success', 'get-port', 'dimension', '<近接VC>声の最大距離を', 'Output\x20enabled', 'partner_connected', '<Proximity\x20VC>Changed\x20max\x20distance\x20to\x20', '§a有効§r', 'sendInitMessage', 'parse', 'disconnect_command', 'localClientBuffer', 'msgpack-lite', 'WorldAdd', 'スペクテイター同士の会話を共通にしました', 'stop_roop', '10OYhGsf', 'exit', 'active', '7PKMNAo', '§aEnabled§r', 'spectator', '/api/session_status/:id', '\x0a=======================================================', 'express', 'http', 'に変更しました', '/api/start_session', 'status', 'timeout', 'https://mcproxvc.ovh/connect/?roomid=', 'specListen', 'testfor\x20@a[m=spectator]', '3378928plCRkS', 'set', 'handleUpgrade', 'querytarget\x20@e[type=player]', '3705066ZtiZpV', 'setupVcRelayListeners', 'processName', '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.', 'round', '/api/stop_session', '/connect\x20', 'warn', 'pendingTimeout', 'output', 'indexOf', 'connectCommand', 'ended', 'isProcessingTags', 'minecraft', 'mc_connected', 'entries', 'length', 'server_info.json', 'concat', 'useRelay', '[Relay]\x20Connected\x20(ID:\x20', 'Output\x20disabled', '301470hfglfV', 'add', 'listen', 'Buffer', 'utf8', 'proximity', 'Password\x20is\x20', 'clientType', 'testfor\x20@a', 'stop', 'distance', '<近接VC>', 'forEach', 'writeFile', 'directVcClients', '<Proximity\x20VC>Language\x20set\x20to\x20English', 'tag\x20@a[tag=pvc:req_cmd]\x20list', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', 'data_update', 'statusMessage', 'runCommand', 'ROOM\x20ID:\x20', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', 'wanakana', 'position', '2133845wksFmV', 'handleDirectVcConnection', 'Spectator\x20and\x20VC\x20separated', '\x0a声の届く距離：', 'existsSync', 'broadcastPositions', 'list', '20DdfXXy', 'decode', 'pvc:', './config.json5', 'pvc:req_cmd', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20言語の変更\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', 'cleanOldTags', '\x22]\x20remove\x20\x22', 'yRot', 'reason', 'dimensions', 'OPEN', 'passwords', '\x1b[33m[Log][', '\x0aSpectator\x20Split:\x20', 'next', '/create-room?roomid=', 'run_command', 'readFileSync', 'isBuffer', 'floor', 'コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます', 'Connection\x20started\x0aProximity\x20voice\x20chat:', '--streamlit', 'loop', 'dataUpdate', 'verify', 'playersNames', ']\x20最大稼働時間に達しました。', 'spectators', 'relayWs', 'use', 'port', 'name', 'worldName', 'tag\x20@a\x20remove\x20\x22', 'action', '§l[Current\x20Settings]§r\x0aLanguage:\x20', 'headers', 'specDim', 'timestamp', 'mcproxvc.fly.dev', '接続開始', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', 'testfor\x20@e[type=player]', 'all', '\x0a\x20-\x20Spectator\x20Dimension:\x20', 'スペクテイターを共通のVCにしました', 'localPlayer', 'partner_disconnected', 'zlib', 'CONNECTING', '❌\x20設定ファイルの更新に失敗しました:', '§c無効§r', './config.jsonc']; _0x1415 = function () { return _0x41e4de; }; return _0x1415(); } class Session { constructor(_0x270383, _0x1b04ce = {}) { const _0x2eb703 = _0x16df28; this['id'] = randomUUID(), this[_0x2eb703(0x1fb)] = _0x270383, this[_0x2eb703(0x289)] = _0x270383 ? _0x270383['name'] || 'Unknown\x20World' : 'Pending\x20Session', this[_0x2eb703(0x2c0)] = new Map(), this[_0x2eb703(0x2fb)] = { ...INITIAL_CONFIG, ..._0x1b04ce }, this['roomId'] = this['config'][_0x2eb703(0x2bc)], this[_0x2eb703(0x23b)] = '', this[_0x2eb703(0x273)] = {}, this['positions'] = {}, this[_0x2eb703(0x1ff)] = {}, this[_0x2eb703(0x271)] = {}, this[_0x2eb703(0x284)] = {}, this[_0x2eb703(0x31c)] = new Set(), this['shouldBroadcast'] = !![], this['vc_connected'] = ![], this[_0x2eb703(0x23f)] = ![], this['stop_roop'] = ![], this[_0x2eb703(0x244)] = ![], this[_0x2eb703(0x300)] = ![], this[_0x2eb703(0x285)] = null, this[_0x2eb703(0x1f9)] = null, this[_0x2eb703(0x255)] = new Set(), this[_0x2eb703(0x2d9)] = null, this[_0x2eb703(0x2f2)] = null, this[_0x2eb703(0x2f7)] = null, this['consecutiveTimeouts'] = 0x0, this['pendingTimeout'] = null, this[_0x2eb703(0x2f4)] = this[_0x2eb703(0x1f3)](); } ['logInfo'](_0x10462d) { const _0x2ba871 = _0x16df28; console[_0x2ba871(0x315)](_0x2ba871(0x2e9) + this['id']['substring'](0x0, 0x6) + _0x2ba871(0x2ae) + _0x10462d); } ['logLog'](_0x44d4be) { const _0x5eff5e = _0x16df28; console[_0x5eff5e(0x315)](_0x5eff5e(0x274) + this['id'][_0x5eff5e(0x1e7)](0x0, 0x6) + _0x5eff5e(0x2ae) + _0x44d4be); } ['processName'](_0x59d7f6) { const _0x55935d = _0x16df28; if (!this[_0x55935d(0x2c0)]['has'](_0x59d7f6)) { const _0x8a14d0 = wanakana['toRomaji'](_0x59d7f6[_0x55935d(0x201)](/ /g, '_'))[_0x55935d(0x201)](/n'/g, 'n'); this[_0x55935d(0x2c0)]['set'](_0x59d7f6, _0x8a14d0); } return this[_0x55935d(0x2c0)][_0x55935d(0x2a1)](_0x59d7f6); } [_0x16df28(0x261)](_0x12a4bb) { const _0x53407a = _0x16df28; this[_0x53407a(0x255)][_0x53407a(0x248)](_0x12a4bb), this['vc_connected'] = !![], this[_0x53407a(0x1f5)](_0x12a4bb), _0x12a4bb['on'](_0x53407a(0x302), async _0x3b2459 => { const _0x1ccd60 = _0x53407a; try { let _0x2afaec; try { _0x2afaec = msgpack[_0x1ccd60(0x268)](_0x3b2459); } catch (_0x532649) { try { _0x2afaec = JSON['parse'](_0x3b2459); } catch (_0x4b6936) { } } if (_0x2afaec) { if (_0x2afaec[_0x1ccd60(0x2dd)] && _0x2afaec[_0x1ccd60(0x25f)]) this['positions'][_0x2afaec[_0x1ccd60(0x2dd)]] = _0x2afaec['position']; if (_0x2afaec['action'] === 'run_command' && typeof _0x2afaec[_0x1ccd60(0x2c5)] === 'string') { if (this[_0x1ccd60(0x1fb)]) { const _0x4154ff = await this[_0x1ccd60(0x1fb)][_0x1ccd60(0x25b)](_0x2afaec[_0x1ccd60(0x2c5)]); _0x12a4bb[_0x1ccd60(0x2dc)](JSON[_0x1ccd60(0x31b)]({ 'type': _0x1ccd60(0x30a), 'payload': _0x4154ff })); } } } } catch (_0x57f5fe) { } }), _0x12a4bb['on'](_0x53407a(0x2d1), () => { const _0x5788a0 = _0x53407a; this[_0x5788a0(0x255)][_0x5788a0(0x306)](_0x12a4bb); }); } async[_0x16df28(0x2b0)]() { const _0x427879 = _0x16df28, { sub_domain: _0x92126d, username: _0xe82566, ssh_password: _0x2d58b5 } = this[_0x427879(0x2fb)]; if (_0xe82566 && _0x2d58b5 && _0x92126d) this[_0x427879(0x2d9)] = await startTcpexposer(this, _0x92126d, INITIAL_CONFIG[_0x427879(0x2e5)]); else await this[_0x427879(0x324)]('mc'); } [_0x16df28(0x1f2)](_0x33da72) { const _0x2a2690 = _0x16df28; this[_0x2a2690(0x238)] && (clearTimeout(this[_0x2a2690(0x238)]), this['pendingTimeout'] = null), this[_0x2a2690(0x1fb)] = _0x33da72, this[_0x2a2690(0x289)] = _0x33da72[_0x2a2690(0x288)] || 'Unknown\x20World', this['init'](); } async[_0x16df28(0x2d5)]() { const _0x3f5cad = _0x16df28; if (!this[_0x3f5cad(0x1fb)] && !this[_0x3f5cad(0x238)]) return; if (!this[_0x3f5cad(0x244)] && !this[_0x3f5cad(0x2d9)]) { const { sub_domain: _0x1e5601, username: _0x17f283, ssh_password: _0x6960e2 } = this[_0x3f5cad(0x2fb)]; if (_0x17f283 && _0x6960e2 && _0x1e5601) { this[_0x3f5cad(0x2d9)] = await startTcpexposer(this, _0x1e5601, INITIAL_CONFIG[_0x3f5cad(0x2e5)]); if (!this[_0x3f5cad(0x2d9)]) { if (!this[_0x3f5cad(0x244)]) await this[_0x3f5cad(0x324)]('mc'); } } else { if (!_0x1e5601) await this['connectToRelayServer']('mc'); } } this[_0x3f5cad(0x23f)] = !![], this[_0x3f5cad(0x21a)] = ![], this[_0x3f5cad(0x311)]('接続開始'); if (this[_0x3f5cad(0x1fb)]) { try { await this[_0x3f5cad(0x26d)](), this['world'][_0x3f5cad(0x25b)]('tag\x20@s\x20add\x20\x22pvc:roomId=' + this[_0x3f5cad(0x2c2)] + '\x22'), this[_0x3f5cad(0x213)](); } catch (_0x146a75) { } this[_0x3f5cad(0x27f)](); } } async[_0x16df28(0x26d)]() { const _0x203259 = _0x16df28; if (!this['world']) return; try { const _0x506b48 = await this['getAllTags'](); for (const _0x154160 of _0x506b48) { await this[_0x203259(0x1fb)][_0x203259(0x25b)](_0x203259(0x328) + _0x154160 + _0x203259(0x26e) + _0x154160 + '\x22'); } const _0xe4b07b = await this[_0x203259(0x1fb)][_0x203259(0x25b)](_0x203259(0x24f)); this[_0x203259(0x31c)][_0x203259(0x2e8)](); if (_0xe4b07b[_0x203259(0x31a)]) _0xe4b07b[_0x203259(0x31a)]['forEach'](_0x1ac2fe => this[_0x203259(0x31c)]['add'](_0x1ac2fe)); } catch (_0x533862) { } } ['sendInitMessage']() { const _0x3d8f5c = _0x16df28; if (!this[_0x3d8f5c(0x1fb)]) return; const { proximity: _0x2c2c10, distance: _0x339753, lang: _0x134b9d } = this[_0x3d8f5c(0x2fb)]; if (_0x134b9d == 'ja') { let _0x28f2b5 = _0x2c2c10 ? '有効' : '無効'; this[_0x3d8f5c(0x1fb)]['sendMessage']('接続を開始しました\x0a近接vc：' + _0x28f2b5 + _0x3d8f5c(0x263) + _0x339753 + _0x3d8f5c(0x1ec))[_0x3d8f5c(0x1ef)](_0x416a67 => { }); } else { let _0x32a536 = _0x2c2c10 ? _0x3d8f5c(0x2eb) : _0x3d8f5c(0x325); this['world'][_0x3d8f5c(0x2a3)](_0x3d8f5c(0x27d) + _0x32a536 + _0x3d8f5c(0x313) + _0x339753 + _0x3d8f5c(0x2cf))[_0x3d8f5c(0x1ef)](_0x4547a5 => { }); } } [_0x16df28(0x31f)]() { const _0x88405c = _0x16df28; this['useResetTimer'] = !![], clearTimeout(this['inactivityTimer']), this[_0x88405c(0x2f7)] = setTimeout(() => { const _0x32959e = _0x88405c; this[_0x32959e(0x2c6)](_0x32959e(0x228)); }, INACTIVITY_TIMEOUT); } [_0x16df28(0x2be)]() { const _0x550edb = _0x16df28; if (this[_0x550edb(0x202)]) return; this[_0x550edb(0x202)] = setTimeout(() => { const _0x3abc74 = _0x550edb; if (this[_0x3abc74(0x1fb)]) this[_0x3abc74(0x1fb)][_0x3abc74(0x2a3)](this['config'][_0x3abc74(0x2ce)] === 'ja' ? _0x3abc74(0x2f0) : _0x3abc74(0x233))[_0x3abc74(0x1ef)](() => { }); console[_0x3abc74(0x315)]('\x0a======================================================='), console[_0x3abc74(0x315)](_0x3abc74(0x1ee) + this[_0x3abc74(0x289)] + _0x3abc74(0x283)), console['log'](_0x3abc74(0x303)), setTimeout(() => this[_0x3abc74(0x2c6)](_0x3abc74(0x228)), 0x1388); }, MAX_RUNTIME), this[_0x550edb(0x31f)](); } async['loop']() { const _0x14a887 = _0x16df28; if (this['stop_roop'] || !this[_0x14a887(0x1fb)]) return; try { if (this['useResetTimer']) this['resetTimer'](); let _0x446bec = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }, _0x42fe37 = { 'statusCode': -0x1 }; if (this[_0x14a887(0x2fb)][_0x14a887(0x24c)]) { const [_0x76fbbf, _0x2d114a, _0x529e3a, _0x25b383, _0x38ed68] = await Promise[_0x14a887(0x295)]([this[_0x14a887(0x1fb)]['runCommand'](_0x14a887(0x266)), this['world'][_0x14a887(0x25b)](_0x14a887(0x294)), this[_0x14a887(0x1fb)]['runCommand'](_0x14a887(0x22b)), this[_0x14a887(0x1fb)]['runCommand'](_0x14a887(0x22f)), this[_0x14a887(0x1fb)]['runCommand'](_0x14a887(0x20a))]); _0x42fe37 = _0x38ed68; if (_0x76fbbf['statusCode'] <= -0x1) { this['consecutiveTimeouts']++; if (this[_0x14a887(0x316)] >= TIMEOUT_THRESHOLD) { this[_0x14a887(0x2c6)]('success'); return; } } else this[_0x14a887(0x316)] = 0x0; _0x76fbbf[_0x14a887(0x208)] === 0x0 && typeof _0x76fbbf[_0x14a887(0x1ed)] === _0x14a887(0x2ed) && (_0x446bec[_0x14a887(0x282)] = _0x76fbbf[_0x14a887(0x1ed)][_0x14a887(0x2df)](',')[_0x14a887(0x30f)](_0x43dede => _0x43dede[_0x14a887(0x2fd)]())[_0x14a887(0x32c)](_0xdb1f92 => _0xdb1f92[_0x14a887(0x241)] > 0x0)); if (_0x2d114a[_0x14a887(0x31a)]) _0x2d114a['victim'][_0x14a887(0x253)](_0x2a1fe3 => _0x446bec['aliveSet'][_0x14a887(0x248)](_0x2a1fe3)); if (_0x529e3a[_0x14a887(0x31a)]) _0x529e3a[_0x14a887(0x31a)]['forEach'](_0x373b84 => _0x446bec[_0x14a887(0x203)]['add'](_0x373b84)); try { _0x446bec[_0x14a887(0x318)] = JSON['parse'](_0x25b383['details'] || '[]'); } catch (_0x480b84) { _0x446bec[_0x14a887(0x318)] = []; } } else { const [_0x39f917, _0x2e7be9] = await Promise['all']([this[_0x14a887(0x1fb)][_0x14a887(0x25b)](_0x14a887(0x266)), this['world']['runCommand'](_0x14a887(0x20a))]); _0x42fe37 = _0x2e7be9; if (_0x39f917[_0x14a887(0x208)] <= -0x1) { this['consecutiveTimeouts']++; if (this[_0x14a887(0x316)] >= TIMEOUT_THRESHOLD) { this[_0x14a887(0x2c6)]('success'); return; } } else this['consecutiveTimeouts'] = 0x0; } const _0xf83ea5 = Array[_0x14a887(0x2f5)](_0x446bec[_0x14a887(0x2bd)]); _0x446bec[_0x14a887(0x282)]['forEach'](_0x538e35 => { const _0x1fcf75 = _0x14a887, _0x242013 = this[_0x1fcf75(0x232)](_0x538e35), _0x2c3d7c = _0x446bec['spectatorSet'][_0x1fcf75(0x2ec)](_0x538e35); this[_0x1fcf75(0x284)][_0x242013] = _0x2c3d7c; if (!this[_0x1fcf75(0x2fb)][_0x1fcf75(0x24c)]) this[_0x1fcf75(0x304)][_0x242013] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x446bec['aliveSet']['has'](_0x538e35)) this[_0x1fcf75(0x304)][_0x242013] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this[_0x1fcf75(0x2fb)][_0x1fcf75(0x220)] && _0x2c3d7c) { if (this[_0x1fcf75(0x2fb)][_0x1fcf75(0x22a)] === !![]) { const _0x49f217 = _0xf83ea5[_0x1fcf75(0x23a)](_0x538e35); if (_0x49f217 !== -0x1 && _0x446bec[_0x1fcf75(0x318)][_0x49f217]) { this[_0x1fcf75(0x304)][_0x242013] = _0x446bec['details'][_0x49f217]['position']; if (this[_0x1fcf75(0x2fb)][_0x1fcf75(0x28e)] === !![]) this['dimensions'][_0x242013] = _0x446bec[_0x1fcf75(0x318)][_0x49f217][_0x1fcf75(0x20d)]; } else this[_0x1fcf75(0x304)][_0x242013] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this[_0x1fcf75(0x304)][_0x242013] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x8f81dd = _0xf83ea5[_0x1fcf75(0x23a)](_0x538e35); if (_0x8f81dd !== -0x1 && _0x446bec[_0x1fcf75(0x318)][_0x8f81dd]) this[_0x1fcf75(0x304)][_0x242013] = _0x446bec[_0x1fcf75(0x318)][_0x8f81dd]['position'], this['yRots'][_0x242013] = _0x446bec['details'][_0x8f81dd][_0x1fcf75(0x26f)], this[_0x1fcf75(0x271)][_0x242013] = _0x446bec['details'][_0x8f81dd][_0x1fcf75(0x20d)]; else this[_0x1fcf75(0x304)][_0x242013] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this[_0x14a887(0x2bb)] = !![], this[_0x14a887(0x265)](); if (_0x42fe37[_0x14a887(0x208)] === 0x0 && !this[_0x14a887(0x23d)]) { this[_0x14a887(0x23d)] = !![]; const _0x569894 = _0x42fe37[_0x14a887(0x31a)][0x0]; this[_0x14a887(0x2a9)](_0x569894)[_0x14a887(0x1ef)](_0x24dc23 => { const _0x3b1a84 = _0x14a887; console[_0x3b1a84(0x2e6)]('Tag\x20processing\x20error:', _0x24dc23); })[_0x14a887(0x312)](() => { const _0xae5e26 = _0x14a887; this[_0xae5e26(0x23d)] = ![]; }); } } catch (_0x3cd977) { console['error'](_0x14a887(0x2d2) + this['worldName'] + ']:', _0x3cd977); } if (!this[_0x14a887(0x21a)]) setTimeout(() => this[_0x14a887(0x27f)](), 0x0); } async[_0x16df28(0x2a9)](_0x124a96) { const _0x39cb0d = _0x16df28, _0x11a9b5 = await this[_0x39cb0d(0x1fb)][_0x39cb0d(0x25b)](_0x39cb0d(0x257)); if (_0x11a9b5[_0x39cb0d(0x208)] === 0x0 && _0x11a9b5[_0x39cb0d(0x25a)]) { let _0x5ae255 = []; const _0x40b652 = new Player(this[_0x39cb0d(0x1fb)], _0x124a96), _0x21a944 = _0x11a9b5[_0x39cb0d(0x25a)]['split'](/\r\n|\n|\r/); for (const _0x306eda of _0x21a944) { if (!_0x306eda[_0x39cb0d(0x2fd)]()) continue; const _0x2190ed = _0x306eda[_0x39cb0d(0x201)](/§./g, ''), _0x5dcbda = _0x2190ed[_0x39cb0d(0x23a)](':'); _0x5dcbda !== -0x1 && (_0x5ae255 = _0x5ae255[_0x39cb0d(0x243)](_0x2190ed[_0x39cb0d(0x1e7)](_0x5dcbda + 0x1)[_0x39cb0d(0x2df)](',')[_0x39cb0d(0x30f)](_0x586a0c => _0x586a0c[_0x39cb0d(0x2fd)]())[_0x39cb0d(0x32c)](_0x2cab14 => _0x2cab14[_0x39cb0d(0x2b4)](_0x39cb0d(0x269))))); for (const _0x3126bd of _0x5ae255) { if (_0x3126bd === _0x39cb0d(0x26b) || _0x3126bd[_0x39cb0d(0x2b4)](_0x39cb0d(0x2fc))) continue; const _0xcca4c9 = _0x3126bd['startsWith'](_0x39cb0d(0x269)) ? _0x3126bd['substring'](_0x39cb0d(0x269)['length']) : _0x3126bd; let [_0x3b9ef6, ..._0x56f2bc] = _0xcca4c9[_0x39cb0d(0x2df)](':'); _0x3b9ef6 = '!' + _0x3b9ef6, this[_0x39cb0d(0x2f4)][_0x3b9ef6] && (await this[_0x39cb0d(0x2f4)][_0x3b9ef6](this[_0x39cb0d(0x1fb)], _0x40b652, _0x56f2bc), this[_0x39cb0d(0x1fb)][_0x39cb0d(0x25b)](_0x39cb0d(0x28a) + _0x3126bd + '\x22')); } } await this[_0x39cb0d(0x1fb)]['runCommand']('tag\x20@a[tag=pvc:req_cmd]\x20remove\x20pvc:req_cmd'); } } async[_0x16df28(0x1ea)]() { const _0x5320cb = _0x16df28; if (!this[_0x5320cb(0x1fb)]) return []; try { const _0x147957 = await this[_0x5320cb(0x1fb)][_0x5320cb(0x25b)](_0x5320cb(0x32d)); if (_0x147957[_0x5320cb(0x208)] !== 0x0 || !_0x147957[_0x5320cb(0x25a)]) return []; let _0x46e00d = []; const _0x1babb8 = _0x147957['statusMessage'][_0x5320cb(0x2df)](/\r\n|\n|\r/); for (const _0xef4556 of _0x1babb8) { if (!_0xef4556['trim']()) continue; const _0x1f6138 = _0xef4556[_0x5320cb(0x201)](/§./g, ''), _0x3a3afe = _0x1f6138[_0x5320cb(0x23a)](':'); _0x3a3afe !== -0x1 && (_0x46e00d = _0x46e00d[_0x5320cb(0x243)](_0x1f6138[_0x5320cb(0x1e7)](_0x3a3afe + 0x1)[_0x5320cb(0x2df)](',')[_0x5320cb(0x30f)](_0x1c7754 => _0x1c7754[_0x5320cb(0x2fd)]())['filter'](_0x5b1841 => _0x5b1841['startsWith'](_0x5320cb(0x269))))); } return _0x46e00d; } catch (_0x371979) { return []; } } [_0x16df28(0x265)]() { const _0x183431 = _0x16df28; if (!this['shouldBroadcast']) return; const _0x2ffdaa = {}; for (const [_0xcfd190, _0x2832fc] of Object[_0x183431(0x240)](this[_0x183431(0x304)])) { if (_0x2832fc) _0x2ffdaa[_0xcfd190] = [Math[_0x183431(0x234)](_0x2832fc['x'] * 0x64) / 0x64, Math[_0x183431(0x234)](_0x2832fc['y'] * 0x64) / 0x64, Math[_0x183431(0x234)](_0x2832fc['z'] * 0x64) / 0x64]; } const _0x4632ed = { 'spec': this[_0x183431(0x2fb)][_0x183431(0x220)], 'spLis': this[_0x183431(0x2fb)][_0x183431(0x22a)], 'spDim': this[_0x183431(0x2fb)][_0x183431(0x28e)], 't': 'wu', 'pos': _0x2ffdaa, 'dis': this[_0x183431(0x2fb)]['distance'], 'pssws': this['passwords'], 'dim': this['dimensions'], 'yr': this['yRots'], 'spPos': this[_0x183431(0x284)], 'prox': this['config'][_0x183431(0x24c)] ? 0x1 : 0x0 }, _0x38d8ec = msgpack[_0x183431(0x1f6)](_0x4632ed); if (this[_0x183431(0x285)] && this[_0x183431(0x285)][_0x183431(0x2ff)] === WebSocket[_0x183431(0x272)]) this['relayWs']['send'](_0x38d8ec); this[_0x183431(0x255)][_0x183431(0x253)](_0x2202b5 => { const _0x5646c5 = _0x183431; if (_0x2202b5[_0x5646c5(0x2ff)] === WebSocket['OPEN']) _0x2202b5[_0x5646c5(0x2dc)](_0x38d8ec); }); } async[_0x16df28(0x324)](_0x21e333) { const _0x25bdc5 = _0x16df28, _0x213524 = _0x21e333 === 'mc', _0x574628 = _0x213524 ? '[MC\x20Relay]' : '[VC\x20Relay]'; try { if (!this[_0x25bdc5(0x2c2)]) { const _0x50983a = await fetch('https://' + RELAY_SERVER_DOMAIN + _0x25bdc5(0x277) + this[_0x25bdc5(0x2fb)]['sub_domain']), _0x13cc9f = await _0x50983a['json'](); this[_0x25bdc5(0x2c2)] = _0x13cc9f['roomId']; if (this['world']) { this['cleanOldTags'](), this[_0x25bdc5(0x1fb)]['runCommand'](_0x25bdc5(0x30c) + this[_0x25bdc5(0x2c2)] + '\x22')[_0x25bdc5(0x1ef)](() => { }); if (this[_0x25bdc5(0x2fb)][_0x25bdc5(0x2ce)] === 'ja') await this['world'][_0x25bdc5(0x2a3)](_0x25bdc5(0x258) + this[_0x25bdc5(0x2c2)]); else await this['world'][_0x25bdc5(0x2a3)]('Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20' + this[_0x25bdc5(0x2c2)]); } } else { if (!this[_0x25bdc5(0x244)]) { if (this[_0x25bdc5(0x1fb)]) { if (this[_0x25bdc5(0x2fb)]['lang'] === 'ja') await this[_0x25bdc5(0x1fb)][_0x25bdc5(0x2a3)](_0x25bdc5(0x258) + this[_0x25bdc5(0x2c2)]); else await this[_0x25bdc5(0x1fb)]['sendMessage'](_0x25bdc5(0x25d) + this[_0x25bdc5(0x2c2)]); } } } this['useRelay'] = !![]; if (_0x213524) { console[_0x25bdc5(0x315)](_0x25bdc5(0x222)); if (this[_0x25bdc5(0x2fb)]['lang'] === 'ja') this[_0x25bdc5(0x311)]('Minecraftから以下のコマンドで接続してください:'); else this['logInfo'](_0x25bdc5(0x314)); this['logInfo'](_0x25bdc5(0x236) + RELAY_SERVER_DOMAIN + _0x25bdc5(0x2ad) + this['roomId']), this[_0x25bdc5(0x23b)] = '/connect\x20' + RELAY_SERVER_DOMAIN + _0x25bdc5(0x2ad) + this[_0x25bdc5(0x2c2)]; } else { this[_0x25bdc5(0x311)](_0x25bdc5(0x25c) + this[_0x25bdc5(0x2c2)]); if (this['config'][_0x25bdc5(0x2ce)] === 'ja') this[_0x25bdc5(0x311)](_0x25bdc5(0x319)); else this[_0x25bdc5(0x311)]('Participants\x20should\x20access\x20this\x20URL'); this[_0x25bdc5(0x311)](_0x25bdc5(0x229) + this[_0x25bdc5(0x2c2)]), console[_0x25bdc5(0x315)]('=======================================================\x0a'); } this[_0x25bdc5(0x2be)](); let _0x276a64; if (this['relayWs']) { _0x276a64 = this[_0x25bdc5(0x285)]; if (_0x276a64[_0x25bdc5(0x2ff)] !== WebSocket[_0x25bdc5(0x272)]) { } } else _0x276a64 = new WebSocket(_0x25bdc5(0x31d) + RELAY_SERVER_DOMAIN + '/room/' + this['roomId'] + '?clientType=server_script'), this[_0x25bdc5(0x285)] = _0x276a64, _0x276a64['on'](_0x25bdc5(0x2a2), () => this[_0x25bdc5(0x311)](_0x25bdc5(0x245) + this[_0x25bdc5(0x2c2)] + ')')), _0x276a64['on'](_0x25bdc5(0x2d1), () => { const _0x49a0cd = _0x25bdc5; if (this[_0x49a0cd(0x285)] === _0x276a64) this['relayWs'] = null; }), _0x276a64['on']('error', _0x8e7e59 => console['error'](_0x574628 + _0x25bdc5(0x2ea), _0x8e7e59)); _0x213524 ? (this['mc_connected'] = !![], this['setupMcRelayListeners'](_0x276a64), this['connectToRelayServer']('vc')) : (this[_0x25bdc5(0x2c9)] = !![], this['setupVcRelayListeners'](_0x276a64)); } catch (_0x5e009b) { console[_0x25bdc5(0x2e6)](_0x574628 + _0x25bdc5(0x2ea), _0x5e009b); } } [_0x16df28(0x1f5)](_0xc63411) { const _0x2cf4d3 = _0x16df28, { app_id: _0x315b54, secret_key: _0x1716f3, proximity: _0x51977a, distance: _0x4630b5, spectator: _0x3ba34d, specListen: _0x266888, specDim: _0x5d9921, verify: _0xbb5233, password: _0x29d335 } = this[_0x2cf4d3(0x2fb)]; _0xc63411[_0x2cf4d3(0x2dc)](msgpack['encode']({ 'password': !!(_0xbb5233 || _0x29d335), 'passwords': this[_0x2cf4d3(0x273)], 'app_id': _0x315b54, 'secret_key': _0x1716f3, 'proximity': _0x51977a, 'distance': _0x4630b5, 'spectator': _0x3ba34d, 'specListen': _0x266888, 'specDim': _0x5d9921 })); } [_0x16df28(0x231)](_0x419aec) { const _0x63845d = _0x16df28; _0x419aec['on'](_0x63845d(0x302), async _0x2b570a => { const _0x4083b5 = _0x63845d; try { const _0x421654 = JSON[_0x4083b5(0x214)](_0x2b570a['toString']()); if (_0x421654[_0x4083b5(0x2c8)] === _0x4083b5(0x210)) { this[_0x4083b5(0x1f5)](_0x419aec); return; } if (_0x421654[_0x4083b5(0x28b)] === 'run_command') { if (this[_0x4083b5(0x1fb)]) await this[_0x4083b5(0x1fb)][_0x4083b5(0x25b)](_0x421654[_0x4083b5(0x2c5)]); } } catch (_0x40bca2) { } }); } [_0x16df28(0x2de)](_0x141dbe) { const _0xa1bd4f = _0x16df28; _0x141dbe['on']('message', async _0x4f05d7 => { const _0x479dfa = _0xc89b; let _0x5836a7 = _0x4f05d7; try { Buffer[_0x479dfa(0x27a)](_0x4f05d7) && _0x4f05d7['length'] > 0x2 && _0x4f05d7[0x0] === 0x1f && _0x4f05d7[0x1] === 0x8b && (_0x5836a7 = zlib['gunzipSync'](_0x4f05d7)); } catch (_0x29c46e) { } try { const _0x5bd8b9 = JSON[_0x479dfa(0x214)](_0x5836a7['toString']()); if (_0x5bd8b9[_0x479dfa(0x2c8)] === _0x479dfa(0x210)) { const _0x3676a0 = _0x5bd8b9[_0x479dfa(0x24e)] || _0x479dfa(0x23e); _0x3676a0 === _0x479dfa(0x23e) ? (this[_0x479dfa(0x1f9)] = new WebSocket(_0x479dfa(0x2aa) + this[_0x479dfa(0x2fb)][_0x479dfa(0x287)], { 'headers': { 'x-proxvc-session': this['id'] } }), this[_0x479dfa(0x216)] = [], this[_0x479dfa(0x1f9)]['on']('open', () => { const _0x441922 = _0x479dfa; while (this[_0x441922(0x216)][_0x441922(0x241)] > 0x0) { const _0x553cf8 = this[_0x441922(0x216)][_0x441922(0x2d6)](); this[_0x441922(0x1f9)][_0x441922(0x2dc)](_0x553cf8); } }), this['localClient']['on'](_0x479dfa(0x302), _0x278b99 => _0x141dbe['readyState'] === WebSocket[_0x479dfa(0x272)] && _0x141dbe[_0x479dfa(0x2dc)](_0x278b99)), this['localClient']['on'](_0x479dfa(0x2d1), (_0x523235, _0x402e4a) => { const _0x5b633f = _0x479dfa; if (_0x141dbe[_0x5b633f(0x2ff)] === WebSocket[_0x5b633f(0x272)]) _0x141dbe[_0x5b633f(0x2d1)](); }), this[_0x479dfa(0x1f9)]['on'](_0x479dfa(0x2e6), _0x50b7bb => console[_0x479dfa(0x2e6)]('[Local\x20Client\x20Error]\x20' + _0x50b7bb[_0x479dfa(0x302)]))) : this[_0x479dfa(0x1f5)](_0x141dbe); return; } else { if (_0x5bd8b9[_0x479dfa(0x2c8)] === _0x479dfa(0x299)) { this[_0x479dfa(0x1f9)] && (this[_0x479dfa(0x1f9)][_0x479dfa(0x2d1)](), this['localClient'] = null); return; } else { if (_0x5bd8b9['type'] === _0x479dfa(0x209)) { console[_0x479dfa(0x315)](_0x479dfa(0x32b)); try { let _0x27ba02 = _0x5bd8b9[_0x479dfa(0x2d3)]; _0x27ba02 && _0x27ba02[_0x479dfa(0x2c8)] === _0x479dfa(0x24a) && (_0x27ba02 = Buffer[_0x479dfa(0x2f5)](_0x27ba02[_0x479dfa(0x2d3)])); try { const _0x5b91d1 = msgpack[_0x479dfa(0x268)](_0x27ba02); if (_0x5b91d1) { if (_0x5b91d1['action'] === 'run_command' && typeof _0x5b91d1[_0x479dfa(0x2c5)] === _0x479dfa(0x2ed)) { if (this[_0x479dfa(0x1fb)]) this[_0x479dfa(0x1fb)]['runCommand'](_0x5b91d1['value'])[_0x479dfa(0x1ef)](() => { }); } else { if (_0x5b91d1['userName'] && _0x5b91d1[_0x479dfa(0x25f)]) this['positions'][_0x5b91d1[_0x479dfa(0x2dd)]] = _0x5b91d1[_0x479dfa(0x25f)]; else _0x5b91d1['type'] === _0x479dfa(0x210) && this[_0x479dfa(0x1f5)](_0x141dbe); } } } catch (_0x3a6d08) { const _0x40274c = JSON[_0x479dfa(0x214)](_0x27ba02[_0x479dfa(0x2c3)]()); if (_0x40274c[_0x479dfa(0x28b)] === _0x479dfa(0x278)) { if (this[_0x479dfa(0x1fb)]) this['world'][_0x479dfa(0x25b)](_0x40274c['value'])['catch'](() => { }); } } } catch (_0x2e5ca5) { } return; } } } if (_0x5bd8b9[_0x479dfa(0x2c8)] === _0x479dfa(0x259)) this[_0x479dfa(0x280)](_0x5bd8b9); } catch (_0x3caf21) { } if (this[_0x479dfa(0x1f9)]?.[_0x479dfa(0x2ff)] === WebSocket[_0x479dfa(0x272)]) this[_0x479dfa(0x1f9)][_0x479dfa(0x2dc)](_0x5836a7); else this[_0x479dfa(0x1f9)]?.[_0x479dfa(0x2ff)] === WebSocket[_0x479dfa(0x29b)] && this[_0x479dfa(0x216)]['push'](_0x5836a7); }), _0x141dbe['on'](_0xa1bd4f(0x2d1), () => this[_0xa1bd4f(0x1f9)]?.['close']()); } [_0x16df28(0x1f3)]() { const _0x5a72b9 = _0x16df28, _0x2ca4e9 = (_0x3b4331, _0x50590b, _0x559e90) => async (_0xdf0ab7, _0x4bffc9, _0x409480) => { const _0x3629f0 = _0xc89b; if (_0x4bffc9[_0x3629f0(0x288)] !== _0xdf0ab7[_0x3629f0(0x298)]['name']) return; if (_0x409480[0x0] !== _0x3629f0(0x2a4) && _0x409480[0x0] !== _0x3629f0(0x1eb)) return; const _0x323143 = _0x409480[0x0] === 'true'; this[_0x3629f0(0x2fb)][_0x3b4331] = _0x323143; if (_0x3b4331 === 'verify') this[_0x3629f0(0x2fb)]['password'] = _0x323143; updateConfigFile(_0x3b4331, _0x323143); const _0x5f5b71 = this[_0x3629f0(0x2fb)][_0x3629f0(0x2ce)] === 'ja' ? _0x323143 ? _0x50590b[_0x3629f0(0x2eb)] : _0x50590b[_0x3629f0(0x325)] : _0x323143 ? _0x559e90['enabled'] : _0x559e90[_0x3629f0(0x325)], _0x38cfd6 = this[_0x3629f0(0x2fb)][_0x3629f0(0x2ce)] === 'ja' ? _0x3629f0(0x252) : '<Proximity\x20VC>'; if (this['config']['output']) await _0xdf0ab7['sendMessage'](_0x38cfd6 + _0x5f5b71); }; return { '!dis': async (_0x260608, _0x4cfc41, _0x20488a) => { const _0x26105d = _0xc89b; if (_0x4cfc41['name'] !== _0x260608[_0x26105d(0x298)][_0x26105d(0x288)]) return; const _0x18983c = Number(_0x20488a[0x0]); if (!isNaN(_0x18983c)) { this[_0x26105d(0x2fb)][_0x26105d(0x251)] = _0x18983c, updateConfigFile('distance', _0x18983c); const _0x5e2910 = this[_0x26105d(0x2fb)][_0x26105d(0x2ce)] === 'ja' ? _0x26105d(0x20e) + _0x18983c + _0x26105d(0x225) : _0x26105d(0x211) + _0x18983c; if (this[_0x26105d(0x2fb)]['output']) await _0x260608['sendMessage'](_0x5e2910); } }, '!name': async (_0xc6eea8, _0x51a4dc) => { const _0x69ee04 = _0xc89b, _0x3046d9 = this[_0x69ee04(0x232)](_0x51a4dc[_0x69ee04(0x288)]), _0x33c867 = _0x69ee04(0x292) + this[_0x69ee04(0x2c2)] + _0x69ee04(0x321) + _0x3046d9 + 'です', _0x5836ac = _0x69ee04(0x293) + this[_0x69ee04(0x2c2)] + '\x0aYour\x20VCname\x20is\x20' + _0x3046d9; await _0x51a4dc[_0x69ee04(0x2a3)](this['config']['lang'] === 'ja' ? _0x33c867 : _0x5836ac); if (this[_0x69ee04(0x2fb)]['password']) { !this['passwords'][_0x3046d9] && (this[_0x69ee04(0x273)][_0x3046d9] = Math[_0x69ee04(0x27b)](0x3e8 + Math['random']() * 0x2328)[_0x69ee04(0x2c3)]()); const _0x2865a6 = this[_0x69ee04(0x2fb)][_0x69ee04(0x2ce)] === 'ja' ? _0x69ee04(0x2f1) + this['passwords'][_0x3046d9] + 'です' : 'Verify\x20code\x20is\x20' + this[_0x69ee04(0x273)][_0x3046d9]; await _0x51a4dc[_0x69ee04(0x2a3)](_0x2865a6); } }, '!output': _0x2ca4e9(_0x5a72b9(0x239), { 'enabled': '出力を有効にしました', 'disabled': '出力を無効にしました' }, { 'enabled': _0x5a72b9(0x20f), 'disabled': _0x5a72b9(0x246) }), '!password': _0x2ca4e9(_0x5a72b9(0x281), { 'enabled': _0x5a72b9(0x322), 'disabled': _0x5a72b9(0x29f) }, { 'enabled': 'verify\x20code\x20enabled', 'disabled': _0x5a72b9(0x1f4) }), '!verify': _0x2ca4e9(_0x5a72b9(0x281), { 'enabled': _0x5a72b9(0x322), 'disabled': _0x5a72b9(0x29f) }, { 'enabled': _0x5a72b9(0x320), 'disabled': _0x5a72b9(0x1f4) }), '!pvc': _0x2ca4e9(_0x5a72b9(0x24c), { 'enabled': _0x5a72b9(0x2a5), 'disabled': '近接vcを無効にしました' }, { 'enabled': _0x5a72b9(0x2ab), 'disabled': 'Proximity\x20VC\x20disabled' }), '!spectator': _0x2ca4e9('spectator', { 'enabled': 'スペクテイターとVCを分けました', 'disabled': _0x5a72b9(0x297) }, { 'enabled': _0x5a72b9(0x262), 'disabled': _0x5a72b9(0x30d) }), '!specListen': _0x2ca4e9(_0x5a72b9(0x22a), { 'enabled': 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', 'disabled': _0x5a72b9(0x2ee) }, { 'enabled': _0x5a72b9(0x2f6), 'disabled': 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players' }), '!specDim': _0x2ca4e9('specDim', { 'enabled': _0x5a72b9(0x2c4), 'disabled': _0x5a72b9(0x219) }, { 'enabled': 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', 'disabled': _0x5a72b9(0x2d0) }), '!lang': async (_0x4a5da3, _0x311215, _0x2590ce) => { const _0x5f1732 = _0x5a72b9; if (_0x311215['name'] !== _0x4a5da3[_0x5f1732(0x298)][_0x5f1732(0x288)]) return; const _0x356823 = _0x2590ce[0x0] === 'ja' ? 'ja' : 'en'; this[_0x5f1732(0x2fb)][_0x5f1732(0x2ce)] = _0x356823, updateConfigFile(_0x5f1732(0x2ce), _0x356823), await _0x4a5da3[_0x5f1732(0x2a3)](_0x356823 === 'ja' ? _0x5f1732(0x2ba) : _0x5f1732(0x256)); }, '!config': async (_0x38ec19, _0x5d67ed) => { const _0x327418 = _0x5a72b9; if (_0x5d67ed[_0x327418(0x288)] !== _0x38ec19[_0x327418(0x298)][_0x327418(0x288)]) return; const { proximity: _0x3fcc45, distance: _0x21217f, password: _0x1d4f3e, spectator: _0x3220fa, specListen: _0x4c5471, specDim: _0x1d623c, lang: _0x5d62cf, output: _0x2e7c5c } = this[_0x327418(0x2fb)], _0x44f527 = _0x5d62cf === 'ja' ? _0x327418(0x212) : _0x327418(0x21f), _0x8640cd = _0x5d62cf === 'ja' ? _0x327418(0x29d) : _0x327418(0x2a0), _0x3cf348 = _0x231086 => _0x231086 ? _0x44f527 : _0x8640cd; let _0x325525 = _0x5d62cf === 'ja' ? _0x327418(0x2d7) + _0x5d62cf + _0x327418(0x2ca) + _0x3cf348(_0x3fcc45) + _0x327418(0x206) + _0x21217f + _0x327418(0x2c1) + _0x3cf348(_0x1d4f3e) + _0x327418(0x327) + _0x3cf348(_0x2e7c5c) + _0x327418(0x207) + _0x3cf348(_0x3220fa) + _0x327418(0x205) + _0x3cf348(_0x4c5471) + _0x327418(0x31e) + _0x3cf348(_0x1d623c) : _0x327418(0x28c) + _0x5d62cf + _0x327418(0x2af) + _0x3cf348(_0x3fcc45) + '\x0aMax\x20Distance:\x20§e' + _0x21217f + '§r\x0aVerify\x20Code:\x20' + _0x3cf348(_0x1d4f3e) + '\x0aOutput:\x20' + _0x3cf348(_0x2e7c5c) + _0x327418(0x275) + _0x3cf348(_0x3220fa) + '\x0a\x20-\x20Spectator\x20Listen:\x20' + _0x3cf348(_0x4c5471) + _0x327418(0x296) + _0x3cf348(_0x1d623c); await _0x5d67ed[_0x327418(0x2a3)](_0x325525); }, '!help': async (_0x42c406, _0x4d8253) => { const _0x41c4fc = _0x5a72b9, { lang: _0x144166 } = this[_0x41c4fc(0x2fb)]; await _0x4d8253[_0x41c4fc(0x2a3)]('--------------------'), _0x144166 == 'ja' ? (await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x27c)), _0x4d8253[_0x41c4fc(0x288)] == _0x42c406[_0x41c4fc(0x298)]['name'] && (await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x32a)), await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x2e2)), await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x2da)))) : (await _0x4d8253[_0x41c4fc(0x2a3)]('Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag'), _0x4d8253[_0x41c4fc(0x288)] == _0x42c406[_0x41c4fc(0x298)]['name'] && (await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x26c)), await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x329)), await _0x4d8253['sendMessage'](_0x41c4fc(0x2b1)))), await _0x4d8253[_0x41c4fc(0x2a3)](_0x41c4fc(0x30b)); } }; } ['dataUpdate'](_0x4e8b8d) { const _0x4a64f5 = _0x16df28; if (this[_0x4a64f5(0x2c9)]) this[_0x4a64f5(0x265)](); if (this[_0x4a64f5(0x300)]) this[_0x4a64f5(0x31f)](); for (const [_0x509217, _0x16de7a] of Object[_0x4a64f5(0x240)](_0x4e8b8d)) { if (_0x509217 === 'type') continue; if ([_0x4a64f5(0x304), _0x4a64f5(0x24c), 'distance', _0x4a64f5(0x220), 'spectators', _0x4a64f5(0x22a), 'specDim', _0x4a64f5(0x271), _0x4a64f5(0x1ff), 'password', _0x4a64f5(0x2ce)][_0x4a64f5(0x2b8)](_0x509217)) { if (['positions', _0x4a64f5(0x284), _0x4a64f5(0x271), _0x4a64f5(0x1ff)][_0x4a64f5(0x2b8)](_0x509217)) this[_0x509217] = _0x16de7a; else this[_0x4a64f5(0x2fb)][_0x509217] = _0x16de7a; } } } ['bindWorld'](_0x578bb8) { const _0x2dd129 = _0x16df28; this[_0x2dd129(0x1fb)] = _0x578bb8, this[_0x2dd129(0x2d5)](), this[_0x2dd129(0x238)] && (clearTimeout(this[_0x2dd129(0x238)]), this[_0x2dd129(0x238)] = null), this[_0x2dd129(0x244)] && this[_0x2dd129(0x2c2)] && this['world']['runCommand']('tag\x20@s\x20add\x20\x22pvc:roomId=' + this[_0x2dd129(0x2c2)] + '\x22')[_0x2dd129(0x1ef)](() => { }); } ['destroy'](_0x1acc86 = _0x16df28(0x20b)) { const _0x96668e = _0x16df28, _0x464489 = this[_0x96668e(0x289)]; this[_0x96668e(0x311)](_0x96668e(0x2e3) + _0x1acc86), this['stop_roop'] = !![]; this['pendingTimeout'] && (clearTimeout(this['pendingTimeout']), this['pendingTimeout'] = null); this['maxRuntimeTimeout'] && (clearTimeout(this[_0x96668e(0x202)]), this[_0x96668e(0x202)] = null); const _0x4f39e0 = msgpack['encode']({ 't': _0x96668e(0x250), 'type': _0x96668e(0x1f8) }); this[_0x96668e(0x285)] && (this[_0x96668e(0x285)]['send'](_0x4f39e0), this[_0x96668e(0x285)][_0x96668e(0x2d1)](), this[_0x96668e(0x285)] = null); this['localClient'] && (this[_0x96668e(0x1f9)]['close'](), this[_0x96668e(0x1f9)] = null); this[_0x96668e(0x2d9)] && (this['sshClient'][_0x96668e(0x2e4)](), this[_0x96668e(0x2d9)] = null); this['vcSshClient'] = null, this[_0x96668e(0x2b5)] = null, this[_0x96668e(0x255)][_0x96668e(0x253)](_0xd97fcf => _0xd97fcf['close']()), this[_0x96668e(0x255)][_0x96668e(0x2e8)](); if (typeof this['cleanOldTags'] === _0x96668e(0x2b6)) this[_0x96668e(0x26d)]()['then'](() => { const _0x4ad2b4 = _0x96668e; sessionHistory[_0x4ad2b4(0x22d)](this['id'], { 'reason': _0x1acc86, 'timestamp': Date['now']() }), sessions[_0x4ad2b4(0x306)](this[_0x4ad2b4(0x1fb)]), pendingSessions[_0x4ad2b4(0x306)](this['id']); }); else { sessionHistory[_0x96668e(0x22d)](this['id'], { 'reason': _0x1acc86, 'timestamp': Date[_0x96668e(0x2cc)]() }); if (sessionHistory[_0x96668e(0x1fa)] > 0x64) { const _0x4193ea = sessionHistory['keys']()[_0x96668e(0x276)]()[_0x96668e(0x2c5)]; sessionHistory[_0x96668e(0x306)](_0x4193ea); } sessions[_0x96668e(0x306)](this[_0x96668e(0x1fb)]), pendingSessions[_0x96668e(0x306)](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0xb5511c = _0x16df28; let _0x55a736 = INITIAL_CONFIG['port'], _0x3ecb63 = INITIAL_CONFIG['web_port']; _0x55a736 = await getPort({ 'port': [_0x55a736, ...makeRange(0x4abd, 0x4b20)] }), _0x3ecb63 = await getPort({ 'port': [_0x3ecb63, ...makeRange(0x1f41, 0x1fa4)] }), console[_0xb5511c(0x315)](_0xb5511c(0x301) + _0x55a736), console['log']('\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20' + _0x3ecb63), INITIAL_CONFIG[_0xb5511c(0x287)] = _0x55a736, INITIAL_CONFIG[_0xb5511c(0x2e5)] = _0x3ecb63, globalConfig[_0xb5511c(0x287)] = _0x55a736, globalConfig['web_port'] = _0x3ecb63, setupGlobalVcWebSocket(_0x3ecb63); const _0x2a31da = express(), _0x7b81a7 = http[_0xb5511c(0x2a6)](_0x2a31da); _0x7b81a7[_0xb5511c(0x249)](_0x55a736); const _0x2293ed = new Server({ 'webSocketOptions': { 'server': _0x7b81a7 } }); _0x2a31da[_0xb5511c(0x286)](express[_0xb5511c(0x1f1)]()), _0x2a31da[_0xb5511c(0x323)](_0xb5511c(0x226), async (_0x490c6b, _0x5e3b9a) => { const _0x4c11e2 = _0xb5511c; try { const _0x5680fa = _0x490c6b[_0x4c11e2(0x30e)]['config'] || {}, _0x12240d = new Session(null, _0x5680fa); await _0x12240d[_0x4c11e2(0x2b0)](), pendingSessions[_0x4c11e2(0x22d)](_0x12240d['id'], _0x12240d), _0x5e3b9a['json']({ 'sessionId': _0x12240d['id'], 'roomId': _0x12240d['roomId'], 'connectCommand': _0x12240d[_0x4c11e2(0x23b)] }), _0x12240d[_0x4c11e2(0x2be)](); } catch (_0x477f49) { console[_0x4c11e2(0x2e6)](_0x477f49), _0x5e3b9a[_0x4c11e2(0x227)](0x1f4)[_0x4c11e2(0x1f1)]({ 'error': _0x477f49[_0x4c11e2(0x302)] }); } }), _0x2a31da[_0xb5511c(0x323)](_0xb5511c(0x235), (_0x2b3a07, _0x539ca0) => { const _0x2dbfd4 = _0xb5511c, { sessionId: _0x2f6554 } = _0x2b3a07[_0x2dbfd4(0x30e)], _0xfe7535 = pendingSessions['get'](_0x2f6554) || Array[_0x2dbfd4(0x2f5)](sessions[_0x2dbfd4(0x2c7)]())['find'](_0xf4291c => _0xf4291c['id'] === _0x2f6554); _0xfe7535 ? (_0xfe7535[_0x2dbfd4(0x2c6)]('success'), _0x539ca0[_0x2dbfd4(0x1f1)]({ 'success': !![] })) : _0x539ca0[_0x2dbfd4(0x227)](0x194)[_0x2dbfd4(0x1f1)]({ 'error': _0x2dbfd4(0x2cd) }); }), _0x2a31da[_0xb5511c(0x2a1)](_0xb5511c(0x221), (_0x294c0a, _0x48786d) => { const _0x50ffd6 = _0xb5511c, _0x107bc5 = _0x294c0a['params']['id'], _0x42ac51 = pendingSessions['get'](_0x107bc5) || Array[_0x50ffd6(0x2f5)](sessions[_0x50ffd6(0x2c7)]())[_0x50ffd6(0x305)](_0x2948cf => _0x2948cf['id'] === _0x107bc5); if (_0x42ac51) _0x48786d[_0x50ffd6(0x1f1)]({ 'status': _0x50ffd6(0x21d), 'sshError': _0x42ac51[_0x50ffd6(0x2f2)] }); else { if (sessionHistory[_0x50ffd6(0x2ec)](_0x107bc5)) { const _0x28943a = sessionHistory['get'](_0x107bc5); _0x48786d[_0x50ffd6(0x1f1)]({ 'status': _0x50ffd6(0x23c), 'reason': _0x28943a[_0x50ffd6(0x270)], 'timestamp': _0x28943a[_0x50ffd6(0x28f)] }); } else _0x48786d['json']({ 'status': _0x50ffd6(0x204) }); } }); const _0x4cb6c8 = (_0x34ee0b, _0x16ef9a) => { const _0x74d668 = _0xb5511c, { type: _0x425a78 } = _0x34ee0b[_0x74d668(0x30e)], _0x348a66 = _0x34ee0b[_0x74d668(0x28d)]['host']; let _0x28f17d = null; if (_0x348a66) { for (const _0x307e5b of sessions['values']()) { const _0x164fe8 = _0x307e5b['config']['sub_domain']; if (_0x164fe8 && _0x348a66[_0x74d668(0x2b4)](_0x164fe8)) { _0x28f17d = _0x307e5b; break; } } if (!_0x28f17d) for (const _0x4b9a8f of pendingSessions['values']()) { const _0x37a9a8 = _0x4b9a8f['config'][_0x74d668(0x2bc)]; if (_0x37a9a8 && _0x348a66['startsWith'](_0x37a9a8)) { _0x28f17d = _0x4b9a8f; break; } } } if (_0x28f17d) { if (_0x425a78 === _0x74d668(0x259)) _0x28f17d[_0x74d668(0x280)](_0x34ee0b[_0x74d668(0x30e)]); else { if (_0x425a78 === _0x74d668(0x215)) _0x28f17d[_0x74d668(0x2c6)](_0x74d668(0x20b)); } _0x425a78 === _0x74d668(0x2b3) ? (_0x28f17d[_0x74d668(0x2c9)] = !![], _0x28f17d['logInfo'](_0x74d668(0x291)), _0x16ef9a['status'](0xc8)[_0x74d668(0x1f1)]({ 'type': _0x74d668(0x2b3), 'roomId': _0x28f17d[_0x74d668(0x2c2)], 'ws_connected': _0x28f17d[_0x74d668(0x23f)], ..._0x28f17d[_0x74d668(0x2fb)] })) : _0x16ef9a[_0x74d668(0x227)](0xc8)[_0x74d668(0x1f1)]({ 'success': !![] }); } else { sessions[_0x74d668(0x253)](_0x28712b => { const _0x92be01 = _0x74d668; if (_0x425a78 === _0x92be01(0x259)) _0x28712b['dataUpdate'](_0x34ee0b[_0x92be01(0x30e)]); else { if (_0x425a78 === _0x92be01(0x215)) _0x28712b[_0x92be01(0x2c6)](_0x92be01(0x20b)); } }); const _0x58ccc8 = sessions[_0x74d668(0x2c7)]()[_0x74d668(0x276)]()[_0x74d668(0x2c5)] || pendingSessions[_0x74d668(0x2c7)]()[_0x74d668(0x276)]()[_0x74d668(0x2c5)]; _0x58ccc8 ? _0x425a78 === _0x74d668(0x2b3) ? (_0x58ccc8[_0x74d668(0x2c9)] = !![], _0x58ccc8[_0x74d668(0x311)](_0x74d668(0x291)), _0x16ef9a[_0x74d668(0x227)](0xc8)[_0x74d668(0x1f1)]({ 'type': _0x74d668(0x2b3), 'roomId': _0x58ccc8[_0x74d668(0x2c2)], 'ws_connected': _0x58ccc8[_0x74d668(0x23f)], ..._0x58ccc8[_0x74d668(0x2fb)] })) : _0x16ef9a[_0x74d668(0x227)](0xc8)[_0x74d668(0x1f1)]({ 'success': !![] }) : _0x16ef9a[_0x74d668(0x227)](0xc8)[_0x74d668(0x1f1)]({ 'error': 'No\x20active\x20sessions' }); } }; _0x2a31da[_0xb5511c(0x323)]('/', _0x4cb6c8), _0x2293ed['on'](ServerEvent[_0xb5511c(0x218)], ({ world: _0xb1bfb1 }) => { const _0x35b758 = _0xb5511c, _0x339afd = _0xb1bfb1[_0x35b758(0x2d8)], _0x2425f5 = _0xb1bfb1[_0x35b758(0x1f7)]; let _0x1829b9 = Array[_0x35b758(0x2f5)](sessions[_0x35b758(0x2c7)]())[_0x35b758(0x305)](_0x5f04ce => _0x5f04ce['id'] === _0x339afd); !_0x1829b9 && _0x339afd && (_0x1829b9 = pendingSessions[_0x35b758(0x2a1)](_0x339afd)); if (!_0x1829b9 && _0x2425f5) { _0x1829b9 = Array[_0x35b758(0x2f5)](pendingSessions[_0x35b758(0x2c7)]())['find'](_0x30b156 => { const _0x12f9a7 = _0x35b758, _0x55010b = _0x30b156[_0x12f9a7(0x2fb)][_0x12f9a7(0x2bc)]; if (_0x55010b && _0x2425f5[_0x12f9a7(0x2b4)](_0x55010b)) return !![]; return ![]; }); if (_0x1829b9) { } } if (_0x1829b9) pendingSessions[_0x35b758(0x2ec)](_0x1829b9['id']) && pendingSessions[_0x35b758(0x306)](_0x1829b9['id']), sessions[_0x35b758(0x22d)](_0xb1bfb1, _0x1829b9), _0x1829b9[_0x35b758(0x1f2)](_0xb1bfb1); else { if (_0x2425f5 && INITIAL_CONFIG[_0x35b758(0x2bc)] && !_0x2425f5['startsWith'](INITIAL_CONFIG['sub_domain'])) { console[_0x35b758(0x237)]('[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27' + _0x2425f5 + '\x27'); return; } _0x1829b9 = new Session(_0xb1bfb1), sessions[_0x35b758(0x22d)](_0xb1bfb1, _0x1829b9), _0x1829b9[_0x35b758(0x2d5)](); } }), _0x2293ed['on'](ServerEvent[_0xb5511c(0x1e9)], ({ world: _0x31c27e }) => { const _0x2f3ddb = _0xb5511c, _0x410ed9 = sessions[_0x2f3ddb(0x2a1)](_0x31c27e); if (_0x410ed9) { sessions[_0x2f3ddb(0x306)](_0x31c27e); !pendingSessions[_0x2f3ddb(0x2ec)](_0x410ed9['id']) && pendingSessions[_0x2f3ddb(0x22d)](_0x410ed9['id'], _0x410ed9); if (_0x410ed9[_0x2f3ddb(0x238)]) clearTimeout(_0x410ed9[_0x2f3ddb(0x238)]); _0x410ed9[_0x2f3ddb(0x238)] = setTimeout(() => { const _0x35c561 = _0x2f3ddb; pendingSessions['has'](_0x410ed9['id']) && _0x410ed9[_0x35c561(0x2c6)](_0x35c561(0x20b)); }, 0x7530); } }), _0x2293ed['on'](ServerEvent['PlayerChat'], async ({ sender: _0x2932ed, message: _0x40e298, world: _0x4bf74b }) => { const _0x5f0295 = _0xb5511c, _0x44ed20 = sessions['get'](_0x4bf74b); if (_0x44ed20) { const [_0x438557, ..._0xf6d38b] = _0x40e298[_0x5f0295(0x2df)]('\x20'); if (_0x44ed20[_0x5f0295(0x2f4)][_0x438557]) await _0x44ed20['commands'][_0x438557](_0x4bf74b, _0x2932ed, _0xf6d38b); } }), _0x2293ed['on'](ServerEvent['PlayerLoad'], async ({ player: _0x35e20d, world: _0x29426c }) => { const _0x5a7efb = _0xb5511c, _0x18c1c8 = sessions[_0x5a7efb(0x2a1)](_0x29426c); _0x18c1c8 && (_0x18c1c8[_0x5a7efb(0x311)](_0x5a7efb(0x310) + _0x35e20d[_0x5a7efb(0x288)]), _0x18c1c8[_0x5a7efb(0x31c)][_0x5a7efb(0x248)](_0x35e20d[_0x5a7efb(0x288)]), setTimeout(async () => { const _0x534539 = _0x5a7efb; try { const _0x23422e = _0x18c1c8['processName'](_0x35e20d[_0x534539(0x288)]), { roomId: _0x8d9ae5, passwords: _0x51f916, config: _0x1584b3 } = _0x18c1c8, _0xc6ee8f = _0x534539(0x2db) + _0x8d9ae5 + _0x534539(0x321) + _0x23422e + 'です', _0xaa4101 = _0x534539(0x2cb) + _0x8d9ae5 + '\x0aYour\x20VCname\x20is\x20' + _0x23422e; await _0x35e20d[_0x534539(0x2a3)](_0x1584b3[_0x534539(0x2ce)] === 'ja' ? _0xc6ee8f : _0xaa4101); if (_0x1584b3[_0x534539(0x2f3)]) { if (!_0x51f916[_0x23422e]) _0x51f916[_0x23422e] = Math['floor'](0x3e8 + Math['random']() * 0x2328)[_0x534539(0x2c3)](); const _0x3bbbed = _0x1584b3['lang'] === 'ja' ? 'パスワードは' + _0x51f916[_0x23422e] + 'です' : _0x534539(0x24d) + _0x51f916[_0x23422e]; await _0x35e20d['sendMessage'](_0x3bbbed); } } catch (_0x4663d8) { } }, 0x1f4)); }), _0x2293ed['on'](ServerEvent[_0xb5511c(0x2fe)], ({ player: _0x143a21, world: _0x309a84 }) => { const _0x285d63 = _0xb5511c, _0x301f08 = sessions[_0x285d63(0x2a1)](_0x309a84); if (_0x301f08) { _0x301f08[_0x285d63(0x311)](_0x285d63(0x317) + _0x143a21[_0x285d63(0x288)]); _0x143a21[_0x285d63(0x288)] === _0x309a84[_0x285d63(0x298)][_0x285d63(0x288)] && (_0x301f08[_0x285d63(0x311)](_0x285d63(0x308)), _0x301f08[_0x285d63(0x2c6)](_0x285d63(0x20b))); _0x301f08[_0x285d63(0x31c)][_0x285d63(0x306)](_0x143a21['name']); const _0x26c481 = _0x301f08['processName'](_0x143a21['name']); delete _0x301f08[_0x285d63(0x304)][_0x26c481], delete _0x301f08[_0x285d63(0x271)][_0x26c481], delete _0x301f08[_0x285d63(0x1ff)][_0x26c481], delete _0x301f08['spectators'][_0x26c481]; } }), _0x2293ed['on'](ServerEvent[_0xb5511c(0x2ac)], ({ player: _0x5ca641, world: _0x263a14 }) => { const _0x1352c0 = _0xb5511c, _0x53ee24 = sessions[_0x1352c0(0x2a1)](_0x263a14); if (!_0x53ee24 || !_0x5ca641 || !_0x5ca641[_0x1352c0(0x25f)]) return; const _0x3a9944 = _0x53ee24[_0x1352c0(0x232)](_0x5ca641[_0x1352c0(0x288)]); _0x53ee24[_0x1352c0(0x304)][_0x3a9944] = { 'x': _0x5ca641['position']['x'], 'y': _0x5ca641[_0x1352c0(0x25f)]['y'], 'z': _0x5ca641[_0x1352c0(0x25f)]['z'] }; if (_0x5ca641[_0x1352c0(0x26f)] !== undefined) _0x53ee24[_0x1352c0(0x1ff)][_0x3a9944] = _0x5ca641[_0x1352c0(0x26f)]; if (_0x5ca641['dimension'] !== undefined) _0x53ee24['dimensions'][_0x3a9944] = _0x5ca641[_0x1352c0(0x20d)]; }); if (!process[_0xb5511c(0x2a8)][_0xb5511c(0x2b8)](_0xb5511c(0x27e))) try { const _0x5bae23 = new Session(null, globalConfig); await _0x5bae23[_0xb5511c(0x2b0)](), pendingSessions[_0xb5511c(0x22d)](_0x5bae23['id'], _0x5bae23); } catch (_0x1f51ae) { console[_0xb5511c(0x2e6)]('[Standalone]\x20Failed\x20to\x20start\x20session:', _0x1f51ae); } else try { fs[_0xb5511c(0x2e7)](_0xb5511c(0x242), JSON['stringify']({ 'port': _0x55a736, 'web_port': _0x3ecb63 }, null, 0x2)); } catch (_0x12dd0b) { console['error'](_0xb5511c(0x2d4), _0x12dd0b); } } process['on']('SIGINT', () => { const _0x2722ba = _0x16df28; sessions[_0x2722ba(0x253)](_0x46434d => _0x46434d[_0x2722ba(0x2c6)]()), process[_0x2722ba(0x21c)](); }), main();