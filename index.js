const _0x2b5f26 = _0x12ad; (function (_0xf4abe3, _0x173d32) { const _0xda001d = _0x12ad, _0x165c66 = _0xf4abe3(); while (!![]) { try { const _0x429446 = -parseInt(_0xda001d(0x1ff)) / 0x1 + parseInt(_0xda001d(0xef)) / 0x2 + parseInt(_0xda001d(0x135)) / 0x3 + parseInt(_0xda001d(0x104)) / 0x4 * (parseInt(_0xda001d(0x11d)) / 0x5) + -parseInt(_0xda001d(0x138)) / 0x6 + -parseInt(_0xda001d(0x159)) / 0x7 * (parseInt(_0xda001d(0x129)) / 0x8) + -parseInt(_0xda001d(0x1b0)) / 0x9 * (-parseInt(_0xda001d(0x178)) / 0xa); if (_0x429446 === _0x173d32) break; else _0x165c66['push'](_0x165c66['shift']()); } catch (_0x1816a2) { _0x165c66['push'](_0x165c66['shift']()); } } }(_0x341c, 0x8c968)); const { Server, ServerEvent, Player } = require(_0x2b5f26(0x112)), WebSocket = require('ws'), fetch = require(_0x2b5f26(0x1f6)), wanakana = require('wanakana'), fs = require('fs'), fsPromises = require('fs')[_0x2b5f26(0x1e5)], JSON5 = require(_0x2b5f26(0x1c4)), getPort = require(_0x2b5f26(0x1ec)), express = require(_0x2b5f26(0x164)), http = require(_0x2b5f26(0x102)), zlib = require(_0x2b5f26(0x132)), msgpack = require(_0x2b5f26(0x10b)), { randomUUID } = require('crypto'); let sshHandler = null; const RELAY_SERVER_DOMAIN = _0x2b5f26(0xea), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x2b5f26(0x13d), _0x2b5f26(0x113), _0x2b5f26(0x15c)]; let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs['existsSync'](filePath)) try { const fileContent = fs['readFileSync'](filePath, _0x2b5f26(0x20c)); globalConfig = JSON5[_0x2b5f26(0x151)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x1bc8ce) { console[_0x2b5f26(0xd0)](_0x2b5f26(0x1dc) + filePath + ':', _0x1bc8ce[_0x2b5f26(0x158)]); } } !configLoaded && console[_0x2b5f26(0x13e)](_0x2b5f26(0xf3)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'output': !![], 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x2b5f26(0x11c)] = INITIAL_CONFIG[_0x2b5f26(0x180)] ?? INITIAL_CONFIG[_0x2b5f26(0x11c)]; async function updateConfigFile(_0x10a96b, _0x384538) { const _0x117bf4 = _0x2b5f26; if (!configPath) return; try { let _0x57eb25 = await fsPromises[_0x117bf4(0xff)](configPath, 'utf8'); const _0x5391a4 = new RegExp('(\x22' + _0x10a96b + _0x117bf4(0x202)), _0x145c29 = typeof _0x384538 === _0x117bf4(0x146) ? '\x22' + _0x384538 + '\x22' : _0x384538, _0x1d808a = _0x57eb25[_0x117bf4(0x139)](_0x5391a4, '$1' + _0x145c29); _0x1d808a !== _0x57eb25 && await fsPromises[_0x117bf4(0x1ab)](configPath, _0x1d808a, _0x117bf4(0x20c)); } catch (_0x44a8a1) { console['error'](_0x117bf4(0x140), _0x44a8a1); } }; const makeRange = (_0x3af5a6, _0x1c03ce) => Array[_0x2b5f26(0x110)]({ 'length': _0x1c03ce - _0x3af5a6 + 0x1 }, (_0x29fd04, _0x8190fa) => _0x3af5a6 + _0x8190fa); let globalGatewayServer = null; function _0x341c() { const _0x239a7c = ['writeFile', 'Failed\x20to\x20write\x20server_info.json:', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', 'partner_disconnected', 'mc_connected', '621cNwjok', '退出:\x20', 'loop', 'type', 'OPEN', 'useResetTimer', 'filter', 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20言語の変更\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', 'spectator', 'スペクテイター同士の会話をディメンションごとに分けました', 'stop_roop', '=======================================================\x0a', 'clear', '/create-room?roomid=', 'startsWith', 'testfor\x20@a[tag=pvc:req_cmd]', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', 'http://', 'Session\x20destroying...\x20Reason:\x20', 'json5', '--------------------', '<Proximity\x20VC>', 'cleanOldTags', 'Proximity\x20VC\x20disabled', 'indexOf', 'pvcSessionId', 'json', 'relayed_vc_data', '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.', 'substring', 'SIGINT', 'startTcpexposer', 'catch', 'toString', 'list', 'localhost', 'timeout', 'reason', 'スペクテイターとVCを分けました', 'mcSshClient', 'logLog', 'setupVcRelayListeners', '認証コードを有効にしました', '[Config]\x20Error\x20parsing\x20', 'data', '\x0aProximity\x20VC:\x20', 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players', 'broadcastPositions', 'statusCode', 'Proximity\x20VC\x20enabled', '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20', 'consecutiveTimeouts', 'promises', 'relayWs', 'logInfo', 'https://', 'encode', 'disabled', 'proximity', 'get-port', 'web_port', '/connect\x20', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20minecraftチャットへの出力を有効/無効にできます\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20スペクテイターとVCを分けます', '近接vcを無効にしました', '認証コードは', 'forEach', 'verify\x20code\x20disabled', '§cDisabled§r', 'sendInitMessage', 'node-fetch', '出力を有効にしました', 'value', '<Proximity\x20VC>Changed\x20max\x20distance\x20to\x20', 'dataUpdate', 'positions', 'function', '[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27', 'server_info.json', '1004143ZSPCMe', '[MC\x20Relay]', 'Verify\x20code\x20is\x20', '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)', 'pvcDomain', 'No\x20active\x20sessions', 'に変更しました', 'startTimer', 'upgrade', 'all', 'WorldAdd', 'createCommands', 'then', 'utf8', 'statusMessage', 'sshError', 'tag\x20@a[tag=pvc:req_cmd]\x20remove\x20pvc:req_cmd', 'concat', '/room/', 'vcSshClient', 'includes', 'aliveSet', 'yRots', 'log', 'isProcessingTags', '接続を開始しました\x0a近接vc：', 'localClientBuffer', 'error', 'floor', 'nameCache', 'initialization', 'Output\x20disabled', 'stop', 'has', '/api/stop_session', 'server_shutdown', 'connectToRelayServer', 'distance', 'trim', 'partner_connected', 'active', 'tag\x20@s\x20add\x20\x22pvc:roomId=', '\x22]\x20remove\x20\x22', 'exit', '\x1b[33m[Log][', 'details', 'maxRuntimeTimeout', 'status', 'entries', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'sendInitialPayload', '[VC\x20Relay]', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', 'mcproxvc.fly.dev', 'verify\x20code\x20enabled', 'Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:', '\x0a出力\x20(Output):\x20', 'dimensions', '1866678cKKtcG', 'use', '\x0aスペクテイター分離\x20(Spectator):\x20', 'data_update', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'sshClient', '認証コードを無効にしました', 'createServer', 'commands', 'runCommand', 'round', 'set', 'です\x0aあなたのVCnameは', 'send', 'PlayerLoad', 'port', 'readFile', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', 'push', 'http', 'Password\x20is\x20', '2954128MfSIcZ', 'PlayerChat', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', 'close', 'inactivityTimer', '[Relay]\x20Connected\x20(ID:\x20', 'pvc:roomId=', 'msgpack-lite', 'vc_connected', 'next', 'map', 'passwords', 'from', 'url', './lib/server', './config.json5', 'handleDirectVcConnection', 'worldName', '§r\x0a認証コード\x20(Verify):\x20', 'querytarget\x20@e[type=player]', 'wss://', 'localClient', 'onlinePlayers', 'decode', 'password', '5RwaJVS', 'delete', 'pendingTimeout', 'spectators', 'players', '\x0a!help\x20for\x20command\x20list', 'Output\x20enabled', 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', '§aEnabled§r', 'pvc:req_cmd', '参加者はこのURLにアクセスしてください:', 'specDim', '5560hoJDJc', 'host', '--streamlit', 'random', 'readyState', '接続開始', 'pvc:', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', 'open', 'zlib', 'not_found', 'Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag', '161940MtMEvM', 'getAllTags', 'headers', '1563276CuInrP', 'replace', 'length', '<近接VC>', '§c無効§r', './config.jsonc', 'warn', '参加:\x20', '❌\x20設定ファイルの更新に失敗しました:', 'Minecraftから以下のコマンドで接続してください:', 'スペクテイターを共通のVCにしました', 'destroy', 'Session\x20not\x20found', 'yRot', 'string', '/api/start_session', 'handleTcpUpgrade', 'spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20スペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20スペクテイター同士の会話をディメンションごとに分けます', '\x0a近接VC\x20(Proximity):\x20', 'directVcClients', 'true', 'command_result', 'output', 'スペクテイター同士の会話を共通にしました', 'config', 'parse', 'lang', '/api/session_status/:id', '\x0a最大距離\x20(Distance):\x20§e', 'run_command', 'shouldBroadcast', 'ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20近接vcを有効/無効にできます', 'message', '9359JyJAED', 'disconnect_command', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', './config.json', 'resetTimer', '<近接VC>声の最大距離を', 'now', ']\x1b[0m\x20', 'Unknown\x20World', '[Auto-Stop][', '\x0a!help\x20でコマンド一覧を確認できます', 'express', 'Connection\x20started\x0aProximity\x20voice\x20chat:', 'finally', '[TCPExposer]\x20TCPExposerハンドラーが見つからないため、接続をスキップします。リレーサーバーを使用します。', 'startWebSession', '\x0aYour\x20VCname\x20is\x20', 'bindWorld', 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', '\x1b[36m[Info][', 'body', 'specListen', 'localPlayer', 'roomId', 'sendMessage', 'writeFileSync', 'keys', '\x20Error:', '\x0a声の届く距離：', 'Spectator\x20and\x20VC\x20separated', 'playersNames', '151290ohOLuC', 'get', 'gunzipSync', 'world', 'Pending\x20Session', 'processName', 'Tag\x20processing\x20error:', 'toRomaji', 'verify', 'tag\x20@a[tag=\x22', 'action', 'PlayerLeave', '\x0a=======================================================', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20information\x20output\x20to\x20minecraft\x20chat\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC', 'listen', 'testfor\x20@a[m=spectator]', 'userName', 'connectCommand', 'minecraft', 'params', 'sub_domain', 'victim', 'add', 'CONNECTING', 'values', 'name', 'split', 'パスワードは', 'spectatorSet', 'Server', 'init', 'dimension', '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'position', 'find', 'setupMcRelayListeners', 'success', 'test', 'stringify', 'size', '\x0a\x20-\x20Spectator\x20Listen:\x20', 'Buffer', '出力を無効にしました', 'enabled', 'Host\x20left.\x20Handing\x20stop\x20signal...', 'useRelay', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'PlayerTransform', 'timestamp', 'false', '\x0a\x20-\x20Spectator\x20Dimension:\x20']; _0x341c = function () { return _0x239a7c; }; return _0x341c(); } function _0x12ad(_0x3611eb, _0x292d5f) { _0x3611eb = _0x3611eb - 0xcb; const _0x341c07 = _0x341c(); let _0x12ad34 = _0x341c07[_0x3611eb]; return _0x12ad34; } async function startTcpexposer(_0x51b4cb, _0x2c0183, _0x7c3b62) { const _0x2e4304 = _0x2b5f26; return sshHandler && typeof sshHandler[_0x2e4304(0x1d0)] === _0x2e4304(0x1fc) ? await sshHandler[_0x2e4304(0x1d0)](_0x51b4cb, _0x2c0183, _0x7c3b62) : (_0x51b4cb['logInfo'](_0x2e4304(0x167)), _0x51b4cb[_0x2e4304(0x170)] = '', _0x51b4cb[_0x2e4304(0xd9)]('mc'), null); } function setupGlobalVcWebSocket(_0x2201dd) { const _0x2ed8ac = _0x2b5f26; if (globalGatewayServer) return; const _0x5b454a = express(), _0x2ebbe0 = http[_0x2ed8ac(0xf6)](_0x5b454a), _0x1c659a = new WebSocket[(_0x2ed8ac(0x195))]({ 'noServer': !![] }); _0x5b454a[_0x2ed8ac(0xf0)](express[_0x2ed8ac(0x1cb)]()), _0x5b454a['post']('/', (_0x5b8eea, _0x50c396) => { const _0x5aff8d = _0x2ed8ac, { type: _0x12b3f6 } = _0x5b8eea[_0x5aff8d(0x16d)], _0xafd815 = _0x5b8eea['headers'][_0x5aff8d(0x12a)]; let _0x5f16aa = null; if (_0xafd815) { for (const _0x3ce836 of sessions['values']()) { const _0x24d7b6 = _0x3ce836['config'][_0x5aff8d(0x18c)]; if (_0x24d7b6 && _0xafd815['startsWith'](_0x24d7b6)) { _0x5f16aa = _0x3ce836; break; } } if (!_0x5f16aa) for (const _0x177e70 of pendingSessions[_0x5aff8d(0x190)]()) { const _0x5d6992 = _0x177e70[_0x5aff8d(0x150)][_0x5aff8d(0x18c)]; if (_0x5d6992 && _0xafd815[_0x5aff8d(0x1bf)](_0x5d6992)) { _0x5f16aa = _0x177e70; break; } } } if (_0x5f16aa) { if (_0x12b3f6 === _0x5aff8d(0xf2)) _0x5f16aa[_0x5aff8d(0x1fa)](_0x5b8eea[_0x5aff8d(0x16d)]); else { if (_0x12b3f6 === _0x5aff8d(0x15a)) _0x5f16aa[_0x5aff8d(0x143)](_0x5aff8d(0x19c)); } _0x12b3f6 === 'initialization' ? (_0x5f16aa[_0x5aff8d(0x10c)] = !![], _0x5f16aa['logInfo']('接続開始'), _0x50c396[_0x5aff8d(0xe4)](0xc8)[_0x5aff8d(0x1cb)]({ 'type': _0x5aff8d(0xd3), 'roomId': _0x5f16aa[_0x5aff8d(0x170)], 'ws_connected': _0x5f16aa[_0x5aff8d(0x1af)], ..._0x5f16aa[_0x5aff8d(0x150)] })) : _0x50c396[_0x5aff8d(0xe4)](0xc8)[_0x5aff8d(0x1cb)]({ 'success': !![] }); } else _0x50c396['status'](0x194)['json']({ 'error': 'Session\x20not\x20found\x20for\x20this\x20domain' }); }), _0x5b454a[_0x2ed8ac(0x179)]('/', (_0x16fd82, _0x595fdd) => { const _0x2229de = _0x2ed8ac; _0x595fdd[_0x2229de(0xfc)](_0x2229de(0x1a6)); }), _0x2ebbe0['on'](_0x2ed8ac(0x207), (_0x554dfe, _0x3cd311, _0x35a6f1) => { const _0x3947ff = _0x2ed8ac; let _0x4c0ba8 = null, _0x519ece = null; try { const _0x47e222 = _0x554dfe[_0x3947ff(0x137)][_0x3947ff(0x12a)] || _0x3947ff(0x1d4); let _0xf3192e = _0x554dfe[_0x3947ff(0x111)] || '/'; if (_0xf3192e === '//') _0xf3192e = '/'; _0x519ece = new URL(_0xf3192e, _0x3947ff(0x1c2) + _0x47e222), _0x4c0ba8 = _0x519ece['searchParams'][_0x3947ff(0x179)]('clientType'); } catch (_0xcbda5e) { _0x4c0ba8 = null; } _0x4c0ba8 !== 'vc' ? sshHandler && typeof sshHandler[_0x3947ff(0x148)] === 'function' ? sshHandler[_0x3947ff(0x148)](_0x554dfe, _0x3cd311, _0x35a6f1, INITIAL_CONFIG[_0x3947ff(0xfe)]) : _0x3cd311['destroy']() : _0x1c659a['handleUpgrade'](_0x554dfe, _0x3cd311, _0x35a6f1, _0x59c2e1 => { const _0x2220e9 = _0x3947ff, _0x4e39be = _0x554dfe[_0x2220e9(0x137)][_0x2220e9(0x12a)]; let _0x36bc93 = null; if (_0x4e39be) { for (const _0x23106d of sessions[_0x2220e9(0x190)]()) { const _0x5671bd = _0x23106d['config'][_0x2220e9(0x18c)]; if (_0x5671bd && _0x4e39be[_0x2220e9(0x1bf)](_0x5671bd)) { _0x36bc93 = _0x23106d; break; } } if (!_0x36bc93) for (const _0x530542 of pendingSessions['values']()) { const _0x3e5967 = _0x530542[_0x2220e9(0x150)]['sub_domain']; if (_0x3e5967 && _0x4e39be[_0x2220e9(0x1bf)](_0x3e5967)) { _0x36bc93 = _0x530542; break; } } } if (_0x36bc93) _0x36bc93[_0x2220e9(0x114)](_0x59c2e1); else { const _0x2bf6fb = sessions[_0x2220e9(0x190)]()['next']()[_0x2220e9(0x1f8)] || pendingSessions[_0x2220e9(0x190)]()[_0x2220e9(0x10d)]()['value']; if (_0x2bf6fb) _0x2bf6fb[_0x2220e9(0x114)](_0x59c2e1); else _0x59c2e1[_0x2220e9(0x107)](); } }); }), _0x2ebbe0['listen'](_0x2201dd, () => { }), globalGatewayServer = _0x2ebbe0; }; class Session { constructor(_0x2a537c, _0x4d33cf = {}) { const _0x16fd16 = _0x2b5f26; this['id'] = randomUUID(), this[_0x16fd16(0x17b)] = _0x2a537c, this[_0x16fd16(0x115)] = _0x2a537c ? _0x2a537c[_0x16fd16(0x191)] || _0x16fd16(0x161) : _0x16fd16(0x17c), this[_0x16fd16(0xd2)] = new Map(), this[_0x16fd16(0x150)] = { ...INITIAL_CONFIG, ..._0x4d33cf }, this[_0x16fd16(0x170)] = this['config'][_0x16fd16(0x18c)], this[_0x16fd16(0x189)] = '', this[_0x16fd16(0x10f)] = {}, this[_0x16fd16(0x1fb)] = {}, this[_0x16fd16(0xcb)] = {}, this[_0x16fd16(0xee)] = {}, this[_0x16fd16(0x120)] = {}, this[_0x16fd16(0x11a)] = new Set(), this[_0x16fd16(0x156)] = !![], this[_0x16fd16(0x10c)] = ![], this[_0x16fd16(0x1af)] = ![], this[_0x16fd16(0x1bb)] = ![], this[_0x16fd16(0x1a5)] = ![], this[_0x16fd16(0x1b5)] = ![], this[_0x16fd16(0x1e6)] = null, this[_0x16fd16(0x119)] = null, this[_0x16fd16(0x14b)] = new Set(), this[_0x16fd16(0xf4)] = null, this['sshError'] = null, this[_0x16fd16(0x108)] = null, this[_0x16fd16(0x1e4)] = 0x0, this[_0x16fd16(0x11f)] = null, this['commands'] = this[_0x16fd16(0x20a)](); } ['logInfo'](_0x3dceb8) { const _0x2d6331 = _0x2b5f26; console[_0x2d6331(0xcc)](_0x2d6331(0x16c) + this['id']['substring'](0x0, 0x6) + _0x2d6331(0x160) + _0x3dceb8); } [_0x2b5f26(0x1d9)](_0x392871) { const _0x113d9b = _0x2b5f26; console[_0x113d9b(0xcc)](_0x113d9b(0xe1) + this['id'][_0x113d9b(0x1ce)](0x0, 0x6) + _0x113d9b(0x160) + _0x392871); } [_0x2b5f26(0x17d)](_0x3c1114) { const _0x306d60 = _0x2b5f26; if (!this[_0x306d60(0xd2)][_0x306d60(0xd6)](_0x3c1114)) { const _0x33f0d5 = wanakana[_0x306d60(0x17f)](_0x3c1114[_0x306d60(0x139)](/ /g, '_'))[_0x306d60(0x139)](/n'/g, 'n'); this[_0x306d60(0xd2)][_0x306d60(0xfa)](_0x3c1114, _0x33f0d5); } return this[_0x306d60(0xd2)][_0x306d60(0x179)](_0x3c1114); } ['handleDirectVcConnection'](_0x472efe) { const _0x21af39 = _0x2b5f26; this[_0x21af39(0x14b)]['add'](_0x472efe), this[_0x21af39(0x10c)] = !![], this['sendInitialPayload'](_0x472efe), _0x472efe['on'](_0x21af39(0x158), async _0x1be827 => { const _0x4fdb59 = _0x21af39; try { let _0x29b000; try { _0x29b000 = msgpack[_0x4fdb59(0x11b)](_0x1be827); } catch (_0x594691) { try { _0x29b000 = JSON[_0x4fdb59(0x151)](_0x1be827); } catch (_0x5de855) { } } if (_0x29b000) { if (_0x29b000[_0x4fdb59(0x188)] && _0x29b000[_0x4fdb59(0x199)]) this[_0x4fdb59(0x1fb)][_0x29b000[_0x4fdb59(0x188)]] = _0x29b000['position']; if (_0x29b000['action'] === _0x4fdb59(0x155) && typeof _0x29b000['value'] === _0x4fdb59(0x146)) { if (this[_0x4fdb59(0x17b)]) { const _0x49bfa5 = await this[_0x4fdb59(0x17b)][_0x4fdb59(0xf8)](_0x29b000[_0x4fdb59(0x1f8)]); _0x472efe[_0x4fdb59(0xfc)](JSON['stringify']({ 'type': _0x4fdb59(0x14d), 'payload': _0x49bfa5 })); } } } } catch (_0x1e6bb3) { } }), _0x472efe['on'](_0x21af39(0x107), () => { const _0x4ba715 = _0x21af39; this['directVcClients'][_0x4ba715(0x11e)](_0x472efe); }); } async[_0x2b5f26(0x168)]() { const _0x41c7fa = _0x2b5f26, { sub_domain: _0x5837d4, username: _0x203a03, ssh_password: _0x2c407c } = this['config']; if (_0x203a03 && _0x2c407c && _0x5837d4) this[_0x41c7fa(0xf4)] = await startTcpexposer(this, _0x5837d4, INITIAL_CONFIG[_0x41c7fa(0x1ed)]); else await this[_0x41c7fa(0xd9)]('mc'); } [_0x2b5f26(0x16a)](_0x225e85) { const _0x273011 = _0x2b5f26; this[_0x273011(0x11f)] && (clearTimeout(this['pendingTimeout']), this['pendingTimeout'] = null), this[_0x273011(0x17b)] = _0x225e85, this[_0x273011(0x115)] = _0x225e85[_0x273011(0x191)] || 'Unknown\x20World', this[_0x273011(0x196)](); } async[_0x2b5f26(0x196)]() { const _0x2d03fa = _0x2b5f26; if (!this[_0x2d03fa(0x17b)] && !this[_0x2d03fa(0x11f)]) return; if (!this[_0x2d03fa(0x1a5)] && !this[_0x2d03fa(0xf4)]) { const { sub_domain: _0x533130, username: _0x43a33b, ssh_password: _0x358483 } = this['config']; if (_0x43a33b && _0x358483 && _0x533130) { this['sshClient'] = await startTcpexposer(this, _0x533130, INITIAL_CONFIG[_0x2d03fa(0x1ed)]); if (!this['sshClient']) { if (!this[_0x2d03fa(0x1a5)]) await this[_0x2d03fa(0xd9)]('mc'); } } else { if (!_0x533130) await this[_0x2d03fa(0xd9)]('mc'); } } this[_0x2d03fa(0x1af)] = !![], this['stop_roop'] = ![], this['logInfo'](_0x2d03fa(0x12e)); if (this[_0x2d03fa(0x17b)]) { try { await this['cleanOldTags'](), this['world'][_0x2d03fa(0xf8)]('tag\x20@s\x20add\x20\x22pvc:roomId=' + this[_0x2d03fa(0x170)] + '\x22'), this[_0x2d03fa(0x1f5)](); } catch (_0x3f44de) { } this['loop'](); } } async[_0x2b5f26(0x1c7)]() { const _0x438ae7 = _0x2b5f26; if (!this[_0x438ae7(0x17b)]) return; try { const _0x3a1036 = await this[_0x438ae7(0x136)](); for (const _0x2ff3a4 of _0x3a1036) { await this[_0x438ae7(0x17b)]['runCommand'](_0x438ae7(0x181) + _0x2ff3a4 + _0x438ae7(0xdf) + _0x2ff3a4 + '\x22'); } const _0x1a19d7 = await this['world'][_0x438ae7(0xf8)]('testfor\x20@a'); this[_0x438ae7(0x11a)][_0x438ae7(0x1bd)](); if (_0x1a19d7[_0x438ae7(0x18d)]) _0x1a19d7[_0x438ae7(0x18d)][_0x438ae7(0x1f2)](_0x27a873 => this[_0x438ae7(0x11a)][_0x438ae7(0x18e)](_0x27a873)); } catch (_0x498ea2) { } } [_0x2b5f26(0x1f5)]() { const _0x47a1ad = _0x2b5f26; if (!this[_0x47a1ad(0x17b)]) return; const { proximity: _0x221bf5, distance: _0x58409a, lang: _0x5a3956 } = this[_0x47a1ad(0x150)]; if (_0x5a3956 == 'ja') { let _0x36f7b4 = _0x221bf5 ? '有効' : '無効'; this[_0x47a1ad(0x17b)]['sendMessage'](_0x47a1ad(0xce) + _0x36f7b4 + _0x47a1ad(0x175) + _0x58409a + _0x47a1ad(0x163))[_0x47a1ad(0x1d1)](_0x361198 => { }); } else { let _0x489c90 = _0x221bf5 ? _0x47a1ad(0x1a3) : _0x47a1ad(0x1ea); this[_0x47a1ad(0x17b)][_0x47a1ad(0x171)](_0x47a1ad(0x165) + _0x489c90 + '\x0aMax\x20distance:' + _0x58409a + _0x47a1ad(0x122))[_0x47a1ad(0x1d1)](_0x44c3af => { }); } } [_0x2b5f26(0x15d)]() { const _0x4f6b4c = _0x2b5f26; this['useResetTimer'] = !![], clearTimeout(this[_0x4f6b4c(0x108)]), this[_0x4f6b4c(0x108)] = setTimeout(() => { const _0x5bf95a = _0x4f6b4c; this[_0x5bf95a(0x143)](_0x5bf95a(0x1d5)); }, INACTIVITY_TIMEOUT); } [_0x2b5f26(0x206)]() { const _0x5c882b = _0x2b5f26; if (this[_0x5c882b(0xe3)]) return; this[_0x5c882b(0xe3)] = setTimeout(() => { const _0x944c1a = _0x5c882b; if (this['world']) this[_0x944c1a(0x17b)][_0x944c1a(0x171)](this[_0x944c1a(0x150)][_0x944c1a(0x152)] === 'ja' ? _0x944c1a(0x106) : _0x944c1a(0x1cd))[_0x944c1a(0x1d1)](() => { }); console[_0x944c1a(0xcc)](_0x944c1a(0x184)), console['log'](_0x944c1a(0x162) + this['worldName'] + ']\x20最大稼働時間に達しました。'), console[_0x944c1a(0xcc)](_0x944c1a(0x1bc)), setTimeout(() => this[_0x944c1a(0x143)](_0x944c1a(0x1d5)), 0x1388); }, MAX_RUNTIME), this[_0x5c882b(0x15d)](); } async['loop']() { const _0x409812 = _0x2b5f26; if (this['stop_roop'] || !this[_0x409812(0x17b)]) return; try { if (this[_0x409812(0x1b5)]) this[_0x409812(0x15d)](); let _0x42609b = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }, _0x28cbc9 = { 'statusCode': -0x1 }; if (this[_0x409812(0x150)][_0x409812(0x1eb)]) { const [_0x592497, _0x56b1d7, _0x293d9a, _0x657322, _0x14cf46] = await Promise[_0x409812(0x208)]([this[_0x409812(0x17b)]['runCommand'](_0x409812(0x1d3)), this[_0x409812(0x17b)][_0x409812(0xf8)]('testfor\x20@e[type=player]'), this[_0x409812(0x17b)][_0x409812(0xf8)](_0x409812(0x187)), this['world'][_0x409812(0xf8)](_0x409812(0x117)), this['world']['runCommand'](_0x409812(0x1c0))]); _0x28cbc9 = _0x14cf46; if (_0x592497[_0x409812(0x1e1)] <= -0x1) { this['consecutiveTimeouts']++; if (this[_0x409812(0x1e4)] >= TIMEOUT_THRESHOLD) { this[_0x409812(0x143)](_0x409812(0x19c)); return; } } else this['consecutiveTimeouts'] = 0x0; _0x592497[_0x409812(0x1e1)] === 0x0 && typeof _0x592497[_0x409812(0x121)] === 'string' && (_0x42609b[_0x409812(0x177)] = _0x592497[_0x409812(0x121)]['split'](',')['map'](_0x296a96 => _0x296a96[_0x409812(0xdb)]())['filter'](_0xcae013 => _0xcae013[_0x409812(0x13a)] > 0x0)); if (_0x56b1d7['victim']) _0x56b1d7['victim'][_0x409812(0x1f2)](_0x1b8813 => _0x42609b[_0x409812(0x214)][_0x409812(0x18e)](_0x1b8813)); if (_0x293d9a[_0x409812(0x18d)]) _0x293d9a[_0x409812(0x18d)][_0x409812(0x1f2)](_0x52bd1e => _0x42609b[_0x409812(0x194)][_0x409812(0x18e)](_0x52bd1e)); try { _0x42609b[_0x409812(0xe2)] = JSON[_0x409812(0x151)](_0x657322[_0x409812(0xe2)] || '[]'); } catch (_0x3d9584) { _0x42609b[_0x409812(0xe2)] = []; } } else { const [_0x2ed2b9, _0xc65161] = await Promise[_0x409812(0x208)]([this['world'][_0x409812(0xf8)](_0x409812(0x1d3)), this[_0x409812(0x17b)][_0x409812(0xf8)](_0x409812(0x1c0))]); _0x28cbc9 = _0xc65161; if (_0x2ed2b9[_0x409812(0x1e1)] <= -0x1) { this[_0x409812(0x1e4)]++; if (this[_0x409812(0x1e4)] >= TIMEOUT_THRESHOLD) { this[_0x409812(0x143)](_0x409812(0x19c)); return; } } else this[_0x409812(0x1e4)] = 0x0; } const _0xbcf887 = Array[_0x409812(0x110)](_0x42609b[_0x409812(0x214)]); _0x42609b['playersNames'][_0x409812(0x1f2)](_0x3716a9 => { const _0x117dea = _0x409812, _0x4c4330 = this['processName'](_0x3716a9), _0x35bb18 = _0x42609b[_0x117dea(0x194)][_0x117dea(0xd6)](_0x3716a9); this[_0x117dea(0x120)][_0x4c4330] = _0x35bb18; if (!this['config']['proximity']) this[_0x117dea(0x1fb)][_0x4c4330] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x42609b[_0x117dea(0x214)][_0x117dea(0xd6)](_0x3716a9)) this['positions'][_0x4c4330] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this['config'][_0x117dea(0x1b9)] && _0x35bb18) { if (this['config'][_0x117dea(0x16e)] === !![]) { const _0x57547c = _0xbcf887[_0x117dea(0x1c9)](_0x3716a9); if (_0x57547c !== -0x1 && _0x42609b[_0x117dea(0xe2)][_0x57547c]) { this[_0x117dea(0x1fb)][_0x4c4330] = _0x42609b[_0x117dea(0xe2)][_0x57547c][_0x117dea(0x199)]; if (this[_0x117dea(0x150)]['specDim'] === !![]) this[_0x117dea(0xee)][_0x4c4330] = _0x42609b[_0x117dea(0xe2)][_0x57547c]['dimension']; } else this[_0x117dea(0x1fb)][_0x4c4330] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this[_0x117dea(0x1fb)][_0x4c4330] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x778325 = _0xbcf887['indexOf'](_0x3716a9); if (_0x778325 !== -0x1 && _0x42609b[_0x117dea(0xe2)][_0x778325]) this[_0x117dea(0x1fb)][_0x4c4330] = _0x42609b[_0x117dea(0xe2)][_0x778325][_0x117dea(0x199)], this[_0x117dea(0xcb)][_0x4c4330] = _0x42609b[_0x117dea(0xe2)][_0x778325][_0x117dea(0x145)], this[_0x117dea(0xee)][_0x4c4330] = _0x42609b[_0x117dea(0xe2)][_0x778325][_0x117dea(0x197)]; else this[_0x117dea(0x1fb)][_0x4c4330] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this[_0x409812(0x156)] = !![], this[_0x409812(0x1e0)](); if (_0x28cbc9['statusCode'] === 0x0 && !this[_0x409812(0xcd)]) { this[_0x409812(0xcd)] = !![]; const _0x2674c0 = _0x28cbc9[_0x409812(0x18d)][0x0]; this['processTagCommands'](_0x2674c0)[_0x409812(0x1d1)](_0x75acf2 => { const _0x410ba7 = _0x409812; console['error'](_0x410ba7(0x17e), _0x75acf2); })[_0x409812(0x166)](() => { const _0x7f4abe = _0x409812; this[_0x7f4abe(0xcd)] = ![]; }); } } catch (_0x11a545) { console[_0x409812(0xd0)]('Error\x20handling\x20world\x20loop\x20[' + this[_0x409812(0x115)] + ']:', _0x11a545); } if (!this[_0x409812(0x1bb)]) setTimeout(() => this[_0x409812(0x1b2)](), 0x0); } async['processTagCommands'](_0x3c5b4d) { const _0x291e4a = _0x2b5f26, _0x3740bb = await this[_0x291e4a(0x17b)][_0x291e4a(0xf8)]('tag\x20@a[tag=pvc:req_cmd]\x20list'); if (_0x3740bb[_0x291e4a(0x1e1)] === 0x0 && _0x3740bb[_0x291e4a(0x20d)]) { let _0x2ba5f3 = []; const _0x1244a4 = new Player(this[_0x291e4a(0x17b)], _0x3c5b4d), _0x444529 = _0x3740bb[_0x291e4a(0x20d)][_0x291e4a(0x192)](/\r\n|\n|\r/); for (const _0x5cf00f of _0x444529) { if (!_0x5cf00f['trim']()) continue; const _0x423a75 = _0x5cf00f[_0x291e4a(0x139)](/§./g, ''), _0x4df873 = _0x423a75[_0x291e4a(0x1c9)](':'); _0x4df873 !== -0x1 && (_0x2ba5f3 = _0x2ba5f3[_0x291e4a(0x210)](_0x423a75['substring'](_0x4df873 + 0x1)[_0x291e4a(0x192)](',')['map'](_0x24bdb3 => _0x24bdb3[_0x291e4a(0xdb)]())[_0x291e4a(0x1b6)](_0x4a1015 => _0x4a1015[_0x291e4a(0x1bf)](_0x291e4a(0x12f))))); for (const _0x531e7a of _0x2ba5f3) { if (_0x531e7a === _0x291e4a(0x126) || _0x531e7a[_0x291e4a(0x1bf)](_0x291e4a(0x10a))) continue; const _0x259053 = _0x531e7a['startsWith'](_0x291e4a(0x12f)) ? _0x531e7a[_0x291e4a(0x1ce)](_0x291e4a(0x12f)[_0x291e4a(0x13a)]) : _0x531e7a; let [_0x31e208, ..._0xe230e5] = _0x259053['split'](':'); _0x31e208 = '!' + _0x31e208, this['commands'][_0x31e208] && (await this[_0x291e4a(0xf7)][_0x31e208](this[_0x291e4a(0x17b)], _0x1244a4, _0xe230e5), this[_0x291e4a(0x17b)][_0x291e4a(0xf8)]('tag\x20@a\x20remove\x20\x22' + _0x531e7a + '\x22')); } } await this[_0x291e4a(0x17b)][_0x291e4a(0xf8)](_0x291e4a(0x20f)); } } async[_0x2b5f26(0x136)]() { const _0x47d756 = _0x2b5f26; if (!this[_0x47d756(0x17b)]) return []; try { const _0x7de535 = await this[_0x47d756(0x17b)]['runCommand']('tag\x20@a\x20list'); if (_0x7de535[_0x47d756(0x1e1)] !== 0x0 || !_0x7de535[_0x47d756(0x20d)]) return []; let _0x4b4258 = []; const _0xd1eafc = _0x7de535[_0x47d756(0x20d)][_0x47d756(0x192)](/\r\n|\n|\r/); for (const _0x3e9e64 of _0xd1eafc) { if (!_0x3e9e64[_0x47d756(0xdb)]()) continue; const _0xeabea0 = _0x3e9e64['replace'](/§./g, ''), _0x3a4425 = _0xeabea0[_0x47d756(0x1c9)](':'); _0x3a4425 !== -0x1 && (_0x4b4258 = _0x4b4258[_0x47d756(0x210)](_0xeabea0[_0x47d756(0x1ce)](_0x3a4425 + 0x1)[_0x47d756(0x192)](',')[_0x47d756(0x10e)](_0x13491f => _0x13491f[_0x47d756(0xdb)]())[_0x47d756(0x1b6)](_0x51263e => _0x51263e[_0x47d756(0x1bf)]('pvc:')))); } return _0x4b4258; } catch (_0x3adea9) { return []; } } [_0x2b5f26(0x1e0)]() { const _0x5b84da = _0x2b5f26; if (!this[_0x5b84da(0x156)]) return; const _0x312df7 = {}; for (const [_0x40142a, _0x5390cf] of Object[_0x5b84da(0xe5)](this[_0x5b84da(0x1fb)])) { if (_0x5390cf) _0x312df7[_0x40142a] = [Math['round'](_0x5390cf['x'] * 0x64) / 0x64, Math[_0x5b84da(0xf9)](_0x5390cf['y'] * 0x64) / 0x64, Math['round'](_0x5390cf['z'] * 0x64) / 0x64]; } const _0xac8f16 = { 'spec': this[_0x5b84da(0x150)][_0x5b84da(0x1b9)], 'spLis': this['config'][_0x5b84da(0x16e)], 'spDim': this['config'][_0x5b84da(0x128)], 't': 'wu', 'pos': _0x312df7, 'dis': this[_0x5b84da(0x150)][_0x5b84da(0xda)], 'pssws': this[_0x5b84da(0x10f)], 'dim': this[_0x5b84da(0xee)], 'yr': this[_0x5b84da(0xcb)], 'spPos': this[_0x5b84da(0x120)], 'prox': this[_0x5b84da(0x150)][_0x5b84da(0x1eb)] ? 0x1 : 0x0 }, _0x55f7da = msgpack['encode'](_0xac8f16); if (this[_0x5b84da(0x1e6)] && this['relayWs'][_0x5b84da(0x12d)] === WebSocket[_0x5b84da(0x1b4)]) this[_0x5b84da(0x1e6)]['send'](_0x55f7da); this[_0x5b84da(0x14b)]['forEach'](_0x1bb84e => { const _0x4fa130 = _0x5b84da; if (_0x1bb84e[_0x4fa130(0x12d)] === WebSocket[_0x4fa130(0x1b4)]) _0x1bb84e[_0x4fa130(0xfc)](_0x55f7da); }); } async[_0x2b5f26(0xd9)](_0x212882) { const _0x929140 = _0x2b5f26, _0x2e7ab6 = _0x212882 === 'mc', _0x1854c5 = _0x2e7ab6 ? _0x929140(0x200) : _0x929140(0xe8); try { if (!this[_0x929140(0x170)]) { const _0x318486 = await fetch(_0x929140(0x1e8) + RELAY_SERVER_DOMAIN + _0x929140(0x1be) + this[_0x929140(0x150)]['sub_domain']), _0x406d21 = await _0x318486[_0x929140(0x1cb)](); this[_0x929140(0x170)] = _0x406d21[_0x929140(0x170)]; if (this[_0x929140(0x17b)]) { this[_0x929140(0x1c7)](), this[_0x929140(0x17b)][_0x929140(0xf8)](_0x929140(0xde) + this[_0x929140(0x170)] + '\x22')[_0x929140(0x1d1)](() => { }); if (this[_0x929140(0x150)][_0x929140(0x152)] === 'ja') await this[_0x929140(0x17b)][_0x929140(0x171)](_0x929140(0x1c1) + this[_0x929140(0x170)]); else await this[_0x929140(0x17b)][_0x929140(0x171)](_0x929140(0x100) + this[_0x929140(0x170)]); } } else { if (!this[_0x929140(0x1a5)]) { if (this[_0x929140(0x17b)]) { if (this[_0x929140(0x150)][_0x929140(0x152)] === 'ja') await this[_0x929140(0x17b)]['sendMessage'](_0x929140(0x1c1) + this[_0x929140(0x170)]); else await this[_0x929140(0x17b)][_0x929140(0x171)]('Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20' + this['roomId']); } } } this[_0x929140(0x1a5)] = !![]; if (_0x2e7ab6) { console[_0x929140(0xcc)](_0x929140(0x184)); if (this[_0x929140(0x150)][_0x929140(0x152)] === 'ja') this[_0x929140(0x1e7)](_0x929140(0x141)); else this['logInfo'](_0x929140(0xec)); this[_0x929140(0x1e7)](_0x929140(0x1ee) + RELAY_SERVER_DOMAIN + _0x929140(0x211) + this[_0x929140(0x170)]), this[_0x929140(0x189)] = _0x929140(0x1ee) + RELAY_SERVER_DOMAIN + '/room/' + this[_0x929140(0x170)]; } else { this[_0x929140(0x1e7)]('ROOM\x20ID:\x20' + this[_0x929140(0x170)]); if (this[_0x929140(0x150)][_0x929140(0x152)] === 'ja') this[_0x929140(0x1e7)](_0x929140(0x127)); else this[_0x929140(0x1e7)]('Participants\x20should\x20access\x20this\x20URL'); this['logInfo']('https://mcproxvc.ovh/connect/?roomid=' + this['roomId']), console[_0x929140(0xcc)]('=======================================================\x0a'); } this[_0x929140(0x206)](); let _0x51f24a; if (this['relayWs']) { _0x51f24a = this[_0x929140(0x1e6)]; if (_0x51f24a[_0x929140(0x12d)] !== WebSocket[_0x929140(0x1b4)]) { } } else _0x51f24a = new WebSocket(_0x929140(0x118) + RELAY_SERVER_DOMAIN + '/room/' + this['roomId'] + '?clientType=server_script'), this['relayWs'] = _0x51f24a, _0x51f24a['on'](_0x929140(0x131), () => this['logInfo'](_0x929140(0x109) + this[_0x929140(0x170)] + ')')), _0x51f24a['on'](_0x929140(0x107), () => { if (this['relayWs'] === _0x51f24a) this['relayWs'] = null; }), _0x51f24a['on']('error', _0x2b36f1 => console[_0x929140(0xd0)](_0x1854c5 + _0x929140(0x174), _0x2b36f1)); _0x2e7ab6 ? (this['mc_connected'] = !![], this[_0x929140(0x19b)](_0x51f24a), this['connectToRelayServer']('vc')) : (this[_0x929140(0x10c)] = !![], this[_0x929140(0x1da)](_0x51f24a)); } catch (_0x511366) { console['error'](_0x1854c5 + _0x929140(0x174), _0x511366); } } ['sendInitialPayload'](_0x47ec1d) { const _0x457fcb = _0x2b5f26, { app_id: _0x272e9b, secret_key: _0x4f530c, proximity: _0x32b431, distance: _0x4e583c, spectator: _0xf86edb, specListen: _0x1b4ca4, specDim: _0x6bc788, verify: _0x2806ce, password: _0x2393c8 } = this[_0x457fcb(0x150)]; _0x47ec1d[_0x457fcb(0xfc)](msgpack['encode']({ 'password': !!(_0x2806ce || _0x2393c8), 'passwords': this[_0x457fcb(0x10f)], 'app_id': _0x272e9b, 'secret_key': _0x4f530c, 'proximity': _0x32b431, 'distance': _0x4e583c, 'spectator': _0xf86edb, 'specListen': _0x1b4ca4, 'specDim': _0x6bc788 })); } [_0x2b5f26(0x1da)](_0x736366) { const _0x588ce0 = _0x2b5f26; _0x736366['on'](_0x588ce0(0x158), async _0x51a8a9 => { const _0x5b4c4f = _0x588ce0; try { const _0x5b7a1e = JSON[_0x5b4c4f(0x151)](_0x51a8a9[_0x5b4c4f(0x1d2)]()); if (_0x5b7a1e[_0x5b4c4f(0x1b3)] === _0x5b4c4f(0xdc)) { this[_0x5b4c4f(0xe7)](_0x736366); return; } if (_0x5b7a1e[_0x5b4c4f(0x182)] === _0x5b4c4f(0x155)) { if (this[_0x5b4c4f(0x17b)]) await this[_0x5b4c4f(0x17b)][_0x5b4c4f(0xf8)](_0x5b7a1e[_0x5b4c4f(0x1f8)]); } } catch (_0x3beb12) { } }); } ['setupMcRelayListeners'](_0x74ca38) { const _0x512f8a = _0x2b5f26; _0x74ca38['on'](_0x512f8a(0x158), async _0x9ba563 => { const _0x44e979 = _0x512f8a; let _0x30fad9 = _0x9ba563; try { Buffer['isBuffer'](_0x9ba563) && _0x9ba563[_0x44e979(0x13a)] > 0x2 && _0x9ba563[0x0] === 0x1f && _0x9ba563[0x1] === 0x8b && (_0x30fad9 = zlib[_0x44e979(0x17a)](_0x9ba563)); } catch (_0xb81a52) { } try { const _0x23d359 = JSON[_0x44e979(0x151)](_0x30fad9[_0x44e979(0x1d2)]()); if (_0x23d359['type'] === 'partner_connected') { const _0x39c684 = _0x23d359['clientType'] || _0x44e979(0x18a); _0x39c684 === _0x44e979(0x18a) ? (this['localClient'] = new WebSocket('ws://127.0.0.1:' + this[_0x44e979(0x150)][_0x44e979(0xfe)], { 'headers': { 'x-proxvc-session': this['id'] } }), this['localClientBuffer'] = [], this['localClient']['on']('open', () => { const _0xe9e125 = _0x44e979; while (this[_0xe9e125(0xcf)][_0xe9e125(0x13a)] > 0x0) { const _0x5ea5a4 = this['localClientBuffer']['shift'](); this['localClient'][_0xe9e125(0xfc)](_0x5ea5a4); } }), this[_0x44e979(0x119)]['on'](_0x44e979(0x158), _0x8daadd => _0x74ca38[_0x44e979(0x12d)] === WebSocket[_0x44e979(0x1b4)] && _0x74ca38[_0x44e979(0xfc)](_0x8daadd)), this[_0x44e979(0x119)]['on'](_0x44e979(0x107), (_0x185819, _0x2a5b27) => { const _0x55c498 = _0x44e979; if (_0x74ca38[_0x55c498(0x12d)] === WebSocket[_0x55c498(0x1b4)]) _0x74ca38[_0x55c498(0x107)](); }), this['localClient']['on']('error', _0x71f8d2 => console['error']('[Local\x20Client\x20Error]\x20' + _0x71f8d2[_0x44e979(0x158)]))) : this[_0x44e979(0xe7)](_0x74ca38); return; } else { if (_0x23d359[_0x44e979(0x1b3)] === _0x44e979(0x1ae)) { this[_0x44e979(0x119)] && (this[_0x44e979(0x119)][_0x44e979(0x107)](), this[_0x44e979(0x119)] = null); return; } else { if (_0x23d359[_0x44e979(0x1b3)] === _0x44e979(0x1cc)) { console[_0x44e979(0xcc)](_0x44e979(0x19d)); try { let _0x479803 = _0x23d359[_0x44e979(0x1dd)]; _0x479803 && _0x479803[_0x44e979(0x1b3)] === _0x44e979(0x1a1) && (_0x479803 = Buffer[_0x44e979(0x110)](_0x479803[_0x44e979(0x1dd)])); try { const _0x5e951e = msgpack[_0x44e979(0x11b)](_0x479803); if (_0x5e951e) { if (_0x5e951e['action'] === _0x44e979(0x155) && typeof _0x5e951e['value'] === _0x44e979(0x146)) { if (this[_0x44e979(0x17b)]) this[_0x44e979(0x17b)]['runCommand'](_0x5e951e[_0x44e979(0x1f8)])[_0x44e979(0x1d1)](() => { }); } else { if (_0x5e951e[_0x44e979(0x188)] && _0x5e951e[_0x44e979(0x199)]) this[_0x44e979(0x1fb)][_0x5e951e[_0x44e979(0x188)]] = _0x5e951e[_0x44e979(0x199)]; else _0x5e951e['type'] === _0x44e979(0xdc) && this['sendInitialPayload'](_0x74ca38); } } } catch (_0x449229) { const _0x547c56 = JSON[_0x44e979(0x151)](_0x479803[_0x44e979(0x1d2)]()); if (_0x547c56[_0x44e979(0x182)] === _0x44e979(0x155)) { if (this[_0x44e979(0x17b)]) this['world'][_0x44e979(0xf8)](_0x547c56[_0x44e979(0x1f8)])[_0x44e979(0x1d1)](() => { }); } } } catch (_0x3d2049) { } return; } } } if (_0x23d359[_0x44e979(0x1b3)] === _0x44e979(0xf2)) this['dataUpdate'](_0x23d359); } catch (_0xc03463) { } if (this['localClient']?.[_0x44e979(0x12d)] === WebSocket[_0x44e979(0x1b4)]) this[_0x44e979(0x119)][_0x44e979(0xfc)](_0x30fad9); else this[_0x44e979(0x119)]?.[_0x44e979(0x12d)] === WebSocket[_0x44e979(0x18f)] && this[_0x44e979(0xcf)][_0x44e979(0x101)](_0x30fad9); }), _0x74ca38['on'](_0x512f8a(0x107), () => this['localClient']?.[_0x512f8a(0x107)]()); } [_0x2b5f26(0x20a)]() { const _0x33f6d3 = _0x2b5f26, _0x2fa46a = (_0x21f1f9, _0x2070a1, _0x3def41) => async (_0x54fa29, _0x47a3aa, _0x3d4164) => { const _0x44ba69 = _0x12ad; if (_0x47a3aa[_0x44ba69(0x191)] !== _0x54fa29[_0x44ba69(0x16f)][_0x44ba69(0x191)]) return; if (_0x3d4164[0x0] !== _0x44ba69(0x14c) && _0x3d4164[0x0] !== _0x44ba69(0x1a9)) return; const _0x2627db = _0x3d4164[0x0] === _0x44ba69(0x14c); this['config'][_0x21f1f9] = _0x2627db; if (_0x21f1f9 === 'verify') this[_0x44ba69(0x150)][_0x44ba69(0x11c)] = _0x2627db; updateConfigFile(_0x21f1f9, _0x2627db); const _0x1f3624 = this[_0x44ba69(0x150)]['lang'] === 'ja' ? _0x2627db ? _0x2070a1[_0x44ba69(0x1a3)] : _0x2070a1['disabled'] : _0x2627db ? _0x3def41[_0x44ba69(0x1a3)] : _0x3def41[_0x44ba69(0x1ea)], _0xb8f960 = this[_0x44ba69(0x150)][_0x44ba69(0x152)] === 'ja' ? _0x44ba69(0x13b) : _0x44ba69(0x1c6); if (this[_0x44ba69(0x150)][_0x44ba69(0x14e)]) await _0x54fa29[_0x44ba69(0x171)](_0xb8f960 + _0x1f3624); }; return { '!dis': async (_0x589cc0, _0x283484, _0x831499) => { const _0x4b2250 = _0x12ad; if (_0x283484['name'] !== _0x589cc0[_0x4b2250(0x16f)][_0x4b2250(0x191)]) return; const _0x203160 = Number(_0x831499[0x0]); if (!isNaN(_0x203160)) { this[_0x4b2250(0x150)]['distance'] = _0x203160, updateConfigFile('distance', _0x203160); const _0x4bf300 = this[_0x4b2250(0x150)][_0x4b2250(0x152)] === 'ja' ? _0x4b2250(0x15e) + _0x203160 + _0x4b2250(0x205) : _0x4b2250(0x1f9) + _0x203160; if (this[_0x4b2250(0x150)][_0x4b2250(0x14e)]) await _0x589cc0[_0x4b2250(0x171)](_0x4bf300); } }, '!name': async (_0x41c4e9, _0x5a2a80) => { const _0x110359 = _0x12ad, _0x418f8b = this['processName'](_0x5a2a80[_0x110359(0x191)]), _0xc97756 = _0x110359(0x15b) + this[_0x110359(0x170)] + _0x110359(0xfb) + _0x418f8b + 'です', _0x5bd070 = 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20' + this[_0x110359(0x170)] + _0x110359(0x169) + _0x418f8b; await _0x5a2a80[_0x110359(0x171)](this[_0x110359(0x150)][_0x110359(0x152)] === 'ja' ? _0xc97756 : _0x5bd070); if (this[_0x110359(0x150)][_0x110359(0x11c)]) { !this[_0x110359(0x10f)][_0x418f8b] && (this[_0x110359(0x10f)][_0x418f8b] = Math[_0x110359(0xd1)](0x3e8 + Math[_0x110359(0x12c)]() * 0x2328)[_0x110359(0x1d2)]()); const _0xdb2b2a = this[_0x110359(0x150)][_0x110359(0x152)] === 'ja' ? _0x110359(0x1f1) + this[_0x110359(0x10f)][_0x418f8b] + 'です' : _0x110359(0x201) + this[_0x110359(0x10f)][_0x418f8b]; await _0x5a2a80[_0x110359(0x171)](_0xdb2b2a); } }, '!output': _0x2fa46a('output', { 'enabled': _0x33f6d3(0x1f7), 'disabled': _0x33f6d3(0x1a2) }, { 'enabled': _0x33f6d3(0x123), 'disabled': _0x33f6d3(0xd4) }), '!password': _0x2fa46a(_0x33f6d3(0x180), { 'enabled': _0x33f6d3(0x1db), 'disabled': '認証コードを無効にしました' }, { 'enabled': 'verify\x20code\x20enabled', 'disabled': _0x33f6d3(0x1f3) }), '!verify': _0x2fa46a(_0x33f6d3(0x180), { 'enabled': _0x33f6d3(0x1db), 'disabled': _0x33f6d3(0xf5) }, { 'enabled': _0x33f6d3(0xeb), 'disabled': _0x33f6d3(0x1f3) }), '!pvc': _0x2fa46a(_0x33f6d3(0x1eb), { 'enabled': '近接vcを有効にしました', 'disabled': _0x33f6d3(0x1f0) }, { 'enabled': _0x33f6d3(0x1e2), 'disabled': _0x33f6d3(0x1c8) }), '!spectator': _0x2fa46a(_0x33f6d3(0x1b9), { 'enabled': _0x33f6d3(0x1d7), 'disabled': _0x33f6d3(0x142) }, { 'enabled': _0x33f6d3(0x176), 'disabled': 'Spectator\x20set\x20to\x20common\x20VC' }), '!specListen': _0x2fa46a('specListen', { 'enabled': 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', 'disabled': _0x33f6d3(0x1b7) }, { 'enabled': _0x33f6d3(0x124), 'disabled': _0x33f6d3(0x1df) }), '!specDim': _0x2fa46a(_0x33f6d3(0x128), { 'enabled': _0x33f6d3(0x1ba), 'disabled': _0x33f6d3(0x14f) }, { 'enabled': 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', 'disabled': _0x33f6d3(0x1ad) }), '!lang': async (_0x14cfd2, _0x161e1d, _0x166676) => { const _0x34ac2c = _0x33f6d3; if (_0x161e1d[_0x34ac2c(0x191)] !== _0x14cfd2['localPlayer']['name']) return; const _0xa75b8a = _0x166676[0x0] === 'ja' ? 'ja' : 'en'; this[_0x34ac2c(0x150)][_0x34ac2c(0x152)] = _0xa75b8a, updateConfigFile(_0x34ac2c(0x152), _0xa75b8a), await _0x14cfd2[_0x34ac2c(0x171)](_0xa75b8a === 'ja' ? '<近接VC>言語を日本語に設定しました' : '<Proximity\x20VC>Language\x20set\x20to\x20English'); }, '!config': async (_0x5efeab, _0x3bf3e0) => { const _0x497615 = _0x33f6d3; if (_0x3bf3e0['name'] !== _0x5efeab[_0x497615(0x16f)][_0x497615(0x191)]) return; const { proximity: _0x1b9b65, distance: _0x4bf1fa, password: _0x5a4316, spectator: _0x1ff02a, specListen: _0x2ea8ea, specDim: _0x1e0f5e, lang: _0x27c9cf, output: _0x3abe17 } = this[_0x497615(0x150)], _0x1e864f = _0x27c9cf === 'ja' ? '§a有効§r' : _0x497615(0x125), _0x2d7f39 = _0x27c9cf === 'ja' ? _0x497615(0x13c) : _0x497615(0x1f4), _0x4581ba = _0x586751 => _0x586751 ? _0x1e864f : _0x2d7f39; let _0x321ad5 = _0x27c9cf === 'ja' ? _0x497615(0xe9) + _0x27c9cf + _0x497615(0x14a) + _0x4581ba(_0x1b9b65) + _0x497615(0x154) + _0x4bf1fa + _0x497615(0x116) + _0x4581ba(_0x5a4316) + _0x497615(0xed) + _0x4581ba(_0x3abe17) + _0x497615(0xf1) + _0x4581ba(_0x1ff02a) + _0x497615(0x1e3) + _0x4581ba(_0x2ea8ea) + '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20' + _0x4581ba(_0x1e0f5e) : '§l[Current\x20Settings]§r\x0aLanguage:\x20' + _0x27c9cf + _0x497615(0x1de) + _0x4581ba(_0x1b9b65) + '\x0aMax\x20Distance:\x20§e' + _0x4bf1fa + '§r\x0aVerify\x20Code:\x20' + _0x4581ba(_0x5a4316) + '\x0aOutput:\x20' + _0x4581ba(_0x3abe17) + '\x0aSpectator\x20Split:\x20' + _0x4581ba(_0x1ff02a) + _0x497615(0x1a0) + _0x4581ba(_0x2ea8ea) + _0x497615(0x1aa) + _0x4581ba(_0x1e0f5e); await _0x3bf3e0['sendMessage'](_0x321ad5); }, '!help': async (_0x2e720e, _0x4a1edf) => { const _0x34293a = _0x33f6d3, { lang: _0x4dd97e } = this[_0x34293a(0x150)]; await _0x4a1edf['sendMessage'](_0x34293a(0x1c5)), _0x4dd97e == 'ja' ? (await _0x4a1edf[_0x34293a(0x171)]('コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます'), _0x4a1edf['name'] == _0x2e720e[_0x34293a(0x16f)]['name'] && (await _0x4a1edf[_0x34293a(0x171)](_0x34293a(0x157)), await _0x4a1edf['sendMessage'](_0x34293a(0x1ef)), await _0x4a1edf[_0x34293a(0x171)](_0x34293a(0x149)))) : (await _0x4a1edf[_0x34293a(0x171)](_0x34293a(0x134)), _0x4a1edf[_0x34293a(0x191)] == _0x2e720e[_0x34293a(0x16f)]['name'] && (await _0x4a1edf[_0x34293a(0x171)](_0x34293a(0x1b8)), await _0x4a1edf[_0x34293a(0x171)](_0x34293a(0x185)), await _0x4a1edf[_0x34293a(0x171)]('Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension'))), await _0x4a1edf[_0x34293a(0x171)](_0x34293a(0x1c5)); } }; } [_0x2b5f26(0x1fa)](_0x4ea96a) { const _0x4862fa = _0x2b5f26; if (this[_0x4862fa(0x10c)]) this[_0x4862fa(0x1e0)](); if (this['useResetTimer']) this[_0x4862fa(0x15d)](); for (const [_0x284587, _0x1a2d08] of Object[_0x4862fa(0xe5)](_0x4ea96a)) { if (_0x284587 === _0x4862fa(0x1b3)) continue; if ([_0x4862fa(0x1fb), _0x4862fa(0x1eb), 'distance', 'spectator', _0x4862fa(0x120), _0x4862fa(0x16e), 'specDim', 'dimensions', 'yRots', 'password', 'lang'][_0x4862fa(0x213)](_0x284587)) { if ([_0x4862fa(0x1fb), _0x4862fa(0x120), 'dimensions', 'yRots'][_0x4862fa(0x213)](_0x284587)) this[_0x284587] = _0x1a2d08; else this[_0x4862fa(0x150)][_0x284587] = _0x1a2d08; } } } [_0x2b5f26(0x16a)](_0x27f783) { const _0xa39263 = _0x2b5f26; this[_0xa39263(0x17b)] = _0x27f783, this[_0xa39263(0x196)](), this['pendingTimeout'] && (clearTimeout(this[_0xa39263(0x11f)]), this['pendingTimeout'] = null), this[_0xa39263(0x1a5)] && this[_0xa39263(0x170)] && this[_0xa39263(0x17b)]['runCommand'](_0xa39263(0xde) + this['roomId'] + '\x22')['catch'](() => { }); } [_0x2b5f26(0x143)](_0x16bc2d = _0x2b5f26(0x19c)) { const _0x42781d = _0x2b5f26, _0x38a4e4 = this['worldName']; this[_0x42781d(0x1e7)](_0x42781d(0x1c3) + _0x16bc2d), this[_0x42781d(0x1bb)] = !![]; this['pendingTimeout'] && (clearTimeout(this['pendingTimeout']), this[_0x42781d(0x11f)] = null); this[_0x42781d(0xe3)] && (clearTimeout(this[_0x42781d(0xe3)]), this[_0x42781d(0xe3)] = null); const _0x14a438 = msgpack[_0x42781d(0x1e9)]({ 't': _0x42781d(0xd5), 'type': _0x42781d(0xd8) }); this[_0x42781d(0x1e6)] && (this[_0x42781d(0x1e6)]['send'](_0x14a438), this[_0x42781d(0x1e6)]['close'](), this[_0x42781d(0x1e6)] = null); this[_0x42781d(0x119)] && (this[_0x42781d(0x119)][_0x42781d(0x107)](), this['localClient'] = null); this[_0x42781d(0xf4)] && (this['sshClient']['end'](), this[_0x42781d(0xf4)] = null); this[_0x42781d(0x212)] = null, this[_0x42781d(0x1d8)] = null, this[_0x42781d(0x14b)][_0x42781d(0x1f2)](_0x1fbc80 => _0x1fbc80[_0x42781d(0x107)]()), this[_0x42781d(0x14b)][_0x42781d(0x1bd)](); if (typeof this[_0x42781d(0x1c7)] === _0x42781d(0x1fc)) this[_0x42781d(0x1c7)]()[_0x42781d(0x20b)](() => { const _0x57d700 = _0x42781d; sessionHistory[_0x57d700(0xfa)](this['id'], { 'reason': _0x16bc2d, 'timestamp': Date[_0x57d700(0x15f)]() }), sessions['delete'](this[_0x57d700(0x17b)]), pendingSessions[_0x57d700(0x11e)](this['id']); }); else { sessionHistory[_0x42781d(0xfa)](this['id'], { 'reason': _0x16bc2d, 'timestamp': Date[_0x42781d(0x15f)]() }); if (sessionHistory[_0x42781d(0x19f)] > 0x64) { const _0x4c0bf1 = sessionHistory[_0x42781d(0x173)]()['next']()[_0x42781d(0x1f8)]; sessionHistory[_0x42781d(0x11e)](_0x4c0bf1); } sessions['delete'](this[_0x42781d(0x17b)]), pendingSessions['delete'](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x4f183b = _0x2b5f26; let _0x59a431 = INITIAL_CONFIG['port'], _0x45c9ae = INITIAL_CONFIG[_0x4f183b(0x1ed)]; _0x59a431 = await getPort({ 'port': [_0x59a431, ...makeRange(0x4abd, 0x4b20)] }), _0x45c9ae = await getPort({ 'port': [_0x45c9ae, ...makeRange(0x1f41, 0x1fa4)] }), console[_0x4f183b(0xcc)](_0x4f183b(0xe6) + _0x59a431), console[_0x4f183b(0xcc)](_0x4f183b(0x130) + _0x45c9ae), INITIAL_CONFIG[_0x4f183b(0xfe)] = _0x59a431, INITIAL_CONFIG[_0x4f183b(0x1ed)] = _0x45c9ae, globalConfig['port'] = _0x59a431, globalConfig[_0x4f183b(0x1ed)] = _0x45c9ae, setupGlobalVcWebSocket(_0x45c9ae); const _0x231f15 = express(), _0x478a78 = http['createServer'](_0x231f15); _0x478a78[_0x4f183b(0x186)](_0x59a431); const _0x5f4aa4 = new Server({ 'webSocketOptions': { 'server': _0x478a78 } }); _0x231f15[_0x4f183b(0xf0)](express['json']()), _0x231f15['post'](_0x4f183b(0x147), async (_0x5e8875, _0x20bb08) => { const _0x438a65 = _0x4f183b; try { const _0x30a620 = _0x5e8875['body'][_0x438a65(0x150)] || {}, _0x813a0c = new Session(null, _0x30a620); await _0x813a0c[_0x438a65(0x168)](), pendingSessions['set'](_0x813a0c['id'], _0x813a0c), _0x20bb08['json']({ 'sessionId': _0x813a0c['id'], 'roomId': _0x813a0c[_0x438a65(0x170)], 'connectCommand': _0x813a0c['connectCommand'] }), _0x813a0c['startTimer'](); } catch (_0x1fa7e0) { console[_0x438a65(0xd0)](_0x1fa7e0), _0x20bb08[_0x438a65(0xe4)](0x1f4)['json']({ 'error': _0x1fa7e0[_0x438a65(0x158)] }); } }), _0x231f15['post'](_0x4f183b(0xd7), (_0x4b6abe, _0x18c7d6) => { const _0x3478d0 = _0x4f183b, { sessionId: _0x1aa86a } = _0x4b6abe['body'], _0x19b71a = pendingSessions[_0x3478d0(0x179)](_0x1aa86a) || Array[_0x3478d0(0x110)](sessions[_0x3478d0(0x190)]())['find'](_0x4a642a => _0x4a642a['id'] === _0x1aa86a); _0x19b71a ? (_0x19b71a[_0x3478d0(0x143)](_0x3478d0(0x19c)), _0x18c7d6[_0x3478d0(0x1cb)]({ 'success': !![] })) : _0x18c7d6[_0x3478d0(0xe4)](0x194)[_0x3478d0(0x1cb)]({ 'error': _0x3478d0(0x144) }); }), _0x231f15[_0x4f183b(0x179)](_0x4f183b(0x153), (_0x4ffa83, _0x2fa9a2) => { const _0x194368 = _0x4f183b, _0x3eba00 = _0x4ffa83[_0x194368(0x18b)]['id'], _0x357362 = pendingSessions['get'](_0x3eba00) || Array[_0x194368(0x110)](sessions[_0x194368(0x190)]())['find'](_0x56372c => _0x56372c['id'] === _0x3eba00); if (_0x357362) _0x2fa9a2[_0x194368(0x1cb)]({ 'status': _0x194368(0xdd), 'sshError': _0x357362[_0x194368(0x20e)] }); else { if (sessionHistory['has'](_0x3eba00)) { const _0x3efb50 = sessionHistory['get'](_0x3eba00); _0x2fa9a2[_0x194368(0x1cb)]({ 'status': 'ended', 'reason': _0x3efb50[_0x194368(0x1d6)], 'timestamp': _0x3efb50[_0x194368(0x1a8)] }); } else _0x2fa9a2[_0x194368(0x1cb)]({ 'status': _0x194368(0x133) }); } }); const _0x592300 = (_0xcde3a6, _0xf21ea7) => { const _0x167fd2 = _0x4f183b, { type: _0x120cb3 } = _0xcde3a6[_0x167fd2(0x16d)], _0x2d8b30 = _0xcde3a6[_0x167fd2(0x137)][_0x167fd2(0x12a)]; let _0x599a0e = null; if (_0x2d8b30) { for (const _0x31a43d of sessions[_0x167fd2(0x190)]()) { const _0x248333 = _0x31a43d[_0x167fd2(0x150)][_0x167fd2(0x18c)]; if (_0x248333 && _0x2d8b30[_0x167fd2(0x1bf)](_0x248333)) { _0x599a0e = _0x31a43d; break; } } if (!_0x599a0e) for (const _0x5eba86 of pendingSessions[_0x167fd2(0x190)]()) { const _0x453c55 = _0x5eba86[_0x167fd2(0x150)][_0x167fd2(0x18c)]; if (_0x453c55 && _0x2d8b30[_0x167fd2(0x1bf)](_0x453c55)) { _0x599a0e = _0x5eba86; break; } } } if (_0x599a0e) { if (_0x120cb3 === 'data_update') _0x599a0e[_0x167fd2(0x1fa)](_0xcde3a6['body']); else { if (_0x120cb3 === _0x167fd2(0x15a)) _0x599a0e[_0x167fd2(0x143)](_0x167fd2(0x19c)); } _0x120cb3 === _0x167fd2(0xd3) ? (_0x599a0e['vc_connected'] = !![], _0x599a0e[_0x167fd2(0x1e7)](_0x167fd2(0x12e)), _0xf21ea7['status'](0xc8)[_0x167fd2(0x1cb)]({ 'type': _0x167fd2(0xd3), 'roomId': _0x599a0e[_0x167fd2(0x170)], 'ws_connected': _0x599a0e[_0x167fd2(0x1af)], ..._0x599a0e['config'] })) : _0xf21ea7[_0x167fd2(0xe4)](0xc8)['json']({ 'success': !![] }); } else { sessions['forEach'](_0x237553 => { const _0x147be9 = _0x167fd2; if (_0x120cb3 === _0x147be9(0xf2)) _0x237553['dataUpdate'](_0xcde3a6[_0x147be9(0x16d)]); else { if (_0x120cb3 === _0x147be9(0x15a)) _0x237553['destroy'](_0x147be9(0x19c)); } }); const _0x34feba = sessions[_0x167fd2(0x190)]()[_0x167fd2(0x10d)]()[_0x167fd2(0x1f8)] || pendingSessions['values']()[_0x167fd2(0x10d)]()[_0x167fd2(0x1f8)]; _0x34feba ? _0x120cb3 === _0x167fd2(0xd3) ? (_0x34feba[_0x167fd2(0x10c)] = !![], _0x34feba[_0x167fd2(0x1e7)](_0x167fd2(0x12e)), _0xf21ea7[_0x167fd2(0xe4)](0xc8)['json']({ 'type': 'initialization', 'roomId': _0x34feba['roomId'], 'ws_connected': _0x34feba[_0x167fd2(0x1af)], ..._0x34feba[_0x167fd2(0x150)] })) : _0xf21ea7[_0x167fd2(0xe4)](0xc8)[_0x167fd2(0x1cb)]({ 'success': !![] }) : _0xf21ea7['status'](0xc8)[_0x167fd2(0x1cb)]({ 'error': _0x167fd2(0x204) }); } }; _0x231f15['post']('/', _0x592300), _0x5f4aa4['on'](ServerEvent[_0x4f183b(0x209)], ({ world: _0x3b00d0 }) => { const _0xc9b94d = _0x4f183b, _0x3d6329 = _0x3b00d0[_0xc9b94d(0x1ca)], _0x21d678 = _0x3b00d0[_0xc9b94d(0x203)]; let _0x2ee147 = Array[_0xc9b94d(0x110)](sessions[_0xc9b94d(0x190)]())['find'](_0x59333f => _0x59333f['id'] === _0x3d6329); !_0x2ee147 && _0x3d6329 && (_0x2ee147 = pendingSessions[_0xc9b94d(0x179)](_0x3d6329)); if (!_0x2ee147 && _0x21d678) { _0x2ee147 = Array[_0xc9b94d(0x110)](pendingSessions[_0xc9b94d(0x190)]())[_0xc9b94d(0x19a)](_0x1d4d30 => { const _0x4bf1d3 = _0xc9b94d, _0x5905de = _0x1d4d30[_0x4bf1d3(0x150)][_0x4bf1d3(0x18c)]; if (_0x5905de && _0x21d678[_0x4bf1d3(0x1bf)](_0x5905de)) return !![]; return ![]; }); if (_0x2ee147) { } } if (_0x2ee147) pendingSessions[_0xc9b94d(0xd6)](_0x2ee147['id']) && pendingSessions[_0xc9b94d(0x11e)](_0x2ee147['id']), sessions[_0xc9b94d(0xfa)](_0x3b00d0, _0x2ee147), _0x2ee147['bindWorld'](_0x3b00d0); else { if (_0x21d678 && INITIAL_CONFIG[_0xc9b94d(0x18c)] && !_0x21d678[_0xc9b94d(0x1bf)](INITIAL_CONFIG[_0xc9b94d(0x18c)])) { console[_0xc9b94d(0x13e)](_0xc9b94d(0x1fd) + _0x21d678 + '\x27'); return; } _0x2ee147 = new Session(_0x3b00d0), sessions['set'](_0x3b00d0, _0x2ee147), _0x2ee147[_0xc9b94d(0x196)](); } }), _0x5f4aa4['on'](ServerEvent['WorldRemove'], ({ world: _0x14528a }) => { const _0x42afad = _0x4f183b, _0x3b94de = sessions[_0x42afad(0x179)](_0x14528a); if (_0x3b94de) { sessions['delete'](_0x14528a); !pendingSessions[_0x42afad(0xd6)](_0x3b94de['id']) && pendingSessions[_0x42afad(0xfa)](_0x3b94de['id'], _0x3b94de); if (_0x3b94de[_0x42afad(0x11f)]) clearTimeout(_0x3b94de[_0x42afad(0x11f)]); _0x3b94de[_0x42afad(0x11f)] = setTimeout(() => { const _0x3d54d8 = _0x42afad; pendingSessions['has'](_0x3b94de['id']) && _0x3b94de[_0x3d54d8(0x143)](_0x3d54d8(0x19c)); }, 0x7530); } }), _0x5f4aa4['on'](ServerEvent[_0x4f183b(0x105)], async ({ sender: _0xf5083f, message: _0x539a19, world: _0x352320 }) => { const _0xf19268 = _0x4f183b, _0x1088ba = sessions[_0xf19268(0x179)](_0x352320); if (_0x1088ba) { const [_0x263a41, ..._0x3a21f1] = _0x539a19[_0xf19268(0x192)]('\x20'); if (_0x1088ba[_0xf19268(0xf7)][_0x263a41]) await _0x1088ba[_0xf19268(0xf7)][_0x263a41](_0x352320, _0xf5083f, _0x3a21f1); } }), _0x5f4aa4['on'](ServerEvent[_0x4f183b(0xfd)], async ({ player: _0xfe5304, world: _0x42c4fe }) => { const _0x576242 = _0x4f183b, _0x553fbf = sessions[_0x576242(0x179)](_0x42c4fe); _0x553fbf && (_0x553fbf[_0x576242(0x1e7)](_0x576242(0x13f) + _0xfe5304[_0x576242(0x191)]), _0x553fbf[_0x576242(0x11a)][_0x576242(0x18e)](_0xfe5304[_0x576242(0x191)]), setTimeout(async () => { const _0x434ead = _0x576242; try { const _0x191bf0 = _0x553fbf[_0x434ead(0x17d)](_0xfe5304[_0x434ead(0x191)]), { roomId: _0x39d51d, passwords: _0x2d569b, config: _0x128f54 } = _0x553fbf, _0x29188e = _0x434ead(0x198) + _0x39d51d + _0x434ead(0xfb) + _0x191bf0 + 'です', _0x6a8ee5 = _0x434ead(0x16b) + _0x39d51d + _0x434ead(0x169) + _0x191bf0; await _0xfe5304['sendMessage'](_0x128f54['lang'] === 'ja' ? _0x29188e : _0x6a8ee5); if (_0x128f54[_0x434ead(0x11c)]) { if (!_0x2d569b[_0x191bf0]) _0x2d569b[_0x191bf0] = Math[_0x434ead(0xd1)](0x3e8 + Math['random']() * 0x2328)[_0x434ead(0x1d2)](); const _0x19f499 = _0x128f54[_0x434ead(0x152)] === 'ja' ? _0x434ead(0x193) + _0x2d569b[_0x191bf0] + 'です' : _0x434ead(0x103) + _0x2d569b[_0x191bf0]; await _0xfe5304[_0x434ead(0x171)](_0x19f499); } } catch (_0x1f335a) { } }, 0x1f4)); }), _0x5f4aa4['on'](ServerEvent[_0x4f183b(0x183)], ({ player: _0x5f5232, world: _0x5ab0c6 }) => { const _0x1c0992 = _0x4f183b, _0x1b8cac = sessions['get'](_0x5ab0c6); if (_0x1b8cac) { _0x1b8cac[_0x1c0992(0x1e7)](_0x1c0992(0x1b1) + _0x5f5232[_0x1c0992(0x191)]); _0x5f5232[_0x1c0992(0x191)] === _0x5ab0c6['localPlayer'][_0x1c0992(0x191)] && (_0x1b8cac[_0x1c0992(0x1e7)](_0x1c0992(0x1a4)), _0x1b8cac[_0x1c0992(0x143)]('success')); _0x1b8cac[_0x1c0992(0x11a)]['delete'](_0x5f5232['name']); const _0x434c87 = _0x1b8cac[_0x1c0992(0x17d)](_0x5f5232[_0x1c0992(0x191)]); delete _0x1b8cac[_0x1c0992(0x1fb)][_0x434c87], delete _0x1b8cac[_0x1c0992(0xee)][_0x434c87], delete _0x1b8cac[_0x1c0992(0xcb)][_0x434c87], delete _0x1b8cac[_0x1c0992(0x120)][_0x434c87]; } }), _0x5f4aa4['on'](ServerEvent[_0x4f183b(0x1a7)], ({ player: _0x2e1bfa, world: _0x153edb }) => { const _0x4ab6ea = _0x4f183b, _0x509702 = sessions[_0x4ab6ea(0x179)](_0x153edb); if (!_0x509702 || !_0x2e1bfa || !_0x2e1bfa[_0x4ab6ea(0x199)]) return; const _0x586c8e = _0x509702[_0x4ab6ea(0x17d)](_0x2e1bfa['name']); _0x509702['positions'][_0x586c8e] = { 'x': _0x2e1bfa['position']['x'], 'y': _0x2e1bfa[_0x4ab6ea(0x199)]['y'], 'z': _0x2e1bfa[_0x4ab6ea(0x199)]['z'] }; if (_0x2e1bfa[_0x4ab6ea(0x145)] !== undefined) _0x509702[_0x4ab6ea(0xcb)][_0x586c8e] = _0x2e1bfa[_0x4ab6ea(0x145)]; if (_0x2e1bfa[_0x4ab6ea(0x197)] !== undefined) _0x509702[_0x4ab6ea(0xee)][_0x586c8e] = _0x2e1bfa['dimension']; }); if (!process['argv'][_0x4f183b(0x213)](_0x4f183b(0x12b))) try { const _0x43fa1b = new Session(null, globalConfig); await _0x43fa1b['startWebSession'](), pendingSessions[_0x4f183b(0xfa)](_0x43fa1b['id'], _0x43fa1b); } catch (_0x2e47b4) { console[_0x4f183b(0xd0)]('[Standalone]\x20Failed\x20to\x20start\x20session:', _0x2e47b4); } else try { fs[_0x4f183b(0x172)](_0x4f183b(0x1fe), JSON[_0x4f183b(0x19e)]({ 'port': _0x59a431, 'web_port': _0x45c9ae }, null, 0x2)); } catch (_0x1363b1) { console[_0x4f183b(0xd0)](_0x4f183b(0x1ac), _0x1363b1); } } process['on'](_0x2b5f26(0x1cf), () => { const _0x5881a9 = _0x2b5f26; sessions[_0x5881a9(0x1f2)](_0x5b6059 => _0x5b6059[_0x5881a9(0x143)]()), process[_0x5881a9(0xe0)](); }), main();