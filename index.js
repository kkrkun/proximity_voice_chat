const _0x3b4aba = _0xa5c8; (function (_0x33dfd7, _0x347424) { const _0x1497f5 = _0xa5c8, _0x2c7c25 = _0x33dfd7(); while (!![]) { try { const _0x22b8e7 = parseInt(_0x1497f5(0x20c)) / 0x1 * (parseInt(_0x1497f5(0x1e4)) / 0x2) + parseInt(_0x1497f5(0x230)) / 0x3 + -parseInt(_0x1497f5(0x1ac)) / 0x4 * (-parseInt(_0x1497f5(0x19c)) / 0x5) + -parseInt(_0x1497f5(0x219)) / 0x6 + -parseInt(_0x1497f5(0x251)) / 0x7 + -parseInt(_0x1497f5(0x1ad)) / 0x8 + parseInt(_0x1497f5(0x1e1)) / 0x9 * (parseInt(_0x1497f5(0x150)) / 0xa); if (_0x22b8e7 === _0x347424) break; else _0x2c7c25['push'](_0x2c7c25['shift']()); } catch (_0x1091c5) { _0x2c7c25['push'](_0x2c7c25['shift']()); } } }(_0x298e, 0x62031)); const { Server, ServerEvent } = require(_0x3b4aba(0x192)), WebSocket = require('ws'), fetch = require(_0x3b4aba(0x166)), wanakana = require('wanakana'), fs = require('fs'), fsPromises = require('fs')[_0x3b4aba(0x275)], JSON5 = require(_0x3b4aba(0x165)), getPort = require('get-port'), { Client } = require(_0x3b4aba(0x280)), net = require(_0x3b4aba(0x19f)), express = require(_0x3b4aba(0x185)), http = require('http'), path = require('path'), { performance } = require(_0x3b4aba(0x1a3)), zlib = require('zlib'), msgpack = require(_0x3b4aba(0x17f)), { randomUUID } = require('crypto'), RELAY_SERVER_DOMAIN = _0x3b4aba(0x1f2), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = ['./config.jsonc', _0x3b4aba(0x1e8), _0x3b4aba(0x1e0)]; function _0x298e() { const _0x3f4e60 = ['https://', 'sub_domain', 'forEach', 'url', 'exit', '§l[Current\x20Settings]§r\x0aLanguage:\x20', '.tcpexposer.com\x22', 'http://', 'server_info.json', '§c無効§r', 'shouldBroadcast', 'json5', 'node-fetch', 'bindWorld', 'init', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', 'readFile', 'filter', 'Spectator\x20set\x20to\x20common\x20VC', '§cDisabled§r', 'dimension', 'function', 'vcSshClient', 'true', 'sendMessage', 'localClientBuffer', '[Standalone]\x20Failed\x20to\x20start\x20session:', 'testfor\x20@a', 'Unknown\x20World', 'getAllTags', 'end', 'from', 'Verify\x20code\x20is\x20', 'reason', 'verify', '\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20で認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20でスペクテイターとVCを分けます', 'querytarget\x20@e[type=player]', 'msgpack-lite', 'round', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'testfor\x20@e[type=player]', 'localClient', 'enabled', 'express', 'values', '/connect\x20', 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', 'delete', '常時接続する場合は以下のコマンドを実行してください:', 'partner_connected', 'startTimer', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', 'コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'concat', 'command_result', './lib/server', '<近接VC>言語を日本語に設定しました', 'name', '\x0a=======================================================', 'substring', 'split', 'passwords', 'Buffer', 'statusCode', '[Config]\x20Error\x20parsing\x20', '5545Fqhmrd', '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20', 'push', 'net', 'active', 'pendingTimeout', 'testfor\x20@a[m=spectator]', 'perf_hooks', 'toString', 'WorldRemove', 'mc_connected', '\x0aMax\x20distance:', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20change\x20language\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', 'userName', 'decode', 'status', '1900YsWhwa', '5188848rwXfsN', 'readyState', '\x0a\x20-\x20Spectator\x20Dimension:\x20', 'type', 'stop_roop', '\x0a最大距離\x20(Distance):\x20§e', ']\x1b[0m\x20', 'worldName', '§aEnabled§r', '/create-room', 'positions', 'pvcSessionId', 'aliveSet', 'OPEN', 'useResetTimer', 'close', 'ended', 'ROOM\x20ID:\x20', 'list', 'loop', 'createServer', 'set', 'writeFile', 'statusMessage', 'playersNames', 'stringify', 'vc_connected', 'disconnect_command', 'Password\x20is\x20', 'connectToRelayServer', 'config', 'replace', 'timestamp', '参加者はこのURLにアクセスしてください:', 'disabled', 'useRelay', 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', 'message', 'proximity', 'existsSync', 'resetTimer', 'string', 'Room\x20ID:\x20', 'floor', '--------------------', 'includes', 'startWebSession', 'spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20でスペクテイター同士の会話をディメンションごとに分けます', 'relayed_vc_data', 'connectCommand', 'keys', './config.json', '9UFyxQn', 'verify\x20code\x20disabled', 'false', '546TbJkjo', '[MC\x20Relay]', 'Proximity\x20VC\x20disabled', 'port', './config.json5', 'ready', 'catch', 'Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag', '接続を開始しました\x0a近接vc：', 'yRot', 'timeout', 'PlayerLoad', 'tag\x20@s\x20add\x20\x22pvc:roomId=', 'position', 'mcproxvc.fly.dev', '[Auto-Stop][', 'specListen', 'に変更しました', 'now', 'body', 'onlinePlayers', '\x0aYour\x20VCname\x20is\x20', 'sendInitMessage', 'spectatorSet', 'x-proxvc-domain:\x20', 'entries', '\x0a\x20-\x20Spectator\x20Listen:\x20', '<Proximity\x20VC>Language\x20set\x20to\x20English', '\x0aMax\x20Distance:\x20§e', '§r\x0a認証コード\x20(Verify):\x20', 'wss://', 'stop', 'pipe', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', '\x0a近接VC\x20(Proximity):\x20', 'indexOf', 'success', 'Connection\x20started\x0aProximity\x20voice\x20chat:', 'sshError', '68xNZgzj', 'headers', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', '\x0aSpectator\x20Split:\x20', 'Host\x20left.\x20Handing\x20stop\x20signal...', 'password', 'Server', 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', '退出:\x20', 'For\x20a\x20persistent\x20connection,\x20run\x20the\x20following\x20command:', '\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC', 'error', 'localPlayer', '1142250RkSqZV', 'sshClient', 'です\x0aあなたのVCnameは', 'dimensions', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'next', 'upgrade', '❌\x20SSH\x20Error\x20(', 'createCommands', 'SIGINT', 'httpVersion', '§r\x0aVerify\x20Code:\x20', 'dataUpdate', 'has', '\x0aスペクテイター分離\x20(Spectator):\x20', 'players', '認証コードを無効にしました', 'maxRuntimeTimeout', 'warn', 'details', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', 'Spectator\x20and\x20VC\x20separated', 'localhost', '1475559WQZmpD', '[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27', 'isBuffer', 'startsWith', 'partner_disconnected', 'Changed\x20max\x20distance\x20to\x20', 'spectators', 'logInfo', 'victim', 'パスワードは', 'find', 'consecutiveTimeouts', 'add', 'encode', 'handleDirectVcConnection', 'Session\x20not\x20found', 'length', 'all', 'spectator', 'roomId', 'map', '\x20HTTP/', 'write', 'connect', '/api/stop_session', 'get', 'trim', 'broadcastPositions', 'data_update', 'lang', 'CONNECTING', 'web_port', 'writeFileSync', '2893961bocZQH', 'host', 'send', '近接vcを有効にしました', '\x0a声の届く距離：', 'run_command', 'specDim', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'commands', 'スペクテイターとVCを分けました', 'No\x20active\x20sessions', 'searchParams', '[SSH]中継サーバーを使用します', '認証コードを有効にしました', 'logLog', '=======================================================\x0a', 'Participants\x20should\x20access\x20this\x20URL', 'parse', 'not_found', '認証コードは', 'sendInitialPayload', '.tcpexposer.com', 'PlayerChat', 'スペクテイター同士の会話をディメンションごとに分けました', 'world', '\x0a!help\x20for\x20command\x20list', 'runCommand', 'Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension', '/api/start_session', ']\x20最大稼働時間に達しました。', 'utf8', 'directVcClients', 'post', 'yRots', 'log', 'destroy', 'promises', 'size', '接続開始', 'listen', '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.', 'action', 'remotePort', 'toRomaji', 'setupMcRelayListeners', 'relayWs', '[SSH]❌\x20ポートフォワーディング失敗\x20(', 'ssh2', 'data', 'json', 'inactivityTimer', 'clear', 'Session\x20not\x20found\x20for\x20this\x20domain', 'cleanOldTags', 'clientType', 'open', 'Proximity\x20VC\x20enabled', 'value', 'random', 'distance', 'test', '/room/', 'Pending\x20Session', '--streamlit', 'verify\x20code\x20enabled', 'remoteAddr', 'setupVcRelayListeners', 'readFileSync', '6166690FCwFRp', 'tag\x20@a[tag=\x22', '\x0aProximity\x20VC:\x20', 'then', '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20', 'https://mcproxvc.ovh/connect/?roomid=', 'Error\x20handling\x20world\x20loop\x20[', 'initialization', 'tcpexposer.com', 'handleUpgrade']; _0x298e = function () { return _0x3f4e60; }; return _0x298e(); } let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs[_0x3b4aba(0x1d4)](filePath)) try { const fileContent = fs[_0x3b4aba(0x14f)](filePath, _0x3b4aba(0x26f)); globalConfig = JSON5[_0x3b4aba(0x262)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x5a7083) { console[_0x3b4aba(0x217)](_0x3b4aba(0x19b) + filePath + ':', _0x5a7083[_0x3b4aba(0x1d2)]); } } !configLoaded && console[_0x3b4aba(0x22b)](_0x3b4aba(0x18f)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x3b4aba(0x211)] = INITIAL_CONFIG['verify'] ?? INITIAL_CONFIG[_0x3b4aba(0x211)]; const nameCache = new Map(), processName = _0x47256b => { const _0x273307 = _0x3b4aba; if (!nameCache[_0x273307(0x226)](_0x47256b)) { const _0x1b9fd6 = wanakana[_0x273307(0x27c)](_0x47256b[_0x273307(0x1cc)](/ /g, '_'))[_0x273307(0x1cc)](/n'/g, 'n'); nameCache[_0x273307(0x1c2)](_0x47256b, _0x1b9fd6); } return nameCache[_0x273307(0x249)](_0x47256b); }; function _0xa5c8(_0x49b4f3, _0x572190) { _0x49b4f3 = _0x49b4f3 - 0x144; const _0x298e80 = _0x298e(); let _0xa5c8a8 = _0x298e80[_0x49b4f3]; return _0xa5c8a8; } async function updateConfigFile(_0x36b5dd, _0x2cbdd9) { const _0x7a7af4 = _0x3b4aba; if (!configPath) return; try { let _0x3fd315 = await fsPromises[_0x7a7af4(0x16a)](configPath, _0x7a7af4(0x26f)); const _0x15b8e4 = new RegExp('(\x22' + _0x36b5dd + '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)'), _0x416dd8 = typeof _0x2cbdd9 === _0x7a7af4(0x1d6) ? '\x22' + _0x2cbdd9 + '\x22' : _0x2cbdd9, _0x2e5b6f = _0x3fd315[_0x7a7af4(0x1cc)](_0x15b8e4, '$1' + _0x416dd8); _0x2e5b6f !== _0x3fd315 && await fsPromises[_0x7a7af4(0x1c3)](configPath, _0x2e5b6f, 'utf8'); } catch (_0x468204) { console['error']('❌\x20設定ファイルの更新に失敗しました:', _0x468204); } }; const makeRange = (_0x35b6e3, _0x1e0444) => Array[_0x3b4aba(0x179)]({ 'length': _0x1e0444 - _0x35b6e3 + 0x1 }, (_0x104e0b, _0x5a9ad4) => _0x35b6e3 + _0x5a9ad4); let globalGatewayServer = null; function startSshTunnel(_0x373bc4, _0x5282bf, _0x44eaa9) { return new Promise(_0x3159ec => { const _0x3ae7db = _0xa5c8, { username: _0x4b28ba, ssh_password: _0x1fcddf, lang: _0x4b95fa } = _0x373bc4[_0x3ae7db(0x1cb)]; if (!_0x5282bf || !_0x4b28ba || !_0x1fcddf) { _0x3159ec(null); return; } const _0x256373 = { 'host': _0x3ae7db(0x158), 'port': 0x16, 'username': _0x4b28ba, 'password': _0x1fcddf }, _0x42f722 = { 'remoteAddr': _0x5282bf, 'remotePort': 0x50, 'localAddr': _0x3ae7db(0x22f), 'localPort': _0x44eaa9 }, _0x5a9af7 = new Client(); let _0x27a9dd = ![]; const _0x7bcac6 = async _0x36663e => { const _0x232e26 = _0x3ae7db; if (_0x27a9dd) return; _0x27a9dd = !![], console['error'](_0x232e26(0x220) + _0x5282bf + '):', _0x36663e[_0x232e26(0x1d2)]), _0x373bc4['sshError'] = 'ssh_failed', _0x373bc4[_0x232e26(0x237)](_0x232e26(0x25d)), _0x373bc4[_0x232e26(0x243)] = '', await _0x373bc4[_0x232e26(0x1ca)]('mc'), _0x5a9af7['end'](), _0x3159ec(null); }; _0x5a9af7['on'](_0x3ae7db(0x1e9), () => { const _0x48c14a = _0x3ae7db; _0x5a9af7['forwardIn'](_0x42f722[_0x48c14a(0x14d)], _0x42f722[_0x48c14a(0x27b)], async _0x187b34 => { const _0x535c38 = _0x48c14a; if (_0x187b34) { console[_0x535c38(0x217)](_0x535c38(0x27f) + _0x5282bf + '):', _0x187b34[_0x535c38(0x1d2)]), _0x373bc4['logInfo'](_0x535c38(0x25d)), await _0x7bcac6(_0x187b34); return; } console[_0x535c38(0x273)](_0x535c38(0x195)), _0x373bc4['useRelay'] = ![], _0x373bc4[_0x535c38(0x1c7)] = !![], _0x373bc4[_0x535c38(0x237)](_0x535c38(0x1d7) + _0x5282bf); if (_0x373bc4[_0x535c38(0x1cb)]['lang'] === 'ja') _0x373bc4[_0x535c38(0x237)](_0x535c38(0x1ce)); else _0x373bc4[_0x535c38(0x237)](_0x535c38(0x261)); _0x373bc4['logInfo'](_0x535c38(0x155) + _0x5282bf); if (_0x373bc4['config'][_0x535c38(0x24d)] === 'ja') _0x373bc4['logInfo']('Minecraftから以下のコマンドで接続してください:'); else _0x373bc4[_0x535c38(0x237)]('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'); _0x373bc4['logInfo'](_0x535c38(0x187) + _0x5282bf + '.tcpexposer.com'), _0x373bc4[_0x535c38(0x1de)] = _0x535c38(0x187) + _0x5282bf + _0x535c38(0x266); if (_0x4b95fa === 'ja') _0x373bc4[_0x535c38(0x237)](_0x535c38(0x18a)); else _0x373bc4['logInfo'](_0x535c38(0x215)); _0x373bc4[_0x535c38(0x237)]('/pvc:connect\x20\x22' + _0x5282bf + _0x535c38(0x160)), console[_0x535c38(0x273)](_0x535c38(0x260)), !_0x27a9dd && (_0x27a9dd = !![], _0x3159ec(_0x5a9af7)); }), _0x5a9af7['on']('tcp\x20connection', (_0x341023, _0x31bdde) => { const _0x5159af = _0x48c14a, _0x234097 = _0x31bdde(), _0x2216f2 = net['createConnection']({ 'host': _0x42f722['localAddr'], 'port': _0x42f722['localPort'] }); _0x2216f2['on']('connect', () => _0x234097[_0x5159af(0x204)](_0x2216f2)[_0x5159af(0x204)](_0x234097)), _0x2216f2['on'](_0x5159af(0x217), _0x56540b => { const _0x30f3ae = _0x5159af; _0x234097[_0x30f3ae(0x1bc)](); }), _0x234097['on'](_0x5159af(0x1bc), () => _0x2216f2[_0x5159af(0x178)]()); }); })['on']('error', _0x41b126 => { _0x7bcac6(_0x41b126); }), _0x5a9af7['on'](_0x3ae7db(0x1bc), () => { !_0x27a9dd && (_0x27a9dd = !![], _0x3159ec(null)); }), _0x5a9af7[_0x3ae7db(0x247)](_0x256373); }); } function setupGlobalVcWebSocket(_0x3ff21) { const _0x33484e = _0x3b4aba; if (globalGatewayServer) return; const _0x119193 = express(), _0x7f9350 = http[_0x33484e(0x1c1)](_0x119193), _0x16957 = new WebSocket[(_0x33484e(0x212))]({ 'noServer': !![] }); _0x119193['use'](express[_0x33484e(0x282)]()), _0x119193[_0x33484e(0x271)]('/', (_0x2f8077, _0x535794) => { const _0xd5a819 = _0x33484e, { type: _0x4af587 } = _0x2f8077['body'], _0x17d6c8 = _0x2f8077[_0xd5a819(0x20d)][_0xd5a819(0x252)]; let _0x59ab1b = null; if (_0x17d6c8) { for (const _0x19f730 of sessions['values']()) { const _0x22172b = _0x19f730['config'][_0xd5a819(0x15b)]; if (_0x22172b && _0x17d6c8[_0xd5a819(0x233)](_0x22172b)) { _0x59ab1b = _0x19f730; break; } } if (!_0x59ab1b) for (const _0x2f58e6 of pendingSessions['values']()) { const _0x29e835 = _0x2f58e6[_0xd5a819(0x1cb)][_0xd5a819(0x15b)]; if (_0x29e835 && _0x17d6c8[_0xd5a819(0x233)](_0x29e835)) { _0x59ab1b = _0x2f58e6; break; } } } if (_0x59ab1b) { if (_0x4af587 === 'data_update') _0x59ab1b[_0xd5a819(0x225)](_0x2f8077[_0xd5a819(0x1f7)]); else { if (_0x4af587 === 'disconnect_command') _0x59ab1b[_0xd5a819(0x274)]('success'); } _0x4af587 === _0xd5a819(0x157) ? (_0x59ab1b[_0xd5a819(0x1c7)] = !![], _0x59ab1b['logInfo'](_0xd5a819(0x277)), _0x535794['status'](0xc8)[_0xd5a819(0x282)]({ 'type': _0xd5a819(0x157), 'roomId': _0x59ab1b['roomId'], 'ws_connected': _0x59ab1b[_0xd5a819(0x1a6)], ..._0x59ab1b[_0xd5a819(0x1cb)] })) : _0x535794['status'](0xc8)['json']({ 'success': !![] }); } else _0x535794[_0xd5a819(0x1ab)](0x194)['json']({ 'error': _0xd5a819(0x285) }); }), _0x119193[_0x33484e(0x249)]('/', (_0x5546a0, _0x27f1a3) => { const _0x52e20d = _0x33484e; _0x27f1a3[_0x52e20d(0x253)](_0x52e20d(0x258)); }), _0x7f9350['on'](_0x33484e(0x21f), (_0x155988, _0x10e36f, _0xfd22) => { const _0x354645 = _0x33484e; let _0x5c189b = null, _0x2c8e99 = null; try { const _0x2c9bde = _0x155988['headers'][_0x354645(0x252)] || 'localhost'; let _0x14d1b0 = _0x155988[_0x354645(0x15d)] || '/'; if (_0x14d1b0 === '//') _0x14d1b0 = '/'; _0x2c8e99 = new URL(_0x14d1b0, _0x354645(0x161) + _0x2c9bde), _0x5c189b = _0x2c8e99[_0x354645(0x25c)]['get'](_0x354645(0x287)); } catch (_0x28494d) { _0x5c189b = null; } if (_0x5c189b !== 'vc') { const _0x360b0f = net['createConnection']({ 'port': INITIAL_CONFIG[_0x354645(0x1e7)], 'host': _0x354645(0x22f) }); _0x360b0f['on'](_0x354645(0x247), () => { const _0x211722 = _0x354645, _0x542fda = _0x155988[_0x211722(0x20d)][_0x211722(0x252)], _0x4a0424 = _0x155988['method'], _0x3243e9 = _0x155988[_0x211722(0x15d)], _0x22d83e = _0x155988[_0x211722(0x223)]; let _0x1932cf = _0x4a0424 + '\x20' + _0x3243e9 + _0x211722(0x245) + _0x22d83e + '\x0d\x0a'; for (const [_0x2a1715, _0x5ebbf0] of Object[_0x211722(0x1fd)](_0x155988['headers'])) { _0x1932cf += _0x2a1715 + ':\x20' + _0x5ebbf0 + '\x0d\x0a'; } _0x1932cf += _0x211722(0x1fc) + _0x542fda + '\x0d\x0a', _0x1932cf += '\x0d\x0a', _0x360b0f[_0x211722(0x246)](_0x1932cf), _0xfd22 && _0xfd22[_0x211722(0x240)] > 0x0 && _0x360b0f[_0x211722(0x246)](_0xfd22), _0x10e36f['pipe'](_0x360b0f), _0x360b0f[_0x211722(0x204)](_0x10e36f); }), _0x360b0f['on'](_0x354645(0x217), _0x5ddca9 => { _0x10e36f['end'](); }), _0x360b0f['on'](_0x354645(0x1bc), () => { const _0x418c78 = _0x354645; _0x10e36f[_0x418c78(0x178)](); }), _0x10e36f['on'](_0x354645(0x217), _0x46168b => { const _0x6778 = _0x354645; _0x360b0f[_0x6778(0x178)](); }), _0x10e36f['on'](_0x354645(0x1bc), () => { const _0x256416 = _0x354645; _0x360b0f[_0x256416(0x178)](); }); } else _0x16957[_0x354645(0x159)](_0x155988, _0x10e36f, _0xfd22, _0x5a65f1 => { const _0x4231c9 = _0x354645, _0x1991b4 = _0x155988[_0x4231c9(0x20d)][_0x4231c9(0x252)]; let _0x53c71a = null; if (_0x1991b4) { for (const _0x393fe1 of sessions[_0x4231c9(0x186)]()) { const _0x417086 = _0x393fe1[_0x4231c9(0x1cb)]['sub_domain']; if (_0x417086 && _0x1991b4[_0x4231c9(0x233)](_0x417086)) { _0x53c71a = _0x393fe1; break; } } if (!_0x53c71a) for (const _0x363cde of pendingSessions[_0x4231c9(0x186)]()) { const _0x1fc5b0 = _0x363cde[_0x4231c9(0x1cb)][_0x4231c9(0x15b)]; if (_0x1fc5b0 && _0x1991b4[_0x4231c9(0x233)](_0x1fc5b0)) { _0x53c71a = _0x363cde; break; } } } if (_0x53c71a) _0x53c71a[_0x4231c9(0x23e)](_0x5a65f1); else { const _0x328a98 = sessions['values']()[_0x4231c9(0x21e)]()[_0x4231c9(0x145)] || pendingSessions[_0x4231c9(0x186)]()['next']()[_0x4231c9(0x145)]; if (_0x328a98) _0x328a98[_0x4231c9(0x23e)](_0x5a65f1); else _0x5a65f1['close'](); } }); }), _0x7f9350[_0x33484e(0x278)](_0x3ff21, () => { }), globalGatewayServer = _0x7f9350; }; class Session { constructor(_0x1751bd, _0x4ad3e7 = {}) { const _0x3186a0 = _0x3b4aba; this['id'] = randomUUID(), this[_0x3186a0(0x269)] = _0x1751bd, this[_0x3186a0(0x1b4)] = _0x1751bd ? _0x1751bd['name'] || 'Unknown\x20World' : _0x3186a0(0x14a), this[_0x3186a0(0x1cb)] = { ...INITIAL_CONFIG, ..._0x4ad3e7 }, this[_0x3186a0(0x243)] = this[_0x3186a0(0x1cb)]['sub_domain'], this[_0x3186a0(0x1de)] = '', this[_0x3186a0(0x198)] = {}, this[_0x3186a0(0x1b7)] = {}, this[_0x3186a0(0x272)] = {}, this[_0x3186a0(0x21c)] = {}, this[_0x3186a0(0x236)] = {}, this['onlinePlayers'] = new Set(), this[_0x3186a0(0x164)] = !![], this[_0x3186a0(0x1c7)] = ![], this[_0x3186a0(0x1a6)] = ![], this[_0x3186a0(0x1b1)] = ![], this['useRelay'] = ![], this['useResetTimer'] = ![], this[_0x3186a0(0x27e)] = null, this['localClient'] = null, this[_0x3186a0(0x270)] = new Set(), this[_0x3186a0(0x21a)] = null, this[_0x3186a0(0x20b)] = null, this['inactivityTimer'] = null, this[_0x3186a0(0x23b)] = 0x0, this[_0x3186a0(0x1a1)] = null, this[_0x3186a0(0x259)] = this[_0x3186a0(0x221)](); } [_0x3b4aba(0x237)](_0x2d91be) { console['log']('\x1b[36m[Info][' + this['id']['substring'](0x0, 0x6) + ']\x1b[0m\x20' + _0x2d91be); } [_0x3b4aba(0x25f)](_0x2f02a7) { const _0x172ad6 = _0x3b4aba; console[_0x172ad6(0x273)]('\x1b[33m[Log][' + this['id']['substring'](0x0, 0x6) + _0x172ad6(0x1b3) + _0x2f02a7); } [_0x3b4aba(0x23e)](_0x5767a1) { const _0x46986f = _0x3b4aba; this[_0x46986f(0x270)][_0x46986f(0x23c)](_0x5767a1), this[_0x46986f(0x1c7)] = !![], this[_0x46986f(0x265)](_0x5767a1), _0x5767a1['on'](_0x46986f(0x1d2), async _0x45e7de => { const _0x380ada = _0x46986f; try { let _0x245390; try { _0x245390 = msgpack[_0x380ada(0x1aa)](_0x45e7de); } catch (_0x2a5b42) { try { _0x245390 = JSON['parse'](_0x45e7de); } catch (_0x18ff0e) { } } if (_0x245390) { if (_0x245390[_0x380ada(0x1a9)] && _0x245390[_0x380ada(0x1f1)]) this['positions'][_0x245390[_0x380ada(0x1a9)]] = _0x245390['position']; if (_0x245390[_0x380ada(0x27a)] === _0x380ada(0x256) && typeof _0x245390[_0x380ada(0x145)] === _0x380ada(0x1d6)) { if (this[_0x380ada(0x269)]) { const _0x5827da = await this[_0x380ada(0x269)]['runCommand'](_0x245390[_0x380ada(0x145)]); _0x5767a1[_0x380ada(0x253)](JSON['stringify']({ 'type': _0x380ada(0x191), 'payload': _0x5827da })); } } } } catch (_0x428ad1) { } }), _0x5767a1['on']('close', () => { const _0x2b0129 = _0x46986f; this[_0x2b0129(0x270)][_0x2b0129(0x189)](_0x5767a1); }); } async[_0x3b4aba(0x1db)]() { const _0x15e3c9 = _0x3b4aba, { sub_domain: _0x1651e2, username: _0x1ebc2b, ssh_password: _0x501ebf } = this[_0x15e3c9(0x1cb)]; if (_0x1ebc2b && _0x501ebf && _0x1651e2) this[_0x15e3c9(0x21a)] = await startSshTunnel(this, _0x1651e2, INITIAL_CONFIG[_0x15e3c9(0x24f)]); else await this[_0x15e3c9(0x1ca)]('mc'); } [_0x3b4aba(0x167)](_0x497c99) { const _0x3f6cf6 = _0x3b4aba; this['pendingTimeout'] && (clearTimeout(this[_0x3f6cf6(0x1a1)]), this[_0x3f6cf6(0x1a1)] = null), this[_0x3f6cf6(0x269)] = _0x497c99, this[_0x3f6cf6(0x1b4)] = _0x497c99[_0x3f6cf6(0x194)] || _0x3f6cf6(0x176), this[_0x3f6cf6(0x168)](); } async[_0x3b4aba(0x168)]() { const _0x262e0b = _0x3b4aba; if (!this[_0x262e0b(0x269)] && !this['pendingTimeout']) return; if (!this[_0x262e0b(0x1d0)] && !this[_0x262e0b(0x21a)]) { const { sub_domain: _0x405b90, username: _0x2fc63e, ssh_password: _0x5d1c9b } = this[_0x262e0b(0x1cb)]; if (_0x2fc63e && _0x5d1c9b && _0x405b90) this[_0x262e0b(0x21a)] = await startSshTunnel(this, _0x405b90, INITIAL_CONFIG[_0x262e0b(0x24f)]); else { if (!_0x405b90) await this[_0x262e0b(0x1ca)]('mc'); } } this[_0x262e0b(0x1a6)] = !![], this[_0x262e0b(0x1b1)] = ![], this[_0x262e0b(0x237)](_0x262e0b(0x277)); if (this['world']) { try { this[_0x262e0b(0x286)](), this[_0x262e0b(0x269)]['runCommand'](_0x262e0b(0x1f0) + this[_0x262e0b(0x243)] + '\x22'), this['sendInitMessage'](); } catch (_0x4611bc) { } this['loop'](); } } async[_0x3b4aba(0x286)]() { const _0x248f10 = _0x3b4aba; if (!this[_0x248f10(0x269)]) return; try { const _0x2cc4bd = await this[_0x248f10(0x177)](), _0xec55c4 = _0x2cc4bd[_0x248f10(0x16b)](_0xf335fb => _0xf335fb[_0x248f10(0x233)]('pvc:')); for (const _0x2332fe of _0xec55c4) { this[_0x248f10(0x269)]['runCommand'](_0x248f10(0x151) + _0x2332fe + '\x22]\x20remove\x20\x22' + _0x2332fe + '\x22'); } const _0x9035a5 = await this[_0x248f10(0x269)][_0x248f10(0x26b)](_0x248f10(0x175)); this[_0x248f10(0x1f8)][_0x248f10(0x284)](); if (_0x9035a5[_0x248f10(0x238)]) _0x9035a5[_0x248f10(0x238)][_0x248f10(0x15c)](_0x3524e6 => this[_0x248f10(0x1f8)]['add'](_0x3524e6)); } catch (_0x404d65) { } } [_0x3b4aba(0x1fa)]() { const _0x3f3ca7 = _0x3b4aba; if (!this[_0x3f3ca7(0x269)]) return; const { proximity: _0x232219, distance: _0x4ccb33, lang: _0x55a50b } = this[_0x3f3ca7(0x1cb)]; if (_0x55a50b == 'ja') { let _0x40f9fe = _0x232219 ? '有効' : '無効'; this['world'][_0x3f3ca7(0x172)](_0x3f3ca7(0x1ec) + _0x40f9fe + _0x3f3ca7(0x255) + _0x4ccb33 + '\x0a!help\x20でコマンド一覧を確認できます')['catch'](_0x23f37a => { }); } else { let _0x3adecb = _0x232219 ? _0x3f3ca7(0x184) : _0x3f3ca7(0x1cf); this[_0x3f3ca7(0x269)][_0x3f3ca7(0x172)](_0x3f3ca7(0x20a) + _0x3adecb + _0x3f3ca7(0x1a7) + _0x4ccb33 + _0x3f3ca7(0x26a))[_0x3f3ca7(0x1ea)](_0x4476ad => { }); } } [_0x3b4aba(0x1d5)]() { const _0x22c303 = _0x3b4aba; this[_0x22c303(0x1bb)] = !![], clearTimeout(this['inactivityTimer']), this[_0x22c303(0x283)] = setTimeout(() => { const _0x41c9fe = _0x22c303; this[_0x41c9fe(0x274)](_0x41c9fe(0x1ee)); }, INACTIVITY_TIMEOUT); } ['startTimer']() { setTimeout(() => { const _0x581251 = _0xa5c8; if (this[_0x581251(0x269)]) this[_0x581251(0x269)][_0x581251(0x172)](this[_0x581251(0x1cb)][_0x581251(0x24d)] === 'ja' ? _0x581251(0x18d) : _0x581251(0x279))['catch'](() => { }); console[_0x581251(0x273)](_0x581251(0x195)), console[_0x581251(0x273)](_0x581251(0x1f3) + this[_0x581251(0x1b4)] + _0x581251(0x26e)), console['log'](_0x581251(0x260)), setTimeout(() => this['destroy'](_0x581251(0x1ee)), 0x1388); }, MAX_RUNTIME), this['resetTimer'](); } async[_0x3b4aba(0x1c0)]() { const _0x4feec7 = _0x3b4aba; if (this[_0x4feec7(0x1b1)] || !this[_0x4feec7(0x269)]) return; try { if (this[_0x4feec7(0x1bb)]) this[_0x4feec7(0x1d5)](); let _0x2d3162 = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }; if (this['config'][_0x4feec7(0x1d3)]) { const [_0x55eb92, _0x32c9ee, _0xd1ad0e, _0x20d69c, _0x2a5bd8] = await Promise[_0x4feec7(0x241)]([this['world'][_0x4feec7(0x26b)](_0x4feec7(0x1bf)), this['world'][_0x4feec7(0x26b)](_0x4feec7(0x182)), this[_0x4feec7(0x269)][_0x4feec7(0x26b)](_0x4feec7(0x1a2)), this[_0x4feec7(0x269)][_0x4feec7(0x26b)](_0x4feec7(0x17e)), this[_0x4feec7(0x177)]()]); if (_0x55eb92[_0x4feec7(0x19a)] <= -0x1) { this['consecutiveTimeouts']++; if (this[_0x4feec7(0x23b)] >= TIMEOUT_THRESHOLD) { this[_0x4feec7(0x274)](_0x4feec7(0x209)); return; } } else this[_0x4feec7(0x23b)] = 0x0; _0x55eb92['statusCode'] === 0x0 && typeof _0x55eb92[_0x4feec7(0x228)] === _0x4feec7(0x1d6) && (_0x2d3162['playersNames'] = _0x55eb92[_0x4feec7(0x228)][_0x4feec7(0x197)](',')[_0x4feec7(0x244)](_0x315bd8 => _0x315bd8[_0x4feec7(0x24a)]())[_0x4feec7(0x16b)](_0x13025c => _0x13025c['length'] > 0x0)); if (_0x32c9ee[_0x4feec7(0x238)]) _0x32c9ee[_0x4feec7(0x238)]['forEach'](_0x2a2075 => _0x2d3162[_0x4feec7(0x1b9)][_0x4feec7(0x23c)](_0x2a2075)); if (_0xd1ad0e['victim']) _0xd1ad0e[_0x4feec7(0x238)][_0x4feec7(0x15c)](_0x33a44a => _0x2d3162[_0x4feec7(0x1fb)][_0x4feec7(0x23c)](_0x33a44a)); try { _0x2d3162['details'] = JSON[_0x4feec7(0x262)](_0x20d69c[_0x4feec7(0x22c)] || '[]'); } catch (_0x407191) { _0x2d3162[_0x4feec7(0x22c)] = []; } } const _0x57cfcd = Array[_0x4feec7(0x179)](_0x2d3162[_0x4feec7(0x1b9)]); _0x2d3162[_0x4feec7(0x1c5)]['forEach'](_0x11090c => { const _0x3a99da = _0x4feec7, _0x11ad35 = processName(_0x11090c), _0x1f355f = _0x2d3162[_0x3a99da(0x1fb)][_0x3a99da(0x226)](_0x11090c); this[_0x3a99da(0x236)][_0x11ad35] = _0x1f355f; if (!this['config']['proximity']) this[_0x3a99da(0x1b7)][_0x11ad35] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x2d3162[_0x3a99da(0x1b9)][_0x3a99da(0x226)](_0x11090c)) this[_0x3a99da(0x1b7)][_0x11ad35] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this['config'][_0x3a99da(0x242)] && _0x1f355f) { if (this[_0x3a99da(0x1cb)][_0x3a99da(0x1f4)] === !![]) { const _0x49ff1b = _0x57cfcd[_0x3a99da(0x208)](_0x11090c); if (_0x49ff1b !== -0x1 && _0x2d3162[_0x3a99da(0x22c)][_0x49ff1b]) { this[_0x3a99da(0x1b7)][_0x11ad35] = _0x2d3162['details'][_0x49ff1b]['position']; if (this[_0x3a99da(0x1cb)]['specDim'] === !![]) this['dimensions'][_0x11ad35] = _0x2d3162[_0x3a99da(0x22c)][_0x49ff1b][_0x3a99da(0x16e)]; } else this[_0x3a99da(0x1b7)][_0x11ad35] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this['positions'][_0x11ad35] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0x4103a7 = _0x57cfcd[_0x3a99da(0x208)](_0x11090c); if (_0x4103a7 !== -0x1 && _0x2d3162[_0x3a99da(0x22c)][_0x4103a7]) this[_0x3a99da(0x1b7)][_0x11ad35] = _0x2d3162[_0x3a99da(0x22c)][_0x4103a7][_0x3a99da(0x1f1)], this['yRots'][_0x11ad35] = _0x2d3162[_0x3a99da(0x22c)][_0x4103a7]['yRot'], this[_0x3a99da(0x21c)][_0x11ad35] = _0x2d3162[_0x3a99da(0x22c)][_0x4103a7]['dimension']; else this[_0x3a99da(0x1b7)][_0x11ad35] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this['shouldBroadcast'] = !![], this[_0x4feec7(0x24b)](); } catch (_0x25ec34) { console[_0x4feec7(0x217)](_0x4feec7(0x156) + this[_0x4feec7(0x1b4)] + ']:', _0x25ec34); } if (!this[_0x4feec7(0x1b1)]) setTimeout(() => this['loop'](), 0x0); } async[_0x3b4aba(0x177)]() { const _0x3c4791 = _0x3b4aba; if (!this[_0x3c4791(0x269)]) return []; try { const _0x510184 = await this[_0x3c4791(0x269)][_0x3c4791(0x26b)]('tag\x20@a\x20list'); if (_0x510184[_0x3c4791(0x19a)] !== 0x0 || !_0x510184[_0x3c4791(0x1c4)]) return []; let _0x5a19ba = []; const _0x1bf1c9 = _0x510184[_0x3c4791(0x1c4)][_0x3c4791(0x197)](/\r\n|\n|\r/); for (const _0x4c5e27 of _0x1bf1c9) { if (!_0x4c5e27[_0x3c4791(0x24a)]()) continue; const _0x41a530 = _0x4c5e27[_0x3c4791(0x1cc)](/§./g, ''), _0x671e30 = _0x41a530[_0x3c4791(0x208)](':'); _0x671e30 !== -0x1 && (_0x5a19ba = _0x5a19ba[_0x3c4791(0x190)](_0x41a530[_0x3c4791(0x196)](_0x671e30 + 0x1)[_0x3c4791(0x197)](',')['map'](_0x5bfc0b => _0x5bfc0b['trim']()))); } return _0x5a19ba; } catch (_0x43c73d) { return []; } } [_0x3b4aba(0x24b)]() { const _0x39dd14 = _0x3b4aba; if (!this['shouldBroadcast']) return; const _0x594559 = {}; for (const [_0x381b22, _0x47d4ca] of Object[_0x39dd14(0x1fd)](this[_0x39dd14(0x1b7)])) { if (_0x47d4ca) _0x594559[_0x381b22] = [Math[_0x39dd14(0x180)](_0x47d4ca['x'] * 0x64) / 0x64, Math['round'](_0x47d4ca['y'] * 0x64) / 0x64, Math[_0x39dd14(0x180)](_0x47d4ca['z'] * 0x64) / 0x64]; } const _0x781e46 = { 'spec': this[_0x39dd14(0x1cb)][_0x39dd14(0x242)], 'spLis': this['config']['specListen'], 'spDim': this['config'][_0x39dd14(0x257)], 't': 'wu', 'pos': _0x594559, 'dis': this['config']['distance'], 'pssws': this['passwords'], 'dim': this[_0x39dd14(0x21c)], 'yr': this[_0x39dd14(0x272)], 'spPos': this[_0x39dd14(0x236)], 'prox': this[_0x39dd14(0x1cb)]['proximity'] ? 0x1 : 0x0 }, _0x3aa4cf = msgpack[_0x39dd14(0x23d)](_0x781e46); if (this[_0x39dd14(0x27e)] && this[_0x39dd14(0x27e)][_0x39dd14(0x1ae)] === WebSocket[_0x39dd14(0x1ba)]) this[_0x39dd14(0x27e)][_0x39dd14(0x253)](_0x3aa4cf); this[_0x39dd14(0x270)][_0x39dd14(0x15c)](_0x470aba => { const _0x591fa0 = _0x39dd14; if (_0x470aba[_0x591fa0(0x1ae)] === WebSocket[_0x591fa0(0x1ba)]) _0x470aba[_0x591fa0(0x253)](_0x3aa4cf); }); } async['connectToRelayServer'](_0x55f808) { const _0xf277b9 = _0x3b4aba, _0x4de00d = _0x55f808 === 'mc', _0x478aeb = _0x4de00d ? _0xf277b9(0x1e5) : '[VC\x20Relay]'; try { if (!this[_0xf277b9(0x243)]) { const _0xa91cc0 = await fetch(_0xf277b9(0x15a) + RELAY_SERVER_DOMAIN + _0xf277b9(0x1b6)), _0x4c6437 = await _0xa91cc0[_0xf277b9(0x282)](); this[_0xf277b9(0x243)] = _0x4c6437['roomId']; if (this['world']) { this[_0xf277b9(0x286)](), this[_0xf277b9(0x269)]['runCommand'](_0xf277b9(0x1f0) + this[_0xf277b9(0x243)] + '\x22')[_0xf277b9(0x1ea)](() => { }); if (this[_0xf277b9(0x1cb)][_0xf277b9(0x24d)] === 'ja') await this['world']['sendMessage'](_0xf277b9(0x20e) + this[_0xf277b9(0x243)]); else await this[_0xf277b9(0x269)][_0xf277b9(0x172)](_0xf277b9(0x206) + this[_0xf277b9(0x243)]); } } else { if (!this[_0xf277b9(0x1d0)]) { if (this[_0xf277b9(0x269)]) { if (this[_0xf277b9(0x1cb)][_0xf277b9(0x24d)] === 'ja') await this['world']['sendMessage'](_0xf277b9(0x20e) + this[_0xf277b9(0x243)]); else await this['world'][_0xf277b9(0x172)]('Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20' + this[_0xf277b9(0x243)]); } } } this['useRelay'] = !![]; if (_0x4de00d) { console[_0xf277b9(0x273)](_0xf277b9(0x195)); if (this[_0xf277b9(0x1cb)][_0xf277b9(0x24d)] === 'ja') this[_0xf277b9(0x237)]('Minecraftから以下のコマンドで接続してください:'); else this[_0xf277b9(0x237)]('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'); this[_0xf277b9(0x237)](_0xf277b9(0x187) + RELAY_SERVER_DOMAIN + _0xf277b9(0x149) + this[_0xf277b9(0x243)]), this[_0xf277b9(0x1de)] = _0xf277b9(0x187) + RELAY_SERVER_DOMAIN + _0xf277b9(0x149) + this[_0xf277b9(0x243)]; } else { this[_0xf277b9(0x237)](_0xf277b9(0x1be) + this[_0xf277b9(0x243)]); if (this[_0xf277b9(0x1cb)][_0xf277b9(0x24d)] === 'ja') this[_0xf277b9(0x237)](_0xf277b9(0x1ce)); else this[_0xf277b9(0x237)](_0xf277b9(0x261)); this[_0xf277b9(0x237)](_0xf277b9(0x155) + this[_0xf277b9(0x243)]), console[_0xf277b9(0x273)](_0xf277b9(0x260)); } this[_0xf277b9(0x18c)](); let _0x1d7fb5; if (this[_0xf277b9(0x27e)]) { _0x1d7fb5 = this[_0xf277b9(0x27e)]; if (_0x1d7fb5[_0xf277b9(0x1ae)] !== WebSocket[_0xf277b9(0x1ba)]) { } } else _0x1d7fb5 = new WebSocket(_0xf277b9(0x202) + RELAY_SERVER_DOMAIN + _0xf277b9(0x149) + this['roomId'] + '?clientType=server_script'), this[_0xf277b9(0x27e)] = _0x1d7fb5, _0x1d7fb5['on'](_0xf277b9(0x288), () => this[_0xf277b9(0x237)]('[Relay]\x20Connected\x20(ID:\x20' + this[_0xf277b9(0x243)] + ')')), _0x1d7fb5['on'](_0xf277b9(0x1bc), () => { const _0xb1b81f = _0xf277b9; if (this[_0xb1b81f(0x27e)] === _0x1d7fb5) this[_0xb1b81f(0x27e)] = null; }), _0x1d7fb5['on']('error', _0x45a67e => console[_0xf277b9(0x217)](_0x478aeb + '\x20Error:', _0x45a67e)); _0x4de00d ? (this['mc_connected'] = !![], this[_0xf277b9(0x27d)](_0x1d7fb5), this['connectToRelayServer']('vc')) : (this[_0xf277b9(0x1c7)] = !![], this['setupVcRelayListeners'](_0x1d7fb5)); } catch (_0x565e99) { console[_0xf277b9(0x217)](_0x478aeb + '\x20Error:', _0x565e99); } } [_0x3b4aba(0x265)](_0x3e6c08) { const _0x28a115 = _0x3b4aba, { app_id: _0x43df53, secret_key: _0xb19199, proximity: _0xbfd19, distance: _0x44321d, spectator: _0x1d3cde, specListen: _0x357f60, specDim: _0x2fbff6, verify: _0x35efe5, password: _0x1cde5c } = this[_0x28a115(0x1cb)]; _0x3e6c08['send'](msgpack['encode']({ 'password': !!(_0x35efe5 || _0x1cde5c), 'passwords': this[_0x28a115(0x198)], 'app_id': _0x43df53, 'secret_key': _0xb19199, 'proximity': _0xbfd19, 'distance': _0x44321d, 'spectator': _0x1d3cde, 'specListen': _0x357f60, 'specDim': _0x2fbff6 })); } [_0x3b4aba(0x14e)](_0x231281) { const _0x4aecb7 = _0x3b4aba; _0x231281['on'](_0x4aecb7(0x1d2), async _0x374d14 => { const _0x24d4d8 = _0x4aecb7; try { const _0x29e30d = JSON[_0x24d4d8(0x262)](_0x374d14['toString']()); if (_0x29e30d[_0x24d4d8(0x1b0)] === _0x24d4d8(0x18b)) { this[_0x24d4d8(0x265)](_0x231281); return; } if (_0x29e30d[_0x24d4d8(0x27a)] === _0x24d4d8(0x256)) { if (this[_0x24d4d8(0x269)]) await this[_0x24d4d8(0x269)][_0x24d4d8(0x26b)](_0x29e30d[_0x24d4d8(0x145)]); } } catch (_0x22724c) { } }); } [_0x3b4aba(0x27d)](_0x2244d1) { const _0x4a6504 = _0x3b4aba; _0x2244d1['on']('message', async _0x40bdab => { const _0x27e72b = _0xa5c8; let _0x42de7c = _0x40bdab; try { Buffer[_0x27e72b(0x232)](_0x40bdab) && _0x40bdab[_0x27e72b(0x240)] > 0x2 && _0x40bdab[0x0] === 0x1f && _0x40bdab[0x1] === 0x8b && (_0x42de7c = zlib['gunzipSync'](_0x40bdab)); } catch (_0x48c003) { } try { const _0x22f150 = JSON['parse'](_0x42de7c[_0x27e72b(0x1a4)]()); if (_0x22f150['type'] === 'partner_connected') { const _0x50a78e = _0x22f150[_0x27e72b(0x287)] || 'minecraft'; _0x50a78e === 'minecraft' ? (this[_0x27e72b(0x183)] = new WebSocket('ws://127.0.0.1:' + this[_0x27e72b(0x1cb)]['port'], { 'headers': { 'x-proxvc-session': this['id'] } }), this['localClientBuffer'] = [], this[_0x27e72b(0x183)]['on'](_0x27e72b(0x288), () => { const _0x20fc44 = _0x27e72b; while (this[_0x20fc44(0x173)]['length'] > 0x0) { const _0x55b319 = this['localClientBuffer']['shift'](); this['localClient'][_0x20fc44(0x253)](_0x55b319); } }), this[_0x27e72b(0x183)]['on'](_0x27e72b(0x1d2), _0x58e723 => _0x2244d1[_0x27e72b(0x1ae)] === WebSocket[_0x27e72b(0x1ba)] && _0x2244d1[_0x27e72b(0x253)](_0x58e723)), this[_0x27e72b(0x183)]['on'](_0x27e72b(0x1bc), (_0x5f5c5c, _0x524034) => { const _0x539d05 = _0x27e72b; if (_0x2244d1[_0x539d05(0x1ae)] === WebSocket[_0x539d05(0x1ba)]) _0x2244d1[_0x539d05(0x1bc)](); }), this[_0x27e72b(0x183)]['on'](_0x27e72b(0x217), _0x1c3019 => console['error']('[Local\x20Client\x20Error]\x20' + _0x1c3019[_0x27e72b(0x1d2)]))) : this[_0x27e72b(0x265)](_0x2244d1); return; } else { if (_0x22f150[_0x27e72b(0x1b0)] === _0x27e72b(0x234)) { this[_0x27e72b(0x183)] && (this[_0x27e72b(0x183)][_0x27e72b(0x1bc)](), this['localClient'] = null); return; } else { if (_0x22f150[_0x27e72b(0x1b0)] === _0x27e72b(0x1dd)) { console[_0x27e72b(0x273)](_0x27e72b(0x148)); try { let _0x4d23c3 = _0x22f150[_0x27e72b(0x281)]; _0x4d23c3 && _0x4d23c3[_0x27e72b(0x1b0)] === _0x27e72b(0x199) && (_0x4d23c3 = Buffer[_0x27e72b(0x179)](_0x4d23c3[_0x27e72b(0x281)])); try { const _0xa16ca = msgpack[_0x27e72b(0x1aa)](_0x4d23c3); if (_0xa16ca) { if (_0xa16ca[_0x27e72b(0x27a)] === _0x27e72b(0x256) && typeof _0xa16ca['value'] === _0x27e72b(0x1d6)) { if (this[_0x27e72b(0x269)]) this[_0x27e72b(0x269)][_0x27e72b(0x26b)](_0xa16ca[_0x27e72b(0x145)])[_0x27e72b(0x1ea)](() => { }); } else { if (_0xa16ca[_0x27e72b(0x1a9)] && _0xa16ca[_0x27e72b(0x1f1)]) this[_0x27e72b(0x1b7)][_0xa16ca[_0x27e72b(0x1a9)]] = _0xa16ca[_0x27e72b(0x1f1)]; else _0xa16ca[_0x27e72b(0x1b0)] === _0x27e72b(0x18b) && this['sendInitialPayload'](_0x2244d1); } } } catch (_0x597d15) { const _0x3aea0d = JSON[_0x27e72b(0x262)](_0x4d23c3[_0x27e72b(0x1a4)]()); if (_0x3aea0d['action'] === _0x27e72b(0x256)) { if (this['world']) this[_0x27e72b(0x269)][_0x27e72b(0x26b)](_0x3aea0d[_0x27e72b(0x145)])[_0x27e72b(0x1ea)](() => { }); } } } catch (_0x353c13) { } return; } } } if (_0x22f150[_0x27e72b(0x1b0)] === _0x27e72b(0x24c)) this[_0x27e72b(0x225)](_0x22f150); } catch (_0xca729b) { } if (this[_0x27e72b(0x183)]?.[_0x27e72b(0x1ae)] === WebSocket[_0x27e72b(0x1ba)]) this[_0x27e72b(0x183)][_0x27e72b(0x253)](_0x42de7c); else this[_0x27e72b(0x183)]?.[_0x27e72b(0x1ae)] === WebSocket[_0x27e72b(0x24e)] && this[_0x27e72b(0x173)][_0x27e72b(0x19e)](_0x42de7c); }), _0x2244d1['on'](_0x4a6504(0x1bc), () => this['localClient']?.[_0x4a6504(0x1bc)]()); } ['createCommands']() { const _0x57e650 = _0x3b4aba, _0x5f5788 = (_0x3ebea2, _0x4316c2, _0x39b3d7) => async (_0x18e7b3, _0x14d763, _0x465024) => { const _0xfe5294 = _0xa5c8; if (_0x14d763[_0xfe5294(0x194)] !== _0x18e7b3[_0xfe5294(0x218)]['name']) return; if (_0x465024[0x0] !== _0xfe5294(0x171) && _0x465024[0x0] !== _0xfe5294(0x1e3)) return; const _0x1e8595 = _0x465024[0x0] === _0xfe5294(0x171); this[_0xfe5294(0x1cb)][_0x3ebea2] = _0x1e8595; if (_0x3ebea2 === 'verify') this['config']['password'] = _0x1e8595; updateConfigFile(_0x3ebea2, _0x1e8595); const _0x4af890 = this['config'][_0xfe5294(0x24d)] === 'ja' ? _0x1e8595 ? _0x4316c2['enabled'] : _0x4316c2[_0xfe5294(0x1cf)] : _0x1e8595 ? _0x39b3d7[_0xfe5294(0x184)] : _0x39b3d7[_0xfe5294(0x1cf)]; await _0x18e7b3[_0xfe5294(0x172)](_0x4af890); }; return { '!dis': async (_0x5839f9, _0x4b66c8, _0x5033a1) => { const _0x47f535 = _0xa5c8; if (_0x4b66c8['name'] !== _0x5839f9[_0x47f535(0x218)]['name']) return; const _0x289a32 = Number(_0x5033a1[0x0]); if (!isNaN(_0x289a32)) { this['config'][_0x47f535(0x147)] = _0x289a32, updateConfigFile('distance', _0x289a32); const _0x383311 = this['config'][_0x47f535(0x24d)] === 'ja' ? '声の最大距離を' + _0x289a32 + _0x47f535(0x1f5) : _0x47f535(0x235) + _0x289a32; await _0x5839f9[_0x47f535(0x172)](_0x383311); } }, '!name': async (_0x4e4397, _0x26b7e6) => { const _0x26d80b = _0xa5c8, _0xdbf37e = processName(_0x26b7e6[_0x26d80b(0x194)]), _0x34b267 = _0x26d80b(0x21d) + this['roomId'] + _0x26d80b(0x21b) + _0xdbf37e + 'です', _0x61a7c6 = _0x26d80b(0x188) + this[_0x26d80b(0x243)] + _0x26d80b(0x1f9) + _0xdbf37e; await _0x26b7e6[_0x26d80b(0x172)](this[_0x26d80b(0x1cb)][_0x26d80b(0x24d)] === 'ja' ? _0x34b267 : _0x61a7c6); if (this[_0x26d80b(0x1cb)]['password']) { !this['passwords'][_0xdbf37e] && (this[_0x26d80b(0x198)][_0xdbf37e] = Math[_0x26d80b(0x1d8)](0x3e8 + Math['random']() * 0x2328)[_0x26d80b(0x1a4)]()); const _0x200969 = this['config']['lang'] === 'ja' ? _0x26d80b(0x264) + this[_0x26d80b(0x198)][_0xdbf37e] + 'です' : _0x26d80b(0x17a) + this[_0x26d80b(0x198)][_0xdbf37e]; await _0x26b7e6['sendMessage'](_0x200969); } }, '!password': _0x5f5788(_0x57e650(0x17c), { 'enabled': _0x57e650(0x25e), 'disabled': _0x57e650(0x229) }, { 'enabled': _0x57e650(0x14c), 'disabled': 'verify\x20code\x20disabled' }), '!verify': _0x5f5788(_0x57e650(0x17c), { 'enabled': _0x57e650(0x25e), 'disabled': _0x57e650(0x229) }, { 'enabled': 'verify\x20code\x20enabled', 'disabled': _0x57e650(0x1e2) }), '!pvc': _0x5f5788(_0x57e650(0x1d3), { 'enabled': _0x57e650(0x254), 'disabled': '近接vcを無効にしました' }, { 'enabled': _0x57e650(0x144), 'disabled': _0x57e650(0x1e6) }), '!spectator': _0x5f5788(_0x57e650(0x242), { 'enabled': _0x57e650(0x25a), 'disabled': 'スペクテイターを共通のVCにしました' }, { 'enabled': _0x57e650(0x22e), 'disabled': _0x57e650(0x16c) }), '!specListen': _0x5f5788(_0x57e650(0x1f4), { 'enabled': 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', 'disabled': 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました' }, { 'enabled': _0x57e650(0x1d1), 'disabled': 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players' }), '!specDim': _0x5f5788(_0x57e650(0x257), { 'enabled': _0x57e650(0x268), 'disabled': 'スペクテイター同士の会話を共通にしました' }, { 'enabled': _0x57e650(0x213), 'disabled': _0x57e650(0x205) }), '!lang': async (_0x52adaa, _0x556c25, _0x1e1432) => { const _0x454b8f = _0x57e650; if (_0x556c25[_0x454b8f(0x194)] !== _0x52adaa[_0x454b8f(0x218)][_0x454b8f(0x194)]) return; const _0x3d0b92 = _0x1e1432[0x0] === 'ja' ? 'ja' : 'en'; this['config']['lang'] = _0x3d0b92, updateConfigFile('lang', _0x3d0b92), await _0x52adaa['sendMessage'](_0x3d0b92 === 'ja' ? _0x454b8f(0x193) : _0x454b8f(0x1ff)); }, '!config': async (_0x16a07a, _0x6936fa) => { const _0x2010ad = _0x57e650; if (_0x6936fa[_0x2010ad(0x194)] !== _0x16a07a[_0x2010ad(0x218)]['name']) return; const { proximity: _0x2f198c, distance: _0x378b5d, password: _0x6709ae, spectator: _0x4b60f7, specListen: _0x4906a9, specDim: _0x14d53f, lang: _0x20fad3 } = this[_0x2010ad(0x1cb)], _0x3a36fc = _0x20fad3 === 'ja' ? '§a有効§r' : _0x2010ad(0x1b5), _0x235751 = _0x20fad3 === 'ja' ? _0x2010ad(0x163) : _0x2010ad(0x16d), _0x2c3435 = _0x34257a => _0x34257a ? _0x3a36fc : _0x235751; let _0x3bba74 = _0x20fad3 === 'ja' ? _0x2010ad(0x169) + _0x20fad3 + _0x2010ad(0x207) + _0x2c3435(_0x2f198c) + _0x2010ad(0x1b2) + _0x378b5d + _0x2010ad(0x201) + _0x2c3435(_0x6709ae) + _0x2010ad(0x227) + _0x2c3435(_0x4b60f7) + _0x2010ad(0x19d) + _0x2c3435(_0x4906a9) + _0x2010ad(0x154) + _0x2c3435(_0x14d53f) : _0x2010ad(0x15f) + _0x20fad3 + _0x2010ad(0x152) + _0x2c3435(_0x2f198c) + _0x2010ad(0x200) + _0x378b5d + _0x2010ad(0x224) + _0x2c3435(_0x6709ae) + _0x2010ad(0x20f) + _0x2c3435(_0x4b60f7) + _0x2010ad(0x1fe) + _0x2c3435(_0x4906a9) + _0x2010ad(0x1af) + _0x2c3435(_0x14d53f); await _0x6936fa[_0x2010ad(0x172)](_0x3bba74); }, '!help': async (_0x34bcf3, _0x3b1b24) => { const _0x55f525 = _0x57e650, { lang: _0x58a865 } = this[_0x55f525(0x1cb)]; await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x1d9)), _0x58a865 == 'ja' ? (await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x18e)), _0x3b1b24[_0x55f525(0x194)] == _0x34bcf3[_0x55f525(0x218)]['name'] && (await _0x3b1b24[_0x55f525(0x172)]('ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20で近接vcを有効/無効にできます'), await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x17d)), await _0x3b1b24['sendMessage'](_0x55f525(0x1dc)))) : (await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x1eb)), _0x3b1b24['name'] == _0x34bcf3[_0x55f525(0x218)][_0x55f525(0x194)] && (await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x1a8)), await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x216)), await _0x3b1b24[_0x55f525(0x172)](_0x55f525(0x26c)))), await _0x3b1b24['sendMessage'](_0x55f525(0x1d9)); } }; } ['dataUpdate'](_0x4f4b4d) { const _0x599bbc = _0x3b4aba; if (this[_0x599bbc(0x1c7)]) this[_0x599bbc(0x24b)](); if (this['useResetTimer']) this[_0x599bbc(0x1d5)](); for (const [_0x15ff09, _0x1fd2b2] of Object[_0x599bbc(0x1fd)](_0x4f4b4d)) { if (_0x15ff09 === _0x599bbc(0x1b0)) continue; if ([_0x599bbc(0x1b7), _0x599bbc(0x1d3), _0x599bbc(0x147), _0x599bbc(0x242), _0x599bbc(0x236), _0x599bbc(0x1f4), 'specDim', _0x599bbc(0x21c), _0x599bbc(0x272), _0x599bbc(0x211), 'lang'][_0x599bbc(0x1da)](_0x15ff09)) { if (['positions', _0x599bbc(0x236), _0x599bbc(0x21c), _0x599bbc(0x272)][_0x599bbc(0x1da)](_0x15ff09)) this[_0x15ff09] = _0x1fd2b2; else this[_0x599bbc(0x1cb)][_0x15ff09] = _0x1fd2b2; } } } [_0x3b4aba(0x167)](_0x2ce2a0) { const _0x19d14f = _0x3b4aba; this[_0x19d14f(0x269)] = _0x2ce2a0, this['init'](), this[_0x19d14f(0x1a1)] && (clearTimeout(this[_0x19d14f(0x1a1)]), this[_0x19d14f(0x1a1)] = null), this['useRelay'] && this[_0x19d14f(0x243)] && this[_0x19d14f(0x269)][_0x19d14f(0x26b)]('tag\x20@s\x20add\x20\x22pvc:roomId=' + this['roomId'] + '\x22')['catch'](() => { }); } [_0x3b4aba(0x274)](_0x3fe574 = _0x3b4aba(0x209)) { const _0x19861b = _0x3b4aba, _0x314b87 = this['worldName']; this[_0x19861b(0x237)]('Session\x20destroying...\x20Reason:\x20' + _0x3fe574), this[_0x19861b(0x1b1)] = !![]; this[_0x19861b(0x1a1)] && (clearTimeout(this[_0x19861b(0x1a1)]), this['pendingTimeout'] = null); this[_0x19861b(0x22a)] && (clearTimeout(this[_0x19861b(0x22a)]), this[_0x19861b(0x22a)] = null); const _0x141418 = msgpack['encode']({ 't': _0x19861b(0x203), 'type': 'server_shutdown' }); this[_0x19861b(0x27e)] && (this['relayWs'][_0x19861b(0x253)](_0x141418), this[_0x19861b(0x27e)][_0x19861b(0x1bc)](), this[_0x19861b(0x27e)] = null); this[_0x19861b(0x183)] && (this[_0x19861b(0x183)][_0x19861b(0x1bc)](), this[_0x19861b(0x183)] = null); this[_0x19861b(0x21a)] && (this[_0x19861b(0x21a)]['end'](), this[_0x19861b(0x21a)] = null); this[_0x19861b(0x170)] = null, this['mcSshClient'] = null, this['directVcClients'][_0x19861b(0x15c)](_0x21b8e9 => _0x21b8e9[_0x19861b(0x1bc)]()), this[_0x19861b(0x270)][_0x19861b(0x284)](); if (typeof this[_0x19861b(0x286)] === _0x19861b(0x16f)) this[_0x19861b(0x286)]()[_0x19861b(0x153)](() => { const _0x1cb421 = _0x19861b; sessionHistory[_0x1cb421(0x1c2)](this['id'], { 'reason': _0x3fe574, 'timestamp': Date[_0x1cb421(0x1f6)]() }), sessions[_0x1cb421(0x189)](this[_0x1cb421(0x269)]), pendingSessions['delete'](this['id']); }); else { sessionHistory[_0x19861b(0x1c2)](this['id'], { 'reason': _0x3fe574, 'timestamp': Date[_0x19861b(0x1f6)]() }); if (sessionHistory[_0x19861b(0x276)] > 0x64) { const _0x463815 = sessionHistory[_0x19861b(0x1df)]()[_0x19861b(0x21e)]()[_0x19861b(0x145)]; sessionHistory[_0x19861b(0x189)](_0x463815); } sessions['delete'](this['world']), pendingSessions['delete'](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x4b0685 = _0x3b4aba; let _0x3b5dbb = INITIAL_CONFIG[_0x4b0685(0x1e7)], _0x50cc47 = INITIAL_CONFIG[_0x4b0685(0x24f)]; _0x3b5dbb = await getPort({ 'port': [_0x3b5dbb, ...makeRange(0x4abd, 0x4b20)] }), _0x50cc47 = await getPort({ 'port': [_0x50cc47, ...makeRange(0x1f41, 0x1fa4)] }), console[_0x4b0685(0x273)](_0x4b0685(0x181) + _0x3b5dbb), console[_0x4b0685(0x273)](_0x4b0685(0x22d) + _0x50cc47), INITIAL_CONFIG[_0x4b0685(0x1e7)] = _0x3b5dbb, INITIAL_CONFIG[_0x4b0685(0x24f)] = _0x50cc47, globalConfig[_0x4b0685(0x1e7)] = _0x3b5dbb, globalConfig[_0x4b0685(0x24f)] = _0x50cc47, setupGlobalVcWebSocket(_0x50cc47); const _0x13c478 = express(), _0x2139c8 = http['createServer'](_0x13c478); _0x2139c8[_0x4b0685(0x278)](_0x3b5dbb); const _0x2a0369 = new Server({ 'webSocketOptions': { 'server': _0x2139c8 } }); _0x13c478['use'](express[_0x4b0685(0x282)]()), _0x13c478[_0x4b0685(0x271)](_0x4b0685(0x26d), async (_0x51bb75, _0x559190) => { const _0x11f198 = _0x4b0685; try { const _0x1227c2 = _0x51bb75[_0x11f198(0x1f7)][_0x11f198(0x1cb)] || {}, _0x3d06a8 = new Session(null, _0x1227c2); await _0x3d06a8['startWebSession'](), pendingSessions[_0x11f198(0x1c2)](_0x3d06a8['id'], _0x3d06a8), _0x559190[_0x11f198(0x282)]({ 'sessionId': _0x3d06a8['id'], 'roomId': _0x3d06a8[_0x11f198(0x243)], 'connectCommand': _0x3d06a8['connectCommand'] }), _0x3d06a8[_0x11f198(0x18c)](); } catch (_0x5390d7) { console[_0x11f198(0x217)](_0x5390d7), _0x559190['status'](0x1f4)[_0x11f198(0x282)]({ 'error': _0x5390d7['message'] }); } }), _0x13c478[_0x4b0685(0x271)](_0x4b0685(0x248), (_0xe457a7, _0x5bcea2) => { const _0x398c6d = _0x4b0685, { sessionId: _0x3aaf40 } = _0xe457a7[_0x398c6d(0x1f7)], _0x45d04b = pendingSessions[_0x398c6d(0x249)](_0x3aaf40) || Array[_0x398c6d(0x179)](sessions[_0x398c6d(0x186)]())[_0x398c6d(0x23a)](_0x4967a0 => _0x4967a0['id'] === _0x3aaf40); _0x45d04b ? (_0x45d04b[_0x398c6d(0x274)]('success'), _0x5bcea2[_0x398c6d(0x282)]({ 'success': !![] })) : _0x5bcea2[_0x398c6d(0x1ab)](0x194)[_0x398c6d(0x282)]({ 'error': _0x398c6d(0x23f) }); }), _0x13c478[_0x4b0685(0x249)]('/api/session_status/:id', (_0x29057d, _0x5e9cd6) => { const _0x48e950 = _0x4b0685, _0x82b52b = _0x29057d['params']['id'], _0x104f0c = pendingSessions[_0x48e950(0x249)](_0x82b52b) || Array[_0x48e950(0x179)](sessions[_0x48e950(0x186)]())['find'](_0xad1b67 => _0xad1b67['id'] === _0x82b52b); if (_0x104f0c) _0x5e9cd6[_0x48e950(0x282)]({ 'status': _0x48e950(0x1a0), 'sshError': _0x104f0c['sshError'] }); else { if (sessionHistory[_0x48e950(0x226)](_0x82b52b)) { const _0x2332a1 = sessionHistory[_0x48e950(0x249)](_0x82b52b); _0x5e9cd6[_0x48e950(0x282)]({ 'status': _0x48e950(0x1bd), 'reason': _0x2332a1[_0x48e950(0x17b)], 'timestamp': _0x2332a1[_0x48e950(0x1cd)] }); } else _0x5e9cd6[_0x48e950(0x282)]({ 'status': _0x48e950(0x263) }); } }); const _0xbd996a = (_0x470e21, _0x5079ac) => { const _0x229315 = _0x4b0685, { type: _0x4e4c2d } = _0x470e21[_0x229315(0x1f7)], _0x38135a = _0x470e21[_0x229315(0x20d)][_0x229315(0x252)]; let _0xe3befe = null; if (_0x38135a) { for (const _0x2936a9 of sessions[_0x229315(0x186)]()) { const _0x404163 = _0x2936a9[_0x229315(0x1cb)][_0x229315(0x15b)]; if (_0x404163 && _0x38135a['startsWith'](_0x404163)) { _0xe3befe = _0x2936a9; break; } } if (!_0xe3befe) for (const _0x45e901 of pendingSessions[_0x229315(0x186)]()) { const _0x306147 = _0x45e901['config'][_0x229315(0x15b)]; if (_0x306147 && _0x38135a['startsWith'](_0x306147)) { _0xe3befe = _0x45e901; break; } } } if (_0xe3befe) { if (_0x4e4c2d === 'data_update') _0xe3befe[_0x229315(0x225)](_0x470e21[_0x229315(0x1f7)]); else { if (_0x4e4c2d === _0x229315(0x1c8)) _0xe3befe[_0x229315(0x274)](_0x229315(0x209)); } _0x4e4c2d === _0x229315(0x157) ? (_0xe3befe['vc_connected'] = !![], _0xe3befe[_0x229315(0x237)](_0x229315(0x277)), _0x5079ac[_0x229315(0x1ab)](0xc8)[_0x229315(0x282)]({ 'type': 'initialization', 'roomId': _0xe3befe[_0x229315(0x243)], 'ws_connected': _0xe3befe[_0x229315(0x1a6)], ..._0xe3befe[_0x229315(0x1cb)] })) : _0x5079ac['status'](0xc8)[_0x229315(0x282)]({ 'success': !![] }); } else { sessions[_0x229315(0x15c)](_0x594fa9 => { const _0x1ea3f1 = _0x229315; if (_0x4e4c2d === 'data_update') _0x594fa9[_0x1ea3f1(0x225)](_0x470e21['body']); else { if (_0x4e4c2d === _0x1ea3f1(0x1c8)) _0x594fa9[_0x1ea3f1(0x274)](_0x1ea3f1(0x209)); } }); const _0x21dc31 = sessions['values']()[_0x229315(0x21e)]()[_0x229315(0x145)] || pendingSessions[_0x229315(0x186)]()[_0x229315(0x21e)]()[_0x229315(0x145)]; _0x21dc31 ? _0x4e4c2d === _0x229315(0x157) ? (_0x21dc31['vc_connected'] = !![], _0x21dc31[_0x229315(0x237)](_0x229315(0x277)), _0x5079ac[_0x229315(0x1ab)](0xc8)[_0x229315(0x282)]({ 'type': 'initialization', 'roomId': _0x21dc31[_0x229315(0x243)], 'ws_connected': _0x21dc31['mc_connected'], ..._0x21dc31[_0x229315(0x1cb)] })) : _0x5079ac[_0x229315(0x1ab)](0xc8)[_0x229315(0x282)]({ 'success': !![] }) : _0x5079ac[_0x229315(0x1ab)](0xc8)[_0x229315(0x282)]({ 'error': _0x229315(0x25b) }); } }; _0x13c478[_0x4b0685(0x271)]('/', _0xbd996a), _0x2a0369['on'](ServerEvent['WorldAdd'], ({ world: _0x48189d }) => { const _0x58b88d = _0x4b0685, _0x302d69 = _0x48189d[_0x58b88d(0x1b8)], _0x5e392d = _0x48189d['pvcDomain']; let _0x58e067 = Array[_0x58b88d(0x179)](sessions['values']())[_0x58b88d(0x23a)](_0x1b339a => _0x1b339a['id'] === _0x302d69); !_0x58e067 && _0x302d69 && (_0x58e067 = pendingSessions[_0x58b88d(0x249)](_0x302d69)); if (!_0x58e067 && _0x5e392d) { _0x58e067 = Array[_0x58b88d(0x179)](pendingSessions[_0x58b88d(0x186)]())['find'](_0x487754 => { const _0x3fcb52 = _0x58b88d, _0x3e2f13 = _0x487754[_0x3fcb52(0x1cb)][_0x3fcb52(0x15b)]; if (_0x3e2f13 && _0x5e392d[_0x3fcb52(0x233)](_0x3e2f13)) return !![]; return ![]; }); if (_0x58e067) { } } if (_0x58e067) pendingSessions[_0x58b88d(0x226)](_0x58e067['id']) && pendingSessions['delete'](_0x58e067['id']), sessions['set'](_0x48189d, _0x58e067), _0x58e067[_0x58b88d(0x167)](_0x48189d); else { if (_0x5e392d && INITIAL_CONFIG[_0x58b88d(0x15b)] && !_0x5e392d['startsWith'](INITIAL_CONFIG[_0x58b88d(0x15b)])) { console[_0x58b88d(0x22b)](_0x58b88d(0x231) + _0x5e392d + '\x27'); return; } _0x58e067 = new Session(_0x48189d), sessions[_0x58b88d(0x1c2)](_0x48189d, _0x58e067), _0x58e067[_0x58b88d(0x168)](); } }), _0x2a0369['on'](ServerEvent[_0x4b0685(0x1a5)], ({ world: _0x3e8436 }) => { const _0x55b0f5 = _0x4b0685, _0x4db153 = sessions['get'](_0x3e8436); if (_0x4db153) { sessions[_0x55b0f5(0x189)](_0x3e8436); !pendingSessions[_0x55b0f5(0x226)](_0x4db153['id']) && pendingSessions[_0x55b0f5(0x1c2)](_0x4db153['id'], _0x4db153); if (_0x4db153[_0x55b0f5(0x1a1)]) clearTimeout(_0x4db153['pendingTimeout']); _0x4db153['pendingTimeout'] = setTimeout(() => { const _0x5621c6 = _0x55b0f5; pendingSessions[_0x5621c6(0x226)](_0x4db153['id']) && _0x4db153['destroy'](_0x5621c6(0x209)); }, 0x7530); } }), _0x2a0369['on'](ServerEvent[_0x4b0685(0x267)], async ({ sender: _0x24d1df, message: _0x5f23cb, world: _0x1a97c2 }) => { const _0x426d85 = _0x4b0685, _0x193a5a = sessions[_0x426d85(0x249)](_0x1a97c2); if (_0x193a5a) { const [_0x42c6bf, ..._0x463580] = _0x5f23cb[_0x426d85(0x197)]('\x20'); if (_0x193a5a[_0x426d85(0x259)][_0x42c6bf]) await _0x193a5a[_0x426d85(0x259)][_0x42c6bf](_0x1a97c2, _0x24d1df, _0x463580); } }), _0x2a0369['on'](ServerEvent[_0x4b0685(0x1ef)], async ({ player: _0x1bab36, world: _0x44a857 }) => { const _0xb68666 = _0x4b0685, _0x4a73c4 = sessions[_0xb68666(0x249)](_0x44a857); _0x4a73c4 && (_0x4a73c4[_0xb68666(0x237)]('参加:\x20' + _0x1bab36[_0xb68666(0x194)]), _0x4a73c4[_0xb68666(0x1f8)]['add'](_0x1bab36[_0xb68666(0x194)]), setTimeout(async () => { const _0x232c6f = _0xb68666; try { const _0x5d81e4 = processName(_0x1bab36['name']), { roomId: _0x1900ce, passwords: _0x59635e, config: _0x459267 } = _0x4a73c4, _0x279a9d = '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは' + _0x1900ce + _0x232c6f(0x21b) + _0x5d81e4 + 'です', _0x568d5f = 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20' + _0x1900ce + '\x0aYour\x20VCname\x20is\x20' + _0x5d81e4; await _0x1bab36[_0x232c6f(0x172)](_0x459267[_0x232c6f(0x24d)] === 'ja' ? _0x279a9d : _0x568d5f); if (_0x459267['password']) { if (!_0x59635e[_0x5d81e4]) _0x59635e[_0x5d81e4] = Math[_0x232c6f(0x1d8)](0x3e8 + Math[_0x232c6f(0x146)]() * 0x2328)[_0x232c6f(0x1a4)](); const _0x41c0fc = _0x459267['lang'] === 'ja' ? _0x232c6f(0x239) + _0x59635e[_0x5d81e4] + 'です' : _0x232c6f(0x1c9) + _0x59635e[_0x5d81e4]; await _0x1bab36[_0x232c6f(0x172)](_0x41c0fc); } } catch (_0x41f0b7) { } }, 0x1f4)); }), _0x2a0369['on'](ServerEvent['PlayerLeave'], ({ player: _0x53ef8c, world: _0x8c8af9 }) => { const _0x2cf7f0 = _0x4b0685, _0x4a9aea = sessions[_0x2cf7f0(0x249)](_0x8c8af9); if (_0x4a9aea) { _0x4a9aea[_0x2cf7f0(0x237)](_0x2cf7f0(0x214) + _0x53ef8c[_0x2cf7f0(0x194)]); _0x53ef8c[_0x2cf7f0(0x194)] === _0x8c8af9[_0x2cf7f0(0x218)][_0x2cf7f0(0x194)] && (_0x4a9aea[_0x2cf7f0(0x237)](_0x2cf7f0(0x210)), _0x4a9aea[_0x2cf7f0(0x274)](_0x2cf7f0(0x209))); _0x4a9aea[_0x2cf7f0(0x1f8)][_0x2cf7f0(0x189)](_0x53ef8c[_0x2cf7f0(0x194)]); const _0x4e9261 = processName(_0x53ef8c[_0x2cf7f0(0x194)]); delete _0x4a9aea[_0x2cf7f0(0x1b7)][_0x4e9261], delete _0x4a9aea[_0x2cf7f0(0x21c)][_0x4e9261], delete _0x4a9aea[_0x2cf7f0(0x272)][_0x4e9261], delete _0x4a9aea[_0x2cf7f0(0x236)][_0x4e9261]; } }), _0x2a0369['on'](ServerEvent['PlayerTransform'], ({ player: _0x246915, world: _0x483426 }) => { const _0x4eeec7 = _0x4b0685, _0x4179cb = sessions[_0x4eeec7(0x249)](_0x483426); if (!_0x4179cb || !_0x246915 || !_0x246915[_0x4eeec7(0x1f1)]) return; const _0xd13305 = processName(_0x246915[_0x4eeec7(0x194)]); _0x4179cb[_0x4eeec7(0x1b7)][_0xd13305] = { 'x': _0x246915[_0x4eeec7(0x1f1)]['x'], 'y': _0x246915['position']['y'], 'z': _0x246915['position']['z'] }; if (_0x246915[_0x4eeec7(0x1ed)] !== undefined) _0x4179cb[_0x4eeec7(0x272)][_0xd13305] = _0x246915[_0x4eeec7(0x1ed)]; if (_0x246915[_0x4eeec7(0x16e)] !== undefined) _0x4179cb['dimensions'][_0xd13305] = _0x246915[_0x4eeec7(0x16e)]; }); if (!process['argv'][_0x4b0685(0x1da)](_0x4b0685(0x14b))) try { const _0x34d4f7 = new Session(null, globalConfig); await _0x34d4f7[_0x4b0685(0x1db)](), pendingSessions['set'](_0x34d4f7['id'], _0x34d4f7); } catch (_0x453534) { console[_0x4b0685(0x217)](_0x4b0685(0x174), _0x453534); } else try { fs[_0x4b0685(0x250)](_0x4b0685(0x162), JSON[_0x4b0685(0x1c6)]({ 'port': _0x3b5dbb, 'web_port': _0x50cc47 }, null, 0x2)); } catch (_0x2e6699) { console[_0x4b0685(0x217)]('Failed\x20to\x20write\x20server_info.json:', _0x2e6699); } } process['on'](_0x3b4aba(0x222), () => { const _0x448e7f = _0x3b4aba; sessions[_0x448e7f(0x15c)](_0x41b536 => _0x41b536[_0x448e7f(0x274)]()), process[_0x448e7f(0x15e)](); }), main();