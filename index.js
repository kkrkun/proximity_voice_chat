const _0x4b563d = _0x1fda; (function (_0x25affe, _0x77634f) { const _0x5169c6 = _0x1fda, _0x3fc9db = _0x25affe(); while (!![]) { try { const _0x37ddad = -parseInt(_0x5169c6(0xe4)) / 0x1 * (-parseInt(_0x5169c6(0x1d4)) / 0x2) + -parseInt(_0x5169c6(0x224)) / 0x3 * (parseInt(_0x5169c6(0x218)) / 0x4) + parseInt(_0x5169c6(0x1f7)) / 0x5 + parseInt(_0x5169c6(0x227)) / 0x6 + -parseInt(_0x5169c6(0x1e9)) / 0x7 + parseInt(_0x5169c6(0x11e)) / 0x8 * (-parseInt(_0x5169c6(0x143)) / 0x9) + parseInt(_0x5169c6(0x183)) / 0xa; if (_0x37ddad === _0x77634f) break; else _0x3fc9db['push'](_0x3fc9db['shift']()); } catch (_0x1a451b) { _0x3fc9db['push'](_0x3fc9db['shift']()); } } }(_0x1b30, 0xf3020)); const { Server, ServerEvent, Player } = require(_0x4b563d(0x170)), WebSocket = require('ws'), fetch = require(_0x4b563d(0x15e)), wanakana = require(_0x4b563d(0x17c)), fs = require('fs'), fsPromises = require('fs')[_0x4b563d(0x140)], JSON5 = require(_0x4b563d(0x1b4)), getPort = require(_0x4b563d(0x20d)), express = require('express'), http = require(_0x4b563d(0x1c7)), zlib = require(_0x4b563d(0x16d)), msgpack = require(_0x4b563d(0x147)), { randomUUID } = require(_0x4b563d(0x13d)); let sshHandler = null; try { fs[_0x4b563d(0x205)](_0x4b563d(0x1f4)) && (sshHandler = require(_0x4b563d(0x1f4))); } catch (_0x4c9649) { } const RELAY_SERVER_DOMAIN = _0x4b563d(0xf2), TIMEOUT_THRESHOLD = 0x3, INACTIVITY_TIMEOUT = 0x5 * 0x3c * 0x3e8, MAX_RUNTIME = 0x4 * 0x3c * 0x3c * 0x3e8, configCandidates = [_0x4b563d(0x1a2), _0x4b563d(0x111), _0x4b563d(0x176)]; let globalConfig = {}, configLoaded = ![], configPath = ''; for (const filePath of configCandidates) { if (fs[_0x4b563d(0x205)](filePath)) try { const fileContent = fs['readFileSync'](filePath, _0x4b563d(0x1f6)); globalConfig = JSON5[_0x4b563d(0x1ca)](fileContent), configLoaded = !![], configPath = filePath; break; } catch (_0x2be0f4) { console[_0x4b563d(0x222)]('[Config]\x20Error\x20parsing\x20' + filePath + ':', _0x2be0f4[_0x4b563d(0x1fd)]); } } !configLoaded && console[_0x4b563d(0xe1)](_0x4b563d(0x166)); const DEFAULT_CONFIG = { 'app_id': '', 'secret_key': '', 'username': '', 'sub_domain': '', 'ssh_password': '', 'port': 0x4abc, 'web_port': 0x1f40, 'proximity': !![], 'spectator': !![], 'specListen': !![], 'specDim': ![], 'password': ![], 'verify': undefined, 'output': !![], 'distance': 0xa, 'lang': 'en' }, INITIAL_CONFIG = { ...DEFAULT_CONFIG, ...globalConfig }; INITIAL_CONFIG[_0x4b563d(0x19f)] = INITIAL_CONFIG[_0x4b563d(0x1c9)] ?? INITIAL_CONFIG[_0x4b563d(0x19f)]; async function updateConfigFile(_0xbfd7e4, _0x10482d) { const _0x452a9f = _0x4b563d; if (!configPath) return; try { let _0x19c323 = await fsPromises[_0x452a9f(0x1cb)](configPath, _0x452a9f(0x1f6)); const _0x4d8174 = new RegExp('(\x22' + _0xbfd7e4 + _0x452a9f(0x11b)), _0x36892a = typeof _0x10482d === _0x452a9f(0x151) ? '\x22' + _0x10482d + '\x22' : _0x10482d, _0x87e0c = _0x19c323[_0x452a9f(0x1dd)](_0x4d8174, '$1' + _0x36892a); _0x87e0c !== _0x19c323 && await fsPromises[_0x452a9f(0x132)](configPath, _0x87e0c, _0x452a9f(0x1f6)); } catch (_0x226185) { console[_0x452a9f(0x222)](_0x452a9f(0x169), _0x226185); } }; const makeRange = (_0x1438db, _0xcc8726) => Array[_0x4b563d(0x16a)]({ 'length': _0xcc8726 - _0x1438db + 0x1 }, (_0x4971e7, _0x53e683) => _0x1438db + _0x53e683); let globalGatewayServer = null; async function startTcpexposer(_0x5ee139, _0x535377, _0x5a232f) { const _0x1d7ae7 = _0x4b563d; return sshHandler && typeof sshHandler['startTcpexposer'] === 'function' ? await sshHandler[_0x1d7ae7(0x12a)](_0x5ee139, _0x535377, _0x5a232f) : (_0x5ee139[_0x1d7ae7(0x16e)]('[TCPExposer]\x20TCPExposerハンドラーが見つからないため、接続をスキップします。リレーサーバーを使用します。'), _0x5ee139[_0x1d7ae7(0x1ac)] = '', _0x5ee139[_0x1d7ae7(0x21b)]('mc'), null); } function setupGlobalVcWebSocket(_0x3db11d) { const _0x56b35c = _0x4b563d; if (globalGatewayServer) return; const _0x777a8e = express(), _0x2f807c = http['createServer'](_0x777a8e), _0x7606b6 = new WebSocket[(_0x56b35c(0x153))]({ 'noServer': !![] }); _0x777a8e[_0x56b35c(0x168)](express['json']()), _0x777a8e[_0x56b35c(0x186)]('/', (_0x29f1fc, _0x32a544) => { const _0x506e80 = _0x56b35c, { type: _0x5b59af } = _0x29f1fc[_0x506e80(0x1f2)], _0x3a5faa = _0x29f1fc[_0x506e80(0x1ff)][_0x506e80(0x214)]; let _0x3e4390 = null; if (_0x3a5faa) { for (const _0x1f78e2 of sessions[_0x506e80(0x156)]()) { const _0x5a7209 = _0x1f78e2[_0x506e80(0x1e8)]['sub_domain']; if (_0x5a7209 && _0x3a5faa[_0x506e80(0x14d)](_0x5a7209)) { _0x3e4390 = _0x1f78e2; break; } } if (!_0x3e4390) for (const _0x3152af of pendingSessions[_0x506e80(0x156)]()) { const _0x2fe1aa = _0x3152af[_0x506e80(0x1e8)][_0x506e80(0x1f0)]; if (_0x2fe1aa && _0x3a5faa[_0x506e80(0x14d)](_0x2fe1aa)) { _0x3e4390 = _0x3152af; break; } } } if (_0x3e4390) { if (_0x5b59af === _0x506e80(0x165)) _0x3e4390[_0x506e80(0x119)](_0x29f1fc[_0x506e80(0x1f2)]); else { if (_0x5b59af === _0x506e80(0x1ef)) _0x3e4390[_0x506e80(0x185)](_0x506e80(0x13a)); } _0x5b59af === _0x506e80(0x135) ? (_0x3e4390[_0x506e80(0x1ab)] = !![], _0x3e4390[_0x506e80(0x16e)](_0x506e80(0xec)), _0x32a544[_0x506e80(0xf5)](0xc8)[_0x506e80(0x13b)]({ 'type': 'initialization', 'roomId': _0x3e4390[_0x506e80(0x1ac)], 'ws_connected': _0x3e4390[_0x506e80(0x12d)], ..._0x3e4390['config'] })) : _0x32a544[_0x506e80(0xf5)](0xc8)['json']({ 'success': !![] }); } else _0x32a544[_0x506e80(0xf5)](0x194)['json']({ 'error': _0x506e80(0x210) }); }), _0x777a8e[_0x56b35c(0x1c4)]('/', (_0xa9b8bc, _0xa8e7ad) => { const _0x474963 = _0x56b35c; _0xa8e7ad['send'](_0x474963(0x1d1)); }), _0x2f807c['on'](_0x56b35c(0x126), (_0x464ce1, _0x3106e4, _0x52df0a) => { const _0x3f6cb0 = _0x56b35c; let _0x6a23bc = null, _0x143277 = null; try { const _0x14b5c0 = _0x464ce1['headers'][_0x3f6cb0(0x214)] || _0x3f6cb0(0x198); let _0x35b1e7 = _0x464ce1[_0x3f6cb0(0x10f)] || '/'; if (_0x35b1e7 === '//') _0x35b1e7 = '/'; _0x143277 = new URL(_0x35b1e7, _0x3f6cb0(0xe2) + _0x14b5c0), _0x6a23bc = _0x143277[_0x3f6cb0(0x14e)][_0x3f6cb0(0x1c4)](_0x3f6cb0(0x100)); } catch (_0xdbf7e4) { _0x6a23bc = null; } _0x6a23bc !== 'vc' ? sshHandler && typeof sshHandler['handleTcpUpgrade'] === _0x3f6cb0(0x15d) ? sshHandler[_0x3f6cb0(0x144)](_0x464ce1, _0x3106e4, _0x52df0a, INITIAL_CONFIG[_0x3f6cb0(0x15f)]) : _0x3106e4[_0x3f6cb0(0x185)]() : _0x7606b6[_0x3f6cb0(0x225)](_0x464ce1, _0x3106e4, _0x52df0a, _0x3bd6c0 => { const _0x3e30e1 = _0x3f6cb0, _0x684ebf = _0x464ce1[_0x3e30e1(0x1ff)][_0x3e30e1(0x214)]; let _0x5893f5 = null; if (_0x684ebf) { for (const _0x47d2fa of sessions[_0x3e30e1(0x156)]()) { const _0x4478ba = _0x47d2fa[_0x3e30e1(0x1e8)][_0x3e30e1(0x1f0)]; if (_0x4478ba && _0x684ebf[_0x3e30e1(0x14d)](_0x4478ba)) { _0x5893f5 = _0x47d2fa; break; } } if (!_0x5893f5) for (const _0x42587a of pendingSessions[_0x3e30e1(0x156)]()) { const _0x1ec873 = _0x42587a['config'][_0x3e30e1(0x1f0)]; if (_0x1ec873 && _0x684ebf[_0x3e30e1(0x14d)](_0x1ec873)) { _0x5893f5 = _0x42587a; break; } } } if (_0x5893f5) _0x5893f5[_0x3e30e1(0x1cf)](_0x3bd6c0); else { const _0x4cd5a5 = sessions[_0x3e30e1(0x156)]()['next']()[_0x3e30e1(0x123)] || pendingSessions['values']()[_0x3e30e1(0x130)]()[_0x3e30e1(0x123)]; if (_0x4cd5a5) _0x4cd5a5[_0x3e30e1(0x1cf)](_0x3bd6c0); else _0x3bd6c0[_0x3e30e1(0x10c)](); } }); }), _0x2f807c[_0x56b35c(0x102)](_0x3db11d, () => { }), globalGatewayServer = _0x2f807c; }; class Session { constructor(_0x3077a6, _0x4eafd5 = {}) { const _0x4222b5 = _0x4b563d; this['id'] = randomUUID(), this['world'] = _0x3077a6, this[_0x4222b5(0xe6)] = _0x3077a6 ? _0x3077a6[_0x4222b5(0x220)] || 'Unknown\x20World' : _0x4222b5(0x1b5), this[_0x4222b5(0x1a0)] = new Map(), this['config'] = { ...INITIAL_CONFIG, ..._0x4eafd5 }, this['roomId'] = this[_0x4222b5(0x1e8)]['sub_domain'], this['connectCommand'] = '', this[_0x4222b5(0x177)] = {}, this[_0x4222b5(0x1d3)] = {}, this[_0x4222b5(0x1da)] = {}, this[_0x4222b5(0x120)] = {}, this['spectators'] = {}, this[_0x4222b5(0x19a)] = new Set(), this['shouldBroadcast'] = !![], this[_0x4222b5(0x1ab)] = ![], this[_0x4222b5(0x12d)] = ![], this[_0x4222b5(0x18d)] = ![], this[_0x4222b5(0x12b)] = ![], this[_0x4222b5(0x21f)] = ![], this[_0x4222b5(0x226)] = null, this[_0x4222b5(0x1aa)] = null, this[_0x4222b5(0x1a9)] = new Set(), this[_0x4222b5(0x19d)] = null, this[_0x4222b5(0x1a6)] = null, this['inactivityTimer'] = null, this[_0x4222b5(0x184)] = 0x0, this['pendingTimeout'] = null, this['commands'] = this[_0x4222b5(0x1ea)](); } [_0x4b563d(0x16e)](_0x46039a) { console['log']('\x1b[36m[Info][' + this['id']['substring'](0x0, 0x6) + ']\x1b[0m\x20' + _0x46039a); } [_0x4b563d(0x108)](_0x3a617e) { const _0x51987f = _0x4b563d; console[_0x51987f(0x172)](_0x51987f(0x181) + this['id'][_0x51987f(0xeb)](0x0, 0x6) + ']\x1b[0m\x20' + _0x3a617e); } ['processName'](_0x14608d) { const _0x25e885 = _0x4b563d; if (!this[_0x25e885(0x1a0)][_0x25e885(0x208)](_0x14608d)) { const _0x2b97fc = wanakana[_0x25e885(0x1c1)](_0x14608d[_0x25e885(0x1dd)](/ /g, '_'))[_0x25e885(0x1dd)](/n'/g, 'n'); this[_0x25e885(0x1a0)]['set'](_0x14608d, _0x2b97fc); } return this[_0x25e885(0x1a0)][_0x25e885(0x1c4)](_0x14608d); } [_0x4b563d(0x1cf)](_0x434822) { const _0x324d6f = _0x4b563d; this[_0x324d6f(0x1a9)][_0x324d6f(0x17b)](_0x434822), this[_0x324d6f(0x1ab)] = !![], this[_0x324d6f(0x11d)](_0x434822), _0x434822['on'](_0x324d6f(0x1fd), async _0x1c9a7c => { const _0x2b8a2d = _0x324d6f; try { let _0x19e403; try { _0x19e403 = msgpack[_0x2b8a2d(0x15a)](_0x1c9a7c); } catch (_0x362d3b) { try { _0x19e403 = JSON[_0x2b8a2d(0x1ca)](_0x1c9a7c); } catch (_0x2a96ea) { } } if (_0x19e403) { if (_0x19e403['userName'] && _0x19e403[_0x2b8a2d(0xfa)]) this[_0x2b8a2d(0x1d3)][_0x19e403[_0x2b8a2d(0x192)]] = _0x19e403['position']; if (_0x19e403['action'] === _0x2b8a2d(0x164) && typeof _0x19e403['value'] === _0x2b8a2d(0x151)) { if (this[_0x2b8a2d(0x1c5)]) { const _0x183f94 = await this['world']['runCommand'](_0x19e403['value']); _0x434822['send'](JSON['stringify']({ 'type': _0x2b8a2d(0x136), 'payload': _0x183f94 })); } } } } catch (_0x3c3643) { } }), _0x434822['on'](_0x324d6f(0x10c), () => { const _0x257663 = _0x324d6f; this[_0x257663(0x1a9)][_0x257663(0x1e5)](_0x434822); }); } async[_0x4b563d(0x203)]() { const _0x450dbc = _0x4b563d, { sub_domain: _0x1940a9, username: _0x44e2f1, ssh_password: _0x10ca34 } = this['config']; if (_0x44e2f1 && _0x10ca34 && _0x1940a9) this[_0x450dbc(0x19d)] = await startTcpexposer(this, _0x1940a9, INITIAL_CONFIG[_0x450dbc(0x189)]); else await this[_0x450dbc(0x21b)]('mc'); } [_0x4b563d(0x1de)](_0x4bfe92) { const _0x3c553a = _0x4b563d; this[_0x3c553a(0x221)] && (clearTimeout(this[_0x3c553a(0x221)]), this[_0x3c553a(0x221)] = null), this[_0x3c553a(0x1c5)] = _0x4bfe92, this[_0x3c553a(0xe6)] = _0x4bfe92[_0x3c553a(0x220)] || 'Unknown\x20World', this['init'](); } async[_0x4b563d(0x1ee)]() { const _0x6024a7 = _0x4b563d; if (!this[_0x6024a7(0x1c5)] && !this[_0x6024a7(0x221)]) return; if (!this[_0x6024a7(0x12b)] && !this[_0x6024a7(0x19d)]) { const { sub_domain: _0x159b9e, username: _0x460a7e, ssh_password: _0x54ff7d } = this[_0x6024a7(0x1e8)]; if (_0x460a7e && _0x54ff7d && _0x159b9e) { this[_0x6024a7(0x19d)] = await startTcpexposer(this, _0x159b9e, INITIAL_CONFIG['web_port']); if (!this[_0x6024a7(0x19d)]) { if (!this[_0x6024a7(0x12b)]) await this['connectToRelayServer']('mc'); } } else { if (!_0x159b9e) await this[_0x6024a7(0x21b)]('mc'); } } this[_0x6024a7(0x12d)] = !![], this['stop_roop'] = ![], this[_0x6024a7(0x16e)](_0x6024a7(0xec)); if (this['world']) { try { await this[_0x6024a7(0x127)](), this['world'][_0x6024a7(0x20f)](_0x6024a7(0x146) + this['roomId'] + '\x22'), this[_0x6024a7(0x193)](); } catch (_0x351830) { } this[_0x6024a7(0x212)](); } } async['cleanOldTags']() { const _0x37651f = _0x4b563d; if (!this[_0x37651f(0x1c5)]) return; try { const _0xa57468 = await this[_0x37651f(0x1bf)](); for (const _0x455c96 of _0xa57468) { await this[_0x37651f(0x1c5)]['runCommand'](_0x37651f(0x1e1) + _0x455c96 + '\x22]\x20remove\x20\x22' + _0x455c96 + '\x22'); } const _0x157843 = await this[_0x37651f(0x1c5)][_0x37651f(0x20f)](_0x37651f(0x158)); this['onlinePlayers'][_0x37651f(0x16c)](); if (_0x157843[_0x37651f(0x1f5)]) _0x157843[_0x37651f(0x1f5)]['forEach'](_0x268cde => this[_0x37651f(0x19a)][_0x37651f(0x17b)](_0x268cde)); } catch (_0x5b38f4) { } } [_0x4b563d(0x193)]() { const _0xe6f2ac = _0x4b563d; if (!this[_0xe6f2ac(0x1c5)]) return; const { proximity: _0x31861f, distance: _0x5c8b76, lang: _0x96ff75 } = this['config']; if (_0x96ff75 == 'ja') { let _0x195420 = _0x31861f ? '有効' : '無効'; this[_0xe6f2ac(0x1c5)]['sendMessage']('接続を開始しました\x0a近接vc：' + _0x195420 + _0xe6f2ac(0x188) + _0x5c8b76 + _0xe6f2ac(0x18e))[_0xe6f2ac(0x1e7)](_0x339de3 => { }); } else { let _0x629f78 = _0x31861f ? 'enabled' : _0xe6f2ac(0x215); this[_0xe6f2ac(0x1c5)]['sendMessage'](_0xe6f2ac(0x125) + _0x629f78 + _0xe6f2ac(0xf8) + _0x5c8b76 + '\x0a!help\x20for\x20command\x20list')[_0xe6f2ac(0x1e7)](_0x3e4194 => { }); } } [_0x4b563d(0x204)]() { const _0x4a13b0 = _0x4b563d; this['useResetTimer'] = !![], clearTimeout(this[_0x4a13b0(0x1b1)]), this[_0x4a13b0(0x1b1)] = setTimeout(() => { const _0x479234 = _0x4a13b0; this[_0x479234(0x185)]('timeout'); }, INACTIVITY_TIMEOUT); } ['startTimer']() { const _0xf31871 = _0x4b563d; if (this[_0xf31871(0xf1)]) return; this[_0xf31871(0xf1)] = setTimeout(() => { const _0x3d6dea = _0xf31871; if (this[_0x3d6dea(0x1c5)]) this[_0x3d6dea(0x1c5)][_0x3d6dea(0xf6)](this[_0x3d6dea(0x1e8)][_0x3d6dea(0x217)] === 'ja' ? _0x3d6dea(0x20a) : _0x3d6dea(0x1ae))[_0x3d6dea(0x1e7)](() => { }); console[_0x3d6dea(0x172)](_0x3d6dea(0x16f)), console['log'](_0x3d6dea(0x1db) + this[_0x3d6dea(0xe6)] + _0x3d6dea(0x211)), console['log'](_0x3d6dea(0xe9)), setTimeout(() => this[_0x3d6dea(0x185)](_0x3d6dea(0x174)), 0x1388); }, MAX_RUNTIME), this[_0xf31871(0x204)](); } async['loop']() { const _0x5d6fed = _0x4b563d; if (this[_0x5d6fed(0x18d)] || !this[_0x5d6fed(0x1c5)]) return; try { if (this[_0x5d6fed(0x21f)]) this[_0x5d6fed(0x204)](); let _0x5d252e = { 'playersNames': [], 'aliveSet': new Set(), 'spectatorSet': new Set(), 'details': [] }, _0x30ec34 = { 'statusCode': -0x1 }; if (this[_0x5d6fed(0x1e8)][_0x5d6fed(0x13f)]) { const [_0x1f48a7, _0x4c1906, _0x5c781a, _0x49fa72, _0x260789] = await Promise['all']([this[_0x5d6fed(0x1c5)]['runCommand'](_0x5d6fed(0x206)), this[_0x5d6fed(0x1c5)][_0x5d6fed(0x20f)](_0x5d6fed(0x154)), this['world']['runCommand'](_0x5d6fed(0x103)), this[_0x5d6fed(0x1c5)][_0x5d6fed(0x20f)]('querytarget\x20@e[type=player]'), this[_0x5d6fed(0x1c5)][_0x5d6fed(0x20f)](_0x5d6fed(0x121))]); _0x30ec34 = _0x260789; if (_0x1f48a7[_0x5d6fed(0x122)] <= -0x1) { this['consecutiveTimeouts']++; if (this['consecutiveTimeouts'] >= TIMEOUT_THRESHOLD) { this[_0x5d6fed(0x185)](_0x5d6fed(0x13a)); return; } } else this[_0x5d6fed(0x184)] = 0x0; _0x1f48a7[_0x5d6fed(0x122)] === 0x0 && typeof _0x1f48a7[_0x5d6fed(0x21c)] === _0x5d6fed(0x151) && (_0x5d252e['playersNames'] = _0x1f48a7[_0x5d6fed(0x21c)][_0x5d6fed(0x104)](',')['map'](_0xd5bc91 => _0xd5bc91[_0x5d6fed(0x209)]())[_0x5d6fed(0x1a1)](_0x303c08 => _0x303c08[_0x5d6fed(0xf3)] > 0x0)); if (_0x4c1906[_0x5d6fed(0x1f5)]) _0x4c1906[_0x5d6fed(0x1f5)][_0x5d6fed(0x150)](_0x31cd99 => _0x5d252e[_0x5d6fed(0x1b0)]['add'](_0x31cd99)); if (_0x5c781a[_0x5d6fed(0x1f5)]) _0x5c781a[_0x5d6fed(0x1f5)]['forEach'](_0x11fb94 => _0x5d252e[_0x5d6fed(0x145)][_0x5d6fed(0x17b)](_0x11fb94)); try { _0x5d252e[_0x5d6fed(0x1b7)] = JSON[_0x5d6fed(0x1ca)](_0x49fa72[_0x5d6fed(0x1b7)] || '[]'); } catch (_0x2eebe8) { _0x5d252e[_0x5d6fed(0x1b7)] = []; } } else { const [_0xcd9e4a, _0x52d21b] = await Promise['all']([this[_0x5d6fed(0x1c5)][_0x5d6fed(0x20f)](_0x5d6fed(0x206)), this['world'][_0x5d6fed(0x20f)](_0x5d6fed(0x121))]); _0x30ec34 = _0x52d21b; if (_0xcd9e4a[_0x5d6fed(0x122)] <= -0x1) { this[_0x5d6fed(0x184)]++; if (this[_0x5d6fed(0x184)] >= TIMEOUT_THRESHOLD) { this[_0x5d6fed(0x185)](_0x5d6fed(0x13a)); return; } } else this[_0x5d6fed(0x184)] = 0x0; } const _0x549678 = Array[_0x5d6fed(0x16a)](_0x5d252e[_0x5d6fed(0x1b0)]); _0x5d252e['playersNames'][_0x5d6fed(0x150)](_0xf8b3 => { const _0x12ba86 = _0x5d6fed, _0x2e1001 = this['processName'](_0xf8b3), _0x2a879f = _0x5d252e[_0x12ba86(0x145)][_0x12ba86(0x208)](_0xf8b3); this[_0x12ba86(0x190)][_0x2e1001] = _0x2a879f; if (!this[_0x12ba86(0x1e8)][_0x12ba86(0x13f)]) this[_0x12ba86(0x1d3)][_0x2e1001] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; else { if (!_0x5d252e[_0x12ba86(0x1b0)][_0x12ba86(0x208)](_0xf8b3)) this[_0x12ba86(0x1d3)][_0x2e1001] = { 'x': 0x0, 'y': 0x4e20, 'z': 0x0 }; else { if (this[_0x12ba86(0x1e8)][_0x12ba86(0x10e)] && _0x2a879f) { if (this['config'][_0x12ba86(0x19e)] === !![]) { const _0x266f40 = _0x549678[_0x12ba86(0x117)](_0xf8b3); if (_0x266f40 !== -0x1 && _0x5d252e['details'][_0x266f40]) { this[_0x12ba86(0x1d3)][_0x2e1001] = _0x5d252e[_0x12ba86(0x1b7)][_0x266f40][_0x12ba86(0xfa)]; if (this[_0x12ba86(0x1e8)][_0x12ba86(0x1ce)] === !![]) this['dimensions'][_0x2e1001] = _0x5d252e['details'][_0x266f40][_0x12ba86(0x131)]; } else this[_0x12ba86(0x1d3)][_0x2e1001] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else this[_0x12ba86(0x1d3)][_0x2e1001] = { 'x': 0x0, 'y': 0x2710, 'z': 0x0 }; } else { const _0xa88294 = _0x549678[_0x12ba86(0x117)](_0xf8b3); if (_0xa88294 !== -0x1 && _0x5d252e[_0x12ba86(0x1b7)][_0xa88294]) this[_0x12ba86(0x1d3)][_0x2e1001] = _0x5d252e['details'][_0xa88294]['position'], this[_0x12ba86(0x1da)][_0x2e1001] = _0x5d252e[_0x12ba86(0x1b7)][_0xa88294][_0x12ba86(0x149)], this[_0x12ba86(0x120)][_0x2e1001] = _0x5d252e['details'][_0xa88294][_0x12ba86(0x131)]; else this['positions'][_0x2e1001] = { 'x': 0x0, 'y': 0x7530, 'z': 0x0 }; } } } }), this[_0x5d6fed(0x10d)] = !![], this[_0x5d6fed(0x179)](); if (_0x30ec34[_0x5d6fed(0x122)] === 0x0 && !this[_0x5d6fed(0x16b)]) { this[_0x5d6fed(0x16b)] = !![]; const _0x9e340b = _0x30ec34[_0x5d6fed(0x1f5)][0x0]; this[_0x5d6fed(0x1bc)](_0x9e340b)['catch'](_0x3bc018 => { const _0x48274c = _0x5d6fed; console[_0x48274c(0x222)](_0x48274c(0x171), _0x3bc018); })['finally'](() => { const _0x2b8494 = _0x5d6fed; this[_0x2b8494(0x16b)] = ![]; }); } } catch (_0x1e292b) { console['error'](_0x5d6fed(0x116) + this['worldName'] + ']:', _0x1e292b); } if (!this[_0x5d6fed(0x18d)]) setTimeout(() => this[_0x5d6fed(0x212)](), 0x0); } async['processTagCommands'](_0x3bfae0) { const _0x4b23ef = _0x4b563d, _0x1eff34 = await this[_0x4b23ef(0x1c5)][_0x4b23ef(0x20f)](_0x4b23ef(0x1fe)); if (_0x1eff34[_0x4b23ef(0x122)] === 0x0 && _0x1eff34[_0x4b23ef(0x12c)]) { let _0x5dd46b = []; const _0x3e80fb = new Player(this[_0x4b23ef(0x1c5)], _0x3bfae0), _0x594108 = _0x1eff34[_0x4b23ef(0x12c)]['split'](/\r\n|\n|\r/); for (const _0x217fb0 of _0x594108) { if (!_0x217fb0['trim']()) continue; const _0x162b32 = _0x217fb0[_0x4b23ef(0x1dd)](/§./g, ''), _0x554ae4 = _0x162b32[_0x4b23ef(0x117)](':'); _0x554ae4 !== -0x1 && (_0x5dd46b = _0x5dd46b[_0x4b23ef(0x11f)](_0x162b32[_0x4b23ef(0xeb)](_0x554ae4 + 0x1)['split'](',')['map'](_0x277793 => _0x277793[_0x4b23ef(0x209)]())[_0x4b23ef(0x1a1)](_0x1c4726 => _0x1c4726[_0x4b23ef(0x14d)](_0x4b23ef(0x1d5))))); for (const _0x3ddda8 of _0x5dd46b) { if (_0x3ddda8 === _0x4b23ef(0x1b9) || _0x3ddda8[_0x4b23ef(0x14d)](_0x4b23ef(0x1d2))) continue; const _0x726ea0 = _0x3ddda8['startsWith'](_0x4b23ef(0x1d5)) ? _0x3ddda8['substring'](_0x4b23ef(0x1d5)['length']) : _0x3ddda8; let [_0x2774e3, ..._0x418411] = _0x726ea0['split'](':'); _0x2774e3 = '!' + _0x2774e3, this[_0x4b23ef(0x1ec)][_0x2774e3] && (await this[_0x4b23ef(0x1ec)][_0x2774e3](this[_0x4b23ef(0x1c5)], _0x3e80fb, _0x418411), this[_0x4b23ef(0x1c5)][_0x4b23ef(0x20f)](_0x4b23ef(0x105) + _0x3ddda8 + '\x22')); } } await this[_0x4b23ef(0x1c5)][_0x4b23ef(0x20f)]('tag\x20@a[tag=pvc:req_cmd]\x20remove\x20pvc:req_cmd'); } } async[_0x4b563d(0x1bf)]() { const _0x5dfab2 = _0x4b563d; if (!this['world']) return []; try { const _0x6d3b3f = await this[_0x5dfab2(0x1c5)][_0x5dfab2(0x20f)](_0x5dfab2(0x141)); if (_0x6d3b3f['statusCode'] !== 0x0 || !_0x6d3b3f['statusMessage']) return []; let _0x3b5ad4 = []; const _0x2fa443 = _0x6d3b3f[_0x5dfab2(0x12c)]['split'](/\r\n|\n|\r/); for (const _0x2c6489 of _0x2fa443) { if (!_0x2c6489[_0x5dfab2(0x209)]()) continue; const _0x20b7f9 = _0x2c6489['replace'](/§./g, ''), _0x5a4d41 = _0x20b7f9['indexOf'](':'); _0x5a4d41 !== -0x1 && (_0x3b5ad4 = _0x3b5ad4['concat'](_0x20b7f9[_0x5dfab2(0xeb)](_0x5a4d41 + 0x1)[_0x5dfab2(0x104)](',')['map'](_0x4a5c2f => _0x4a5c2f[_0x5dfab2(0x209)]())[_0x5dfab2(0x1a1)](_0xd9a7e0 => _0xd9a7e0['startsWith'](_0x5dfab2(0x1d5))))); } return _0x3b5ad4; } catch (_0x7f0fac) { return []; } } [_0x4b563d(0x179)]() { const _0x442cbd = _0x4b563d; if (!this[_0x442cbd(0x10d)]) return; const _0xc9df5f = {}; for (const [_0x29a077, _0x183e3f] of Object['entries'](this[_0x442cbd(0x1d3)])) { if (_0x183e3f) _0xc9df5f[_0x29a077] = [Math['round'](_0x183e3f['x'] * 0x64) / 0x64, Math[_0x442cbd(0x1e4)](_0x183e3f['y'] * 0x64) / 0x64, Math[_0x442cbd(0x1e4)](_0x183e3f['z'] * 0x64) / 0x64]; } const _0x424e2f = { 'spec': this[_0x442cbd(0x1e8)][_0x442cbd(0x10e)], 'spLis': this[_0x442cbd(0x1e8)][_0x442cbd(0x19e)], 'spDim': this['config'][_0x442cbd(0x1ce)], 't': 'wu', 'pos': _0xc9df5f, 'dis': this[_0x442cbd(0x1e8)][_0x442cbd(0x21e)], 'pssws': this['passwords'], 'dim': this['dimensions'], 'yr': this['yRots'], 'spPos': this[_0x442cbd(0x190)], 'prox': this[_0x442cbd(0x1e8)]['proximity'] ? 0x1 : 0x0 }, _0x309c04 = msgpack[_0x442cbd(0x106)](_0x424e2f); if (this[_0x442cbd(0x226)] && this['relayWs'][_0x442cbd(0x191)] === WebSocket[_0x442cbd(0xe8)]) this[_0x442cbd(0x226)][_0x442cbd(0xfb)](_0x309c04); this['directVcClients'][_0x442cbd(0x150)](_0x2863bf => { const _0x5660c9 = _0x442cbd; if (_0x2863bf[_0x5660c9(0x191)] === WebSocket[_0x5660c9(0xe8)]) _0x2863bf[_0x5660c9(0xfb)](_0x309c04); }); } async[_0x4b563d(0x21b)](_0x50aeb9) { const _0x5c159f = _0x4b563d, _0x24df4e = _0x50aeb9 === 'mc', _0x3fbb3a = _0x24df4e ? _0x5c159f(0x1e3) : '[VC\x20Relay]'; try { if (!this['roomId']) { const _0x3090e1 = await fetch(_0x5c159f(0x14f) + RELAY_SERVER_DOMAIN + _0x5c159f(0x1e2) + this[_0x5c159f(0x1e8)][_0x5c159f(0x1f0)]), _0x34b52c = await _0x3090e1[_0x5c159f(0x13b)](); this[_0x5c159f(0x1ac)] = _0x34b52c[_0x5c159f(0x1ac)]; if (this['world']) { this['cleanOldTags'](), this['world']['runCommand'](_0x5c159f(0x146) + this[_0x5c159f(0x1ac)] + '\x22')[_0x5c159f(0x1e7)](() => { }); if (this['config'][_0x5c159f(0x217)] === 'ja') await this['world']['sendMessage']('リレーモードに切り替わりました。\x0aRoom\x20ID:\x20' + this[_0x5c159f(0x1ac)]); else await this[_0x5c159f(0x1c5)][_0x5c159f(0xf6)](_0x5c159f(0x1a4) + this[_0x5c159f(0x1ac)]); } } else { if (!this[_0x5c159f(0x12b)]) { if (this[_0x5c159f(0x1c5)]) { if (this['config']['lang'] === 'ja') await this[_0x5c159f(0x1c5)][_0x5c159f(0xf6)](_0x5c159f(0x1a7) + this[_0x5c159f(0x1ac)]); else await this['world'][_0x5c159f(0xf6)](_0x5c159f(0x1a4) + this[_0x5c159f(0x1ac)]); } } } this[_0x5c159f(0x12b)] = !![]; if (_0x24df4e) { console['log'](_0x5c159f(0x16f)); if (this[_0x5c159f(0x1e8)][_0x5c159f(0x217)] === 'ja') this['logInfo']('Minecraftから以下のコマンドで接続してください:'); else this['logInfo'](_0x5c159f(0x1d7)); this['logInfo']('/connect\x20' + RELAY_SERVER_DOMAIN + '/room/' + this['roomId']), this[_0x5c159f(0x152)] = _0x5c159f(0x1fc) + RELAY_SERVER_DOMAIN + _0x5c159f(0xfe) + this['roomId']; } else { this[_0x5c159f(0x16e)]('ROOM\x20ID:\x20' + this[_0x5c159f(0x1ac)]); if (this[_0x5c159f(0x1e8)][_0x5c159f(0x217)] === 'ja') this[_0x5c159f(0x16e)](_0x5c159f(0x1fb)); else this[_0x5c159f(0x16e)](_0x5c159f(0x1b3)); this['logInfo']('https://mcproxvc.ovh/connect/?roomid=' + this['roomId']), console[_0x5c159f(0x172)]('=======================================================\x0a'); } this[_0x5c159f(0x15b)](); let _0x2123fd; if (this['relayWs']) { _0x2123fd = this[_0x5c159f(0x226)]; if (_0x2123fd[_0x5c159f(0x191)] !== WebSocket[_0x5c159f(0xe8)]) { } } else _0x2123fd = new WebSocket(_0x5c159f(0x1ad) + RELAY_SERVER_DOMAIN + _0x5c159f(0xfe) + this[_0x5c159f(0x1ac)] + _0x5c159f(0x175)), this[_0x5c159f(0x226)] = _0x2123fd, _0x2123fd['on']('open', () => this[_0x5c159f(0x16e)](_0x5c159f(0x17a) + this[_0x5c159f(0x1ac)] + ')')), _0x2123fd['on'](_0x5c159f(0x10c), () => { const _0x553dad = _0x5c159f; if (this[_0x553dad(0x226)] === _0x2123fd) this[_0x553dad(0x226)] = null; }), _0x2123fd['on'](_0x5c159f(0x222), _0x2fea56 => console[_0x5c159f(0x222)](_0x3fbb3a + _0x5c159f(0x118), _0x2fea56)); _0x24df4e ? (this[_0x5c159f(0x12d)] = !![], this[_0x5c159f(0x17e)](_0x2123fd), this[_0x5c159f(0x21b)]('vc')) : (this['vc_connected'] = !![], this['setupVcRelayListeners'](_0x2123fd)); } catch (_0x4f9afb) { console[_0x5c159f(0x222)](_0x3fbb3a + _0x5c159f(0x118), _0x4f9afb); } } [_0x4b563d(0x11d)](_0xd84a0e) { const _0x53bf61 = _0x4b563d, { app_id: _0x52ed69, secret_key: _0x418e9a, proximity: _0x4ec72b, distance: _0x4dce72, spectator: _0x1cc028, specListen: _0x55e334, specDim: _0x35e8a0, verify: _0x5a20fd, password: _0x58be12 } = this['config']; _0xd84a0e['send'](msgpack[_0x53bf61(0x106)]({ 'password': !!(_0x5a20fd || _0x58be12), 'passwords': this[_0x53bf61(0x177)], 'app_id': _0x52ed69, 'secret_key': _0x418e9a, 'proximity': _0x4ec72b, 'distance': _0x4dce72, 'spectator': _0x1cc028, 'specListen': _0x55e334, 'specDim': _0x35e8a0 })); } [_0x4b563d(0xea)](_0x60e435) { const _0x228583 = _0x4b563d; _0x60e435['on'](_0x228583(0x1fd), async _0x26a3f1 => { const _0x5cc8a0 = _0x228583; try { const _0x72d51f = JSON['parse'](_0x26a3f1['toString']()); if (_0x72d51f['type'] === 'partner_connected') { this[_0x5cc8a0(0x11d)](_0x60e435); return; } if (_0x72d51f[_0x5cc8a0(0x18a)] === _0x5cc8a0(0x164)) { if (this[_0x5cc8a0(0x1c5)]) await this[_0x5cc8a0(0x1c5)][_0x5cc8a0(0x20f)](_0x72d51f[_0x5cc8a0(0x123)]); } } catch (_0x553d31) { } }); } ['setupMcRelayListeners'](_0x1d62c1) { const _0xecf02b = _0x4b563d; _0x1d62c1['on'](_0xecf02b(0x1fd), async _0x157bb0 => { const _0x392cf2 = _0xecf02b; let _0x44896e = _0x157bb0; try { Buffer['isBuffer'](_0x157bb0) && _0x157bb0[_0x392cf2(0xf3)] > 0x2 && _0x157bb0[0x0] === 0x1f && _0x157bb0[0x1] === 0x8b && (_0x44896e = zlib[_0x392cf2(0x1b2)](_0x157bb0)); } catch (_0x52e703) { } try { const _0x5f3c68 = JSON[_0x392cf2(0x1ca)](_0x44896e[_0x392cf2(0x109)]()); if (_0x5f3c68[_0x392cf2(0xfd)] === 'partner_connected') { const _0x3c8569 = _0x5f3c68[_0x392cf2(0x100)] || _0x392cf2(0x1eb); _0x3c8569 === _0x392cf2(0x1eb) ? (this[_0x392cf2(0x1aa)] = new WebSocket(_0x392cf2(0xf0) + this[_0x392cf2(0x1e8)][_0x392cf2(0x15f)], { 'headers': { 'x-proxvc-session': this['id'] } }), this[_0x392cf2(0xf4)] = [], this[_0x392cf2(0x1aa)]['on'](_0x392cf2(0x1b8), () => { const _0xec716f = _0x392cf2; while (this['localClientBuffer'][_0xec716f(0xf3)] > 0x0) { const _0x5c64fd = this[_0xec716f(0xf4)][_0xec716f(0x228)](); this[_0xec716f(0x1aa)]['send'](_0x5c64fd); } }), this['localClient']['on']('message', _0x76287 => _0x1d62c1[_0x392cf2(0x191)] === WebSocket[_0x392cf2(0xe8)] && _0x1d62c1[_0x392cf2(0xfb)](_0x76287)), this[_0x392cf2(0x1aa)]['on'](_0x392cf2(0x10c), (_0x4ebaa6, _0x42fb1a) => { const _0x3b734f = _0x392cf2; if (_0x1d62c1['readyState'] === WebSocket[_0x3b734f(0xe8)]) _0x1d62c1[_0x3b734f(0x10c)](); }), this[_0x392cf2(0x1aa)]['on'](_0x392cf2(0x222), _0x947d76 => console[_0x392cf2(0x222)](_0x392cf2(0x1ba) + _0x947d76[_0x392cf2(0x1fd)]))) : this['sendInitialPayload'](_0x1d62c1); return; } else { if (_0x5f3c68[_0x392cf2(0xfd)] === _0x392cf2(0x1a5)) { this['localClient'] && (this[_0x392cf2(0x1aa)]['close'](), this[_0x392cf2(0x1aa)] = null); return; } else { if (_0x5f3c68[_0x392cf2(0xfd)] === 'relayed_vc_data') { console[_0x392cf2(0x172)](_0x392cf2(0x162)); try { let _0x43621e = _0x5f3c68[_0x392cf2(0x110)]; _0x43621e && _0x43621e[_0x392cf2(0xfd)] === _0x392cf2(0x1a8) && (_0x43621e = Buffer[_0x392cf2(0x16a)](_0x43621e[_0x392cf2(0x110)])); try { const _0x161c77 = msgpack[_0x392cf2(0x15a)](_0x43621e); if (_0x161c77) { if (_0x161c77[_0x392cf2(0x18a)] === _0x392cf2(0x164) && typeof _0x161c77[_0x392cf2(0x123)] === _0x392cf2(0x151)) { if (this[_0x392cf2(0x1c5)]) this[_0x392cf2(0x1c5)][_0x392cf2(0x20f)](_0x161c77[_0x392cf2(0x123)])[_0x392cf2(0x1e7)](() => { }); } else { if (_0x161c77[_0x392cf2(0x192)] && _0x161c77[_0x392cf2(0xfa)]) this['positions'][_0x161c77[_0x392cf2(0x192)]] = _0x161c77[_0x392cf2(0xfa)]; else _0x161c77[_0x392cf2(0xfd)] === _0x392cf2(0x1bb) && this[_0x392cf2(0x11d)](_0x1d62c1); } } } catch (_0x208f31) { const _0x3d229c = JSON[_0x392cf2(0x1ca)](_0x43621e[_0x392cf2(0x109)]()); if (_0x3d229c['action'] === 'run_command') { if (this[_0x392cf2(0x1c5)]) this[_0x392cf2(0x1c5)]['runCommand'](_0x3d229c[_0x392cf2(0x123)])[_0x392cf2(0x1e7)](() => { }); } } } catch (_0xabfecd) { } return; } } } if (_0x5f3c68[_0x392cf2(0xfd)] === 'data_update') this[_0x392cf2(0x119)](_0x5f3c68); } catch (_0xba9a8f) { } if (this['localClient']?.['readyState'] === WebSocket[_0x392cf2(0xe8)]) this[_0x392cf2(0x1aa)][_0x392cf2(0xfb)](_0x44896e); else this[_0x392cf2(0x1aa)]?.[_0x392cf2(0x191)] === WebSocket[_0x392cf2(0x20b)] && this[_0x392cf2(0xf4)][_0x392cf2(0xf9)](_0x44896e); }), _0x1d62c1['on'](_0xecf02b(0x10c), () => this['localClient']?.[_0xecf02b(0x10c)]()); } [_0x4b563d(0x1ea)]() { const _0x32a034 = _0x4b563d, _0x21ee5b = (_0x40fcc9, _0x56d3fb, _0x48e79e) => async (_0x25250c, _0x14a490, _0x507e09) => { const _0x3b4216 = _0x1fda; if (_0x14a490['name'] !== _0x25250c['localPlayer']['name']) return; if (_0x507e09[0x0] !== _0x3b4216(0x173) && _0x507e09[0x0] !== _0x3b4216(0x14c)) return; const _0x4bf6ff = _0x507e09[0x0] === _0x3b4216(0x173); this[_0x3b4216(0x1e8)][_0x40fcc9] = _0x4bf6ff; if (_0x40fcc9 === 'verify') this['config'][_0x3b4216(0x19f)] = _0x4bf6ff; updateConfigFile(_0x40fcc9, _0x4bf6ff); const _0x43529d = this[_0x3b4216(0x1e8)]['lang'] === 'ja' ? _0x4bf6ff ? _0x56d3fb[_0x3b4216(0x1f8)] : _0x56d3fb[_0x3b4216(0x215)] : _0x4bf6ff ? _0x48e79e[_0x3b4216(0x1f8)] : _0x48e79e['disabled'], _0x2be5af = this[_0x3b4216(0x1e8)][_0x3b4216(0x217)] === 'ja' ? _0x3b4216(0x1af) : _0x3b4216(0x115); if (this[_0x3b4216(0x1e8)][_0x3b4216(0x10b)]) await _0x25250c[_0x3b4216(0xf6)](_0x2be5af + _0x43529d); }; return { '!dis': async (_0x50674c, _0x4a6837, _0x2f3daf) => { const _0x59d959 = _0x1fda; if (_0x4a6837[_0x59d959(0x220)] !== _0x50674c[_0x59d959(0x1c8)][_0x59d959(0x220)]) return; const _0x12e998 = Number(_0x2f3daf[0x0]); if (!isNaN(_0x12e998)) { this[_0x59d959(0x1e8)][_0x59d959(0x21e)] = _0x12e998, updateConfigFile(_0x59d959(0x21e), _0x12e998); const _0x16c098 = this[_0x59d959(0x1e8)][_0x59d959(0x217)] === 'ja' ? _0x59d959(0x1c2) + _0x12e998 + 'に変更しました' : _0x59d959(0x199) + _0x12e998; if (this[_0x59d959(0x1e8)][_0x59d959(0x10b)]) await _0x50674c[_0x59d959(0xf6)](_0x16c098); } }, '!name': async (_0x4bbe39, _0x59275d) => { const _0xb20d99 = _0x1fda, _0x5ab66d = this[_0xb20d99(0x148)](_0x59275d[_0xb20d99(0x220)]), _0x5651c9 = _0xb20d99(0x11a) + this[_0xb20d99(0x1ac)] + _0xb20d99(0x1f9) + _0x5ab66d + 'です', _0x14fbf8 = _0xb20d99(0x1bd) + this[_0xb20d99(0x1ac)] + _0xb20d99(0x12e) + _0x5ab66d; await _0x59275d[_0xb20d99(0xf6)](this[_0xb20d99(0x1e8)][_0xb20d99(0x217)] === 'ja' ? _0x5651c9 : _0x14fbf8); if (this[_0xb20d99(0x1e8)][_0xb20d99(0x19f)]) { !this[_0xb20d99(0x177)][_0x5ab66d] && (this[_0xb20d99(0x177)][_0x5ab66d] = Math[_0xb20d99(0x159)](0x3e8 + Math['random']() * 0x2328)[_0xb20d99(0x109)]()); const _0x55b94b = this[_0xb20d99(0x1e8)]['lang'] === 'ja' ? '認証コードは' + this[_0xb20d99(0x177)][_0x5ab66d] + 'です' : _0xb20d99(0x182) + this[_0xb20d99(0x177)][_0x5ab66d]; await _0x59275d[_0xb20d99(0xf6)](_0x55b94b); } }, '!output': _0x21ee5b(_0x32a034(0x10b), { 'enabled': '出力を有効にしました', 'disabled': '出力を無効にしました' }, { 'enabled': _0x32a034(0x18f), 'disabled': _0x32a034(0xe3) }), '!password': _0x21ee5b('verify', { 'enabled': _0x32a034(0x180), 'disabled': _0x32a034(0x1ed) }, { 'enabled': _0x32a034(0x207), 'disabled': _0x32a034(0x13c) }), '!verify': _0x21ee5b(_0x32a034(0x1c9), { 'enabled': '認証コードを有効にしました', 'disabled': _0x32a034(0x1ed) }, { 'enabled': _0x32a034(0x207), 'disabled': _0x32a034(0x13c) }), '!pvc': _0x21ee5b(_0x32a034(0x13f), { 'enabled': _0x32a034(0x14b), 'disabled': _0x32a034(0x200) }, { 'enabled': _0x32a034(0x21a), 'disabled': _0x32a034(0xfc) }), '!spectator': _0x21ee5b(_0x32a034(0x10e), { 'enabled': _0x32a034(0x129), 'disabled': 'スペクテイターを共通のVCにしました' }, { 'enabled': 'Spectator\x20and\x20VC\x20separated', 'disabled': 'Spectator\x20set\x20to\x20common\x20VC' }), '!specListen': _0x21ee5b(_0x32a034(0x19e), { 'enabled': _0x32a034(0xe5), 'disabled': _0x32a034(0x155) }, { 'enabled': _0x32a034(0x18c), 'disabled': _0x32a034(0x1c3) }), '!specDim': _0x21ee5b(_0x32a034(0x1ce), { 'enabled': _0x32a034(0xed), 'disabled': _0x32a034(0x101) }, { 'enabled': _0x32a034(0x21d), 'disabled': _0x32a034(0x1d9) }), '!lang': async (_0x5d8b7a, _0x12b605, _0x437e60) => { const _0x51ad62 = _0x32a034; if (_0x12b605[_0x51ad62(0x220)] !== _0x5d8b7a['localPlayer']['name']) return; const _0x17e77a = _0x437e60[0x0] === 'ja' ? 'ja' : 'en'; this[_0x51ad62(0x1e8)][_0x51ad62(0x217)] = _0x17e77a, updateConfigFile(_0x51ad62(0x217), _0x17e77a), await _0x5d8b7a[_0x51ad62(0xf6)](_0x17e77a === 'ja' ? _0x51ad62(0x10a) : _0x51ad62(0x13e)); }, '!config': async (_0x23a989, _0x59e0c2) => { const _0x1e8b0b = _0x32a034; if (_0x59e0c2[_0x1e8b0b(0x220)] !== _0x23a989[_0x1e8b0b(0x1c8)][_0x1e8b0b(0x220)]) return; const { proximity: _0x44e254, distance: _0x4062d2, password: _0x5af56e, spectator: _0xa781c1, specListen: _0x51e916, specDim: _0x5e6eec, lang: _0x129676, output: _0x227e80 } = this[_0x1e8b0b(0x1e8)], _0x1ce147 = _0x129676 === 'ja' ? '§a有効§r' : '§aEnabled§r', _0x4460e3 = _0x129676 === 'ja' ? '§c無効§r' : _0x1e8b0b(0x124), _0x1502ce = _0x412d06 => _0x412d06 ? _0x1ce147 : _0x4460e3; let _0x883e1f = _0x129676 === 'ja' ? _0x1e8b0b(0xee) + _0x129676 + _0x1e8b0b(0x223) + _0x1502ce(_0x44e254) + '\x0a最大距離\x20(Distance):\x20§e' + _0x4062d2 + _0x1e8b0b(0x216) + _0x1502ce(_0x5af56e) + _0x1e8b0b(0x197) + _0x1502ce(_0x227e80) + '\x0aスペクテイター分離\x20(Spectator):\x20' + _0x1502ce(_0xa781c1) + _0x1e8b0b(0x195) + _0x1502ce(_0x51e916) + _0x1e8b0b(0x178) + _0x1502ce(_0x5e6eec) : _0x1e8b0b(0x196) + _0x129676 + _0x1e8b0b(0x187) + _0x1502ce(_0x44e254) + _0x1e8b0b(0x213) + _0x4062d2 + _0x1e8b0b(0x1d6) + _0x1502ce(_0x5af56e) + _0x1e8b0b(0x1be) + _0x1502ce(_0x227e80) + _0x1e8b0b(0x17f) + _0x1502ce(_0xa781c1) + _0x1e8b0b(0x161) + _0x1502ce(_0x51e916) + _0x1e8b0b(0x194) + _0x1502ce(_0x5e6eec); await _0x59e0c2['sendMessage'](_0x883e1f); }, '!help': async (_0x3c885f, _0x417256) => { const _0x13c6fe = _0x32a034, { lang: _0x1f04c8 } = this[_0x13c6fe(0x1e8)]; await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x1f1)), _0x1f04c8 == 'ja' ? (await _0x417256[_0x13c6fe(0xf6)]('コマンド一覧：\x0a\x20!help\x20-\x20ヘルプを表示します\x0a\x20!name\x20-\x20VCで使うゲーマータグを確認できます'), _0x417256[_0x13c6fe(0x220)] == _0x3c885f[_0x13c6fe(0x1c8)]['name'] && (await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x112)), await _0x417256['sendMessage'](_0x13c6fe(0xff)), await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x14a)))) : (await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x133)), _0x417256[_0x13c6fe(0x220)] == _0x3c885f[_0x13c6fe(0x1c8)][_0x13c6fe(0x220)] && (await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x11c)), await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x113)), await _0x417256[_0x13c6fe(0xf6)]('Settings\x20effective\x20only\x20when\x20\x22spectator\x22\x20is\x20true\x20:\x20\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension'))), await _0x417256[_0x13c6fe(0xf6)](_0x13c6fe(0x1f1)); } }; } [_0x4b563d(0x119)](_0x57b642) { const _0x572129 = _0x4b563d; if (this['vc_connected']) this[_0x572129(0x179)](); if (this[_0x572129(0x21f)]) this[_0x572129(0x204)](); for (const [_0x5e391e, _0x53baa0] of Object['entries'](_0x57b642)) { if (_0x5e391e === _0x572129(0xfd)) continue; if ([_0x572129(0x1d3), _0x572129(0x13f), _0x572129(0x21e), 'spectator', _0x572129(0x190), 'specListen', _0x572129(0x1ce), _0x572129(0x120), 'yRots', _0x572129(0x19f), _0x572129(0x217)][_0x572129(0x20c)](_0x5e391e)) { if ([_0x572129(0x1d3), _0x572129(0x190), _0x572129(0x120), 'yRots'][_0x572129(0x20c)](_0x5e391e)) this[_0x5e391e] = _0x53baa0; else this[_0x572129(0x1e8)][_0x5e391e] = _0x53baa0; } } } [_0x4b563d(0x1de)](_0x4d8065) { const _0x277bce = _0x4b563d; this[_0x277bce(0x1c5)] = _0x4d8065, this[_0x277bce(0x1ee)](), this['pendingTimeout'] && (clearTimeout(this['pendingTimeout']), this[_0x277bce(0x221)] = null), this[_0x277bce(0x12b)] && this['roomId'] && this[_0x277bce(0x1c5)][_0x277bce(0x20f)]('tag\x20@s\x20add\x20\x22pvc:roomId=' + this[_0x277bce(0x1ac)] + '\x22')[_0x277bce(0x1e7)](() => { }); } ['destroy'](_0x6b3387 = 'success') { const _0x5b47c1 = _0x4b563d, _0x25d6a9 = this['worldName']; this[_0x5b47c1(0x16e)](_0x5b47c1(0x139) + _0x6b3387), this['stop_roop'] = !![]; this[_0x5b47c1(0x221)] && (clearTimeout(this[_0x5b47c1(0x221)]), this[_0x5b47c1(0x221)] = null); this[_0x5b47c1(0xf1)] && (clearTimeout(this[_0x5b47c1(0xf1)]), this[_0x5b47c1(0xf1)] = null); const _0x5684a1 = msgpack[_0x5b47c1(0x106)]({ 't': 'stop', 'type': _0x5b47c1(0xe7) }); this[_0x5b47c1(0x226)] && (this[_0x5b47c1(0x226)][_0x5b47c1(0xfb)](_0x5684a1), this[_0x5b47c1(0x226)][_0x5b47c1(0x10c)](), this[_0x5b47c1(0x226)] = null); this[_0x5b47c1(0x1aa)] && (this[_0x5b47c1(0x1aa)][_0x5b47c1(0x10c)](), this[_0x5b47c1(0x1aa)] = null); this['sshClient'] && (this['sshClient'][_0x5b47c1(0x20e)](), this[_0x5b47c1(0x19d)] = null); this[_0x5b47c1(0x1f3)] = null, this[_0x5b47c1(0xf7)] = null, this[_0x5b47c1(0x1a9)][_0x5b47c1(0x150)](_0x5ba03b => _0x5ba03b['close']()), this['directVcClients']['clear'](); if (typeof this[_0x5b47c1(0x127)] === _0x5b47c1(0x15d)) this[_0x5b47c1(0x127)]()[_0x5b47c1(0x18b)](() => { const _0x6c001e = _0x5b47c1; sessionHistory[_0x6c001e(0x1fa)](this['id'], { 'reason': _0x6b3387, 'timestamp': Date[_0x6c001e(0x134)]() }), sessions[_0x6c001e(0x1e5)](this[_0x6c001e(0x1c5)]), pendingSessions['delete'](this['id']); }); else { sessionHistory[_0x5b47c1(0x1fa)](this['id'], { 'reason': _0x6b3387, 'timestamp': Date['now']() }); if (sessionHistory[_0x5b47c1(0x15c)] > 0x64) { const _0x3a4602 = sessionHistory[_0x5b47c1(0x128)]()[_0x5b47c1(0x130)]()[_0x5b47c1(0x123)]; sessionHistory[_0x5b47c1(0x1e5)](_0x3a4602); } sessions['delete'](this[_0x5b47c1(0x1c5)]), pendingSessions[_0x5b47c1(0x1e5)](this['id']); } } } const sessions = new Map(), pendingSessions = new Map(), sessionHistory = new Map(); async function main() { const _0x2a080b = _0x4b563d; let _0xa45af = INITIAL_CONFIG[_0x2a080b(0x15f)], _0x4111ff = INITIAL_CONFIG[_0x2a080b(0x189)]; _0xa45af = await getPort({ 'port': [_0xa45af, ...makeRange(0x4abd, 0x4b20)] }), _0x4111ff = await getPort({ 'port': [_0x4111ff, ...makeRange(0x1f41, 0x1fa4)] }), console['log'](_0x2a080b(0x137) + _0xa45af), console[_0x2a080b(0x172)](_0x2a080b(0x202) + _0x4111ff), INITIAL_CONFIG['port'] = _0xa45af, INITIAL_CONFIG[_0x2a080b(0x189)] = _0x4111ff, globalConfig[_0x2a080b(0x15f)] = _0xa45af, globalConfig['web_port'] = _0x4111ff, setupGlobalVcWebSocket(_0x4111ff); const _0x3c61cd = express(), _0x1911bf = http['createServer'](_0x3c61cd); _0x1911bf[_0x2a080b(0x102)](_0xa45af); const _0x20497a = new Server({ 'webSocketOptions': { 'server': _0x1911bf } }); _0x3c61cd['use'](express[_0x2a080b(0x13b)]()), _0x3c61cd['post'](_0x2a080b(0x12f), async (_0x438d54, _0x1f7692) => { const _0x2d95d8 = _0x2a080b; try { const _0x104b3d = _0x438d54[_0x2d95d8(0x1f2)][_0x2d95d8(0x1e8)] || {}, _0x529c41 = new Session(null, _0x104b3d); await _0x529c41['startWebSession'](), pendingSessions['set'](_0x529c41['id'], _0x529c41), _0x1f7692[_0x2d95d8(0x13b)]({ 'sessionId': _0x529c41['id'], 'roomId': _0x529c41[_0x2d95d8(0x1ac)], 'connectCommand': _0x529c41['connectCommand'] }), _0x529c41['startTimer'](); } catch (_0x37d338) { console['error'](_0x37d338), _0x1f7692[_0x2d95d8(0xf5)](0x1f4)[_0x2d95d8(0x13b)]({ 'error': _0x37d338[_0x2d95d8(0x1fd)] }); } }), _0x3c61cd['post'](_0x2a080b(0x1c0), (_0x58df0d, _0x1ead03) => { const _0x5a7562 = _0x2a080b, { sessionId: _0x262197 } = _0x58df0d[_0x5a7562(0x1f2)], _0xb74b42 = pendingSessions[_0x5a7562(0x1c4)](_0x262197) || Array[_0x5a7562(0x16a)](sessions[_0x5a7562(0x156)]())[_0x5a7562(0x1e6)](_0x897ab1 => _0x897ab1['id'] === _0x262197); _0xb74b42 ? (_0xb74b42['destroy']('success'), _0x1ead03[_0x5a7562(0x13b)]({ 'success': !![] })) : _0x1ead03[_0x5a7562(0xf5)](0x194)[_0x5a7562(0x13b)]({ 'error': _0x5a7562(0x19b) }); }), _0x3c61cd[_0x2a080b(0x1c4)](_0x2a080b(0x1d8), (_0x1d79f1, _0x55491b) => { const _0x3c46f3 = _0x2a080b, _0x229098 = _0x1d79f1[_0x3c46f3(0x1cc)]['id'], _0x5ec3f8 = pendingSessions[_0x3c46f3(0x1c4)](_0x229098) || Array[_0x3c46f3(0x16a)](sessions['values']())[_0x3c46f3(0x1e6)](_0x1841a2 => _0x1841a2['id'] === _0x229098); if (_0x5ec3f8) _0x55491b[_0x3c46f3(0x13b)]({ 'status': 'active', 'sshError': _0x5ec3f8[_0x3c46f3(0x1a6)] }); else { if (sessionHistory[_0x3c46f3(0x208)](_0x229098)) { const _0x329f1b = sessionHistory['get'](_0x229098); _0x55491b[_0x3c46f3(0x13b)]({ 'status': _0x3c46f3(0x107), 'reason': _0x329f1b[_0x3c46f3(0x160)], 'timestamp': _0x329f1b['timestamp'] }); } else _0x55491b[_0x3c46f3(0x13b)]({ 'status': _0x3c46f3(0x142) }); } }); const _0x33586e = (_0x3802ea, _0x9c2dae) => { const _0x173907 = _0x2a080b, { type: _0x281322 } = _0x3802ea[_0x173907(0x1f2)], _0x1d1ab7 = _0x3802ea[_0x173907(0x1ff)][_0x173907(0x214)]; let _0x6bd49e = null; if (_0x1d1ab7) { for (const _0x5a7bf0 of sessions[_0x173907(0x156)]()) { const _0xe7be4b = _0x5a7bf0[_0x173907(0x1e8)][_0x173907(0x1f0)]; if (_0xe7be4b && _0x1d1ab7[_0x173907(0x14d)](_0xe7be4b)) { _0x6bd49e = _0x5a7bf0; break; } } if (!_0x6bd49e) for (const _0x35c126 of pendingSessions[_0x173907(0x156)]()) { const _0x405bb9 = _0x35c126['config'][_0x173907(0x1f0)]; if (_0x405bb9 && _0x1d1ab7[_0x173907(0x14d)](_0x405bb9)) { _0x6bd49e = _0x35c126; break; } } } if (_0x6bd49e) { if (_0x281322 === _0x173907(0x165)) _0x6bd49e[_0x173907(0x119)](_0x3802ea['body']); else { if (_0x281322 === _0x173907(0x1ef)) _0x6bd49e['destroy'](_0x173907(0x13a)); } _0x281322 === _0x173907(0x135) ? (_0x6bd49e[_0x173907(0x1ab)] = !![], _0x6bd49e[_0x173907(0x16e)](_0x173907(0xec)), _0x9c2dae[_0x173907(0xf5)](0xc8)['json']({ 'type': _0x173907(0x135), 'roomId': _0x6bd49e['roomId'], 'ws_connected': _0x6bd49e[_0x173907(0x12d)], ..._0x6bd49e['config'] })) : _0x9c2dae[_0x173907(0xf5)](0xc8)[_0x173907(0x13b)]({ 'success': !![] }); } else { sessions[_0x173907(0x150)](_0x4a2886 => { const _0x1b0e17 = _0x173907; if (_0x281322 === _0x1b0e17(0x165)) _0x4a2886['dataUpdate'](_0x3802ea[_0x1b0e17(0x1f2)]); else { if (_0x281322 === _0x1b0e17(0x1ef)) _0x4a2886['destroy']('success'); } }); const _0x16ed25 = sessions[_0x173907(0x156)]()[_0x173907(0x130)]()[_0x173907(0x123)] || pendingSessions['values']()[_0x173907(0x130)]()[_0x173907(0x123)]; _0x16ed25 ? _0x281322 === 'initialization' ? (_0x16ed25[_0x173907(0x1ab)] = !![], _0x16ed25[_0x173907(0x16e)]('接続開始'), _0x9c2dae[_0x173907(0xf5)](0xc8)[_0x173907(0x13b)]({ 'type': _0x173907(0x135), 'roomId': _0x16ed25[_0x173907(0x1ac)], 'ws_connected': _0x16ed25[_0x173907(0x12d)], ..._0x16ed25['config'] })) : _0x9c2dae[_0x173907(0xf5)](0xc8)[_0x173907(0x13b)]({ 'success': !![] }) : _0x9c2dae[_0x173907(0xf5)](0xc8)[_0x173907(0x13b)]({ 'error': 'No\x20active\x20sessions' }); } }; _0x3c61cd['post']('/', _0x33586e), _0x20497a['on'](ServerEvent[_0x2a080b(0x1df)], ({ world: _0x1888d1 }) => { const _0x576150 = _0x2a080b, _0x303c59 = _0x1888d1['pvcSessionId'], _0x2257fe = _0x1888d1[_0x576150(0x1b6)]; let _0x4cf673 = Array[_0x576150(0x16a)](sessions[_0x576150(0x156)]())[_0x576150(0x1e6)](_0x3f1e0e => _0x3f1e0e['id'] === _0x303c59); !_0x4cf673 && _0x303c59 && (_0x4cf673 = pendingSessions[_0x576150(0x1c4)](_0x303c59)); if (!_0x4cf673 && _0x2257fe) { _0x4cf673 = Array[_0x576150(0x16a)](pendingSessions[_0x576150(0x156)]())['find'](_0x53170d => { const _0x270910 = _0x576150, _0x266d9d = _0x53170d['config'][_0x270910(0x1f0)]; if (_0x266d9d && _0x2257fe[_0x270910(0x14d)](_0x266d9d)) return !![]; return ![]; }); if (_0x4cf673) { } } if (_0x4cf673) pendingSessions[_0x576150(0x208)](_0x4cf673['id']) && pendingSessions[_0x576150(0x1e5)](_0x4cf673['id']), sessions[_0x576150(0x1fa)](_0x1888d1, _0x4cf673), _0x4cf673[_0x576150(0x1de)](_0x1888d1); else { if (_0x2257fe && INITIAL_CONFIG[_0x576150(0x1f0)] && !_0x2257fe[_0x576150(0x14d)](INITIAL_CONFIG[_0x576150(0x1f0)])) { console[_0x576150(0xe1)](_0x576150(0x1cd) + _0x2257fe + '\x27'); return; } _0x4cf673 = new Session(_0x1888d1), sessions[_0x576150(0x1fa)](_0x1888d1, _0x4cf673), _0x4cf673[_0x576150(0x1ee)](); } }), _0x20497a['on'](ServerEvent['WorldRemove'], ({ world: _0x23e22a }) => { const _0x2691ed = _0x2a080b, _0x52f419 = sessions[_0x2691ed(0x1c4)](_0x23e22a); if (_0x52f419) { sessions['delete'](_0x23e22a); !pendingSessions[_0x2691ed(0x208)](_0x52f419['id']) && pendingSessions[_0x2691ed(0x1fa)](_0x52f419['id'], _0x52f419); if (_0x52f419['pendingTimeout']) clearTimeout(_0x52f419[_0x2691ed(0x221)]); _0x52f419[_0x2691ed(0x221)] = setTimeout(() => { const _0x3d62c4 = _0x2691ed; pendingSessions[_0x3d62c4(0x208)](_0x52f419['id']) && _0x52f419[_0x3d62c4(0x185)]('success'); }, 0x7530); } }), _0x20497a['on'](ServerEvent[_0x2a080b(0x1c6)], async ({ sender: _0x3daae1, message: _0x29e53d, world: _0x1fdc57 }) => { const _0x352bd1 = _0x2a080b, _0xf198d2 = sessions[_0x352bd1(0x1c4)](_0x1fdc57); if (_0xf198d2) { const [_0x3cae2f, ..._0x12fdd8] = _0x29e53d['split']('\x20'); if (_0xf198d2[_0x352bd1(0x1ec)][_0x3cae2f]) await _0xf198d2[_0x352bd1(0x1ec)][_0x3cae2f](_0x1fdc57, _0x3daae1, _0x12fdd8); } }), _0x20497a['on'](ServerEvent[_0x2a080b(0x19c)], async ({ player: _0x5ce7ab, world: _0x308adb }) => { const _0x535095 = _0x2a080b, _0x35c97e = sessions[_0x535095(0x1c4)](_0x308adb); _0x35c97e && (_0x35c97e[_0x535095(0x16e)](_0x535095(0x1dc) + _0x5ce7ab[_0x535095(0x220)]), _0x35c97e[_0x535095(0x19a)][_0x535095(0x17b)](_0x5ce7ab[_0x535095(0x220)]), setTimeout(async () => { const _0x361c9d = _0x535095; try { const _0x1d9967 = _0x35c97e[_0x361c9d(0x148)](_0x5ce7ab[_0x361c9d(0x220)]), { roomId: _0x5c4371, passwords: _0x140639, config: _0x220506 } = _0x35c97e, _0x1a0f6d = _0x361c9d(0x219) + _0x5c4371 + _0x361c9d(0x1f9) + _0x1d9967 + 'です', _0xd76f8 = _0x361c9d(0x157) + _0x5c4371 + _0x361c9d(0x12e) + _0x1d9967; await _0x5ce7ab[_0x361c9d(0xf6)](_0x220506['lang'] === 'ja' ? _0x1a0f6d : _0xd76f8); if (_0x220506[_0x361c9d(0x19f)]) { if (!_0x140639[_0x1d9967]) _0x140639[_0x1d9967] = Math[_0x361c9d(0x159)](0x3e8 + Math[_0x361c9d(0x1d0)]() * 0x2328)[_0x361c9d(0x109)](); const _0x1a6279 = _0x220506[_0x361c9d(0x217)] === 'ja' ? 'パスワードは' + _0x140639[_0x1d9967] + 'です' : _0x361c9d(0x138) + _0x140639[_0x1d9967]; await _0x5ce7ab[_0x361c9d(0xf6)](_0x1a6279); } } catch (_0x2d1556) { } }, 0x1f4)); }), _0x20497a['on'](ServerEvent[_0x2a080b(0x201)], ({ player: _0x591804, world: _0x36b3ad }) => { const _0x4a3ae3 = _0x2a080b, _0x24a011 = sessions[_0x4a3ae3(0x1c4)](_0x36b3ad); if (_0x24a011) { _0x24a011[_0x4a3ae3(0x16e)](_0x4a3ae3(0x1e0) + _0x591804[_0x4a3ae3(0x220)]); _0x591804[_0x4a3ae3(0x220)] === _0x36b3ad[_0x4a3ae3(0x1c8)][_0x4a3ae3(0x220)] && (_0x24a011[_0x4a3ae3(0x16e)](_0x4a3ae3(0x167)), _0x24a011['destroy'](_0x4a3ae3(0x13a))); _0x24a011[_0x4a3ae3(0x19a)]['delete'](_0x591804[_0x4a3ae3(0x220)]); const _0xd2afe9 = _0x24a011[_0x4a3ae3(0x148)](_0x591804[_0x4a3ae3(0x220)]); delete _0x24a011[_0x4a3ae3(0x1d3)][_0xd2afe9], delete _0x24a011[_0x4a3ae3(0x120)][_0xd2afe9], delete _0x24a011[_0x4a3ae3(0x1da)][_0xd2afe9], delete _0x24a011['spectators'][_0xd2afe9]; } }), _0x20497a['on'](ServerEvent['PlayerTransform'], ({ player: _0x46626e, world: _0x2a8ff0 }) => { const _0xd8bc4f = _0x2a080b, _0x1ee9a0 = sessions[_0xd8bc4f(0x1c4)](_0x2a8ff0); if (!_0x1ee9a0 || !_0x46626e || !_0x46626e[_0xd8bc4f(0xfa)]) return; const _0x3eb980 = _0x1ee9a0['processName'](_0x46626e[_0xd8bc4f(0x220)]); _0x1ee9a0[_0xd8bc4f(0x1d3)][_0x3eb980] = { 'x': _0x46626e[_0xd8bc4f(0xfa)]['x'], 'y': _0x46626e['position']['y'], 'z': _0x46626e[_0xd8bc4f(0xfa)]['z'] }; if (_0x46626e['yRot'] !== undefined) _0x1ee9a0['yRots'][_0x3eb980] = _0x46626e[_0xd8bc4f(0x149)]; if (_0x46626e[_0xd8bc4f(0x131)] !== undefined) _0x1ee9a0[_0xd8bc4f(0x120)][_0x3eb980] = _0x46626e[_0xd8bc4f(0x131)]; }); if (!process['argv'][_0x2a080b(0x20c)]('--streamlit')) try { const _0x3c20a7 = new Session(null, globalConfig); await _0x3c20a7['startWebSession'](), pendingSessions[_0x2a080b(0x1fa)](_0x3c20a7['id'], _0x3c20a7); } catch (_0x8583b2) { console[_0x2a080b(0x222)](_0x2a080b(0x163), _0x8583b2); } else try { fs[_0x2a080b(0xef)]('server_info.json', JSON['stringify']({ 'port': _0xa45af, 'web_port': _0x4111ff }, null, 0x2)); } catch (_0x44aacb) { console[_0x2a080b(0x222)](_0x2a080b(0x17d), _0x44aacb); } } function _0x1fda(_0x17319c, _0x4259cb) { _0x17319c = _0x17319c - 0xe1; const _0x1b3098 = _0x1b30(); let _0x1fda43 = _0x1b3098[_0x17319c]; return _0x1fda43; } process['on'](_0x4b563d(0x114), () => { const _0x48ad4c = _0x4b563d; sessions['forEach'](_0x57e6c3 => _0x57e6c3[_0x48ad4c(0x185)]()), process[_0x48ad4c(0x1a3)](); }), main(); function _0x1b30() { const _0x4daf9c = ['promises', 'tag\x20@a\x20list', 'not_found', '45mNInYg', 'handleTcpUpgrade', 'spectatorSet', 'tag\x20@s\x20add\x20\x22pvc:roomId=', 'msgpack-lite', 'processName', 'yRot', 'spectatorが有効の場合のみ有効：\x0a\x20!specListen\x20-\x20!specListen\x20<§atrue§r/§cfalse§r>\x20スペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20!specDim\x20-\x20!specDim\x20<§atrue§r/§cfalse§r>\x20スペクテイター同士の会話をディメンションごとに分けます', '近接vcを有効にしました', 'false', 'startsWith', 'searchParams', 'https://', 'forEach', 'string', 'connectCommand', 'Server', 'testfor\x20@e[type=player]', 'スペクテイターが他モードプレイヤーの会話を聞けなくなりました', 'values', 'Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', 'testfor\x20@a', 'floor', 'decode', 'startTimer', 'size', 'function', 'node-fetch', 'port', 'reason', '\x0a\x20-\x20Spectator\x20Listen:\x20', 'test', '[Standalone]\x20Failed\x20to\x20start\x20session:', 'run_command', 'data_update', '[Config]\x20No\x20configuration\x20file\x20found.\x20Using\x20default\x20settings.', 'Host\x20left.\x20Handing\x20stop\x20signal...', 'use', '❌\x20設定ファイルの更新に失敗しました:', 'from', 'isProcessingTags', 'clear', 'zlib', 'logInfo', '\x0a=======================================================', './lib/server', 'Tag\x20processing\x20error:', 'log', 'true', 'timeout', '?clientType=server_script', './config.json', 'passwords', '\x0a\x20-\x20ディメンション毎にVCを分ける\x20(Dim):\x20', 'broadcastPositions', '[Relay]\x20Connected\x20(ID:\x20', 'add', 'wanakana', 'Failed\x20to\x20write\x20server_info.json:', 'setupMcRelayListeners', '\x0aSpectator\x20Split:\x20', '認証コードを有効にしました', '\x1b[33m[Log][', 'Verify\x20code\x20is\x20', '35368340SuVOPC', 'consecutiveTimeouts', 'destroy', 'post', '\x0aProximity\x20VC:\x20', '\x0a声の届く距離：', 'web_port', 'action', 'then', 'Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players', 'stop_roop', '\x0a!help\x20でコマンド一覧を確認できます', 'Output\x20enabled', 'spectators', 'readyState', 'userName', 'sendInitMessage', '\x0a\x20-\x20Spectator\x20Dimension:\x20', '\x0a\x20-\x20スペクテイター以外の声を聞ける\x20(Listen):\x20', '§l[Current\x20Settings]§r\x0aLanguage:\x20', '\x0a出力\x20(Output):\x20', 'localhost', '<Proximity\x20VC>Changed\x20max\x20distance\x20to\x20', 'onlinePlayers', 'Session\x20not\x20found', 'PlayerLoad', 'sshClient', 'specListen', 'password', 'nameCache', 'filter', './config.jsonc', 'exit', 'Switched\x20to\x20relay\x20mode.\x0aRoom\x20ID:\x20', 'partner_disconnected', 'sshError', 'リレーモードに切り替わりました。\x0aRoom\x20ID:\x20', 'Buffer', 'directVcClients', 'localClient', 'vc_connected', 'roomId', 'wss://', '§c[MCBE\x20Prox\x20VC]\x20Time\x20limit\x20reached.', '<近接VC>', 'aliveSet', 'inactivityTimer', 'gunzipSync', 'Participants\x20should\x20access\x20this\x20URL', 'json5', 'Pending\x20Session', 'pvcDomain', 'details', 'open', 'pvc:req_cmd', '[Local\x20Client\x20Error]\x20', 'partner_connected', 'processTagCommands', 'URL:https://mcproxvc.ovh/connect/\x0aRoomID\x20is\x20', '\x0aOutput:\x20', 'getAllTags', '/api/stop_session', 'toRomaji', '<近接VC>声の最大距離を', 'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players', 'get', 'world', 'PlayerChat', 'http', 'localPlayer', 'verify', 'parse', 'readFile', 'params', '[Connection]\x20Rejected\x20connection\x20for\x20domain\x20\x27', 'specDim', 'handleDirectVcConnection', 'random', 'Proximity\x20Voice\x20Chat\x20Gateway\x20Active', 'pvc:roomId=', 'positions', '2WKOPHy', 'pvc:', '§r\x0aVerify\x20Code:\x20', 'Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:', '/api/session_status/:id', 'Spectator\x27s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions', 'yRots', '[Auto-Stop][', '参加:\x20', 'replace', 'bindWorld', 'WorldAdd', '退出:\x20', 'tag\x20@a[tag=\x22', '/create-room?roomid=', '[MC\x20Relay]', 'round', 'delete', 'find', 'catch', 'config', '5554724dKXyNC', 'createCommands', 'minecraft', 'commands', '認証コードを無効にしました', 'init', 'disconnect_command', 'sub_domain', '--------------------', 'body', 'vcSshClient', './tcpexposer/tcpexposer_handler.js', 'victim', 'utf8', '6882615fjPOKa', 'enabled', 'です\x0aあなたのVCnameは', 'set', '参加者はこのURLにアクセスしてください:', '/connect\x20', 'message', 'tag\x20@a[tag=pvc:req_cmd]\x20list', 'headers', '近接vcを無効にしました', 'PlayerLeave', '\x1b[36m[Info]\x1b[0m\x20Webサーバーのポート:\x20', 'startWebSession', 'resetTimer', 'existsSync', 'list', 'verify\x20code\x20enabled', 'has', 'trim', '§c[MCBE\x20Prox\x20VC]\x20時間制限のため終了します。', 'CONNECTING', 'includes', 'get-port', 'end', 'runCommand', 'Session\x20not\x20found\x20for\x20this\x20domain', ']\x20最大稼働時間に達しました。', 'loop', '\x0aMax\x20Distance:\x20§e', 'host', 'disabled', '§r\x0a認証コード\x20(Verify):\x20', 'lang', '49288HfvfKN', '近接VCを使用中です\x0aURL:https://mcproxvc.ovh/connect/\x0aルームIDは', 'Proximity\x20VC\x20enabled', 'connectToRelayServer', 'players', 'Spectator\x27s\x20VC\x20separated\x20by\x20dimension', 'distance', 'useResetTimer', 'name', 'pendingTimeout', 'error', '\x0a近接VC\x20(Proximity):\x20', '435yKqJHe', 'handleUpgrade', 'relayWs', '914928UKpDYF', 'shift', 'warn', 'http://', 'Output\x20disabled', '4157iiklWO', 'スペクテイターが他モードプレイヤーの会話を聞けるようになりました', 'worldName', 'server_shutdown', 'OPEN', '=======================================================\x0a', 'setupVcRelayListeners', 'substring', '接続開始', 'スペクテイター同士の会話をディメンションごとに分けました', '§l[現在の設定一覧]§r\x0a言語\x20(Lang):\x20', 'writeFileSync', 'ws://127.0.0.1:', 'maxRuntimeTimeout', 'mcproxvc.fly.dev', 'length', 'localClientBuffer', 'status', 'sendMessage', 'mcSshClient', '\x0aMax\x20distance:', 'push', 'position', 'send', 'Proximity\x20VC\x20disabled', 'type', '/room/', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20minecraftチャットへの出力を有効/無効にできます\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20認証コードを有効/無効にできます\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20スペクテイターとVCを分けます', 'clientType', 'スペクテイター同士の会話を共通にしました', 'listen', 'testfor\x20@a[m=spectator]', 'split', 'tag\x20@a\x20remove\x20\x22', 'encode', 'ended', 'logLog', 'toString', '<近接VC>言語を日本語に設定しました', 'output', 'close', 'shouldBroadcast', 'spectator', 'url', 'data', './config.json5', 'ホスト専用コマンド：\x0a\x20!config\x20-\x20現在の設定一覧を表示します\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20lang\x20change\x0a\x20!dis\x20-\x20!dis\x20<数値>\x20声の届く距離を変更できます\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20近接vcを有効/無効にできます', '\x20!output\x20-\x20!output\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20information\x20output\x20to\x20minecraft\x20chat\x0a\x20!verify\x20-\x20!verify\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20verify\x20code\x0a\x20!spectator\x20-\x20!spectator\x20<§atrue§r/§cfalse§r>\x20separate\x20spectator\x20and\x20VC', 'SIGINT', '<Proximity\x20VC>', 'Error\x20handling\x20world\x20loop\x20[', 'indexOf', '\x20Error:', 'dataUpdate', 'URL:https://mcproxvc.ovh/connect/\x0aルームIDは', '\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)', 'Host-only\x20command\x20:\x20\x0a\x20!config\x20-\x20Show\x20current\x20settings\x0a\x20!lang\x20-\x20!lang\x20<ja/en>\x20言語の変更\x0a\x20!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20!pvc\x20-\x20!pvc\x20<§atrue§r/§cfalse§r>\x20enable/disable\x20proximity\x20voice\x20chat', 'sendInitialPayload', '2391072jrITpv', 'concat', 'dimensions', 'testfor\x20@a[tag=pvc:req_cmd]', 'statusCode', 'value', '§cDisabled§r', 'Connection\x20started\x0aProximity\x20voice\x20chat:', 'upgrade', 'cleanOldTags', 'keys', 'スペクテイターとVCを分けました', 'startTcpexposer', 'useRelay', 'statusMessage', 'mc_connected', '\x0aYour\x20VCname\x20is\x20', '/api/start_session', 'next', 'dimension', 'writeFile', 'Command\x20list:\x0a\x20!help\x20-\x20show\x20help\x0a\x20!name\x20-\x20check\x20your\x20VC\x20GamerTag', 'now', 'initialization', 'command_result', '\x1b[36m[Info]\x1b[0m\x20socket-beサーバーのポート:\x20', 'Password\x20is\x20', 'Session\x20destroying...\x20Reason:\x20', 'success', 'json', 'verify\x20code\x20disabled', 'crypto', '<Proximity\x20VC>Language\x20set\x20to\x20English', 'proximity']; _0x1b30 = function () { return _0x4daf9c; }; return _0x1b30(); }